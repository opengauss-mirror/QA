![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述                 | 作者         |
| ---------- | ----------- | ------------------------ | ------------ |
| 2022-09-23 | 1.0         | 测试报告初稿完成         | XiyeLan |

 关键词： 

dolphin插件，LOOP循环语法，兼容B库，mysql

摘要：

本文档主要介绍openGauss在兼容B库且有dolphin插件的情形下，实现兼容mysql的LOOP语法。LOOP循环语法实现了如下用法：一，支持在循环开始前，使用label标签使用 标签名+冒号 的语法；二，支持在循环结束后使用标签名的语法；三，支持在循环体内部，通过ITERATE关键字中断本次循环，进入下一次循环，等效于在循环中continue。

# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现LOOP循环语法的兼容，其语法功能与mysql侧一致。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| mysql 5.7                      | 2022-09-19   | 2022-09-23   |
| openGauss 3.0.0 build a100917c | 2022-09-19   | 2022-09-23   |
| dolphin 1.0                    | 2022-09-19   | 2022-09-23   |

描述特性测试的环境信息

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 物理机   | CPU：Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz 64核<br />内存：256GB<br />硬盘：100G<br />OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss兼容mysql LOOP循环语法共计执行用例23条，主要覆盖了功能测试及资料测试。功能测试覆盖结合表操作、LOOP旧语法及其他循环语法，结合其他自定义函数中的功能语法，结合自定义函数及存储过程原有语法，多并行嵌套循环，在自定义函数、存储过程及package等情况中使用LOOP新语法并校验执行结果。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 编译库、编译插件，执行结果符合预期，通过                     |
| 功能测试 | om安装库、安装插件，执行结果符合预期，通过                   |
| 功能测试 | 结合表操作、LOOP旧语法及其他循环语法的执行结果测试，执行结果符合预期，通过                   |
| 功能测试 | 结合自定义函数中的其他功能语法的执行结果测试，执行结果符合预期，通过                   |
| 功能测试 | 结合自定义函数原有语法的测试，执行结果符合预期，通过                   |
| 功能测试 | 多并行、嵌套循环测试，执行结果符合预期，通过                   |
| 功能测试 | 导入导出测试，通过                       |
| 功能测试 | 异常情景测试，通过                       |
| 资料测试 | 资料描述准确，示例的执行结果正确，通过                       |

## 3.2   约束说明

1. mysql使用5.7版本
2. openGauss需使用兼容B库且有dolphin插件

## 3.3   遗留问题分析

### 3.3.1  遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2  问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 0       | 0    | 0    | 0    | 0      |
| 百分比 | 0       | 0   | 0    | 0    | 0      |

### 3.3.3  问题单汇总

| 序号 | issue号 | 问题级别 | 问题简述  | 问题状态 |
| ---- | ------- | -------- | -------- | -------- |
| N/A  |         |          |          |          |

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 编译库及插件执行测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 编译库及插件成功，共执行23条用例，符合预期结果 |

#### 4.1.1.1 结合表操作、LOOP旧语法及其他循环语法测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 测试结合表操作、LOOP旧语法及其他循环语法的执行结果 | 执行9条用例，执行结果符合 |

#### 4.1.1.2 结合自定义函数中的其他功能语法测试

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 结合其他自定义函数及存储过程中的功能语法执行的输出结果 | 执行8条用例，执行结果符合预期 |

#### 4.1.1.3 结合自定义函数、存储过程原有语法的输出结果测试

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 结合自定义函数、存储过程中原有语法的执行结果 | 执行1条用例，执行结果符合预期 |

#### 4.1.1.4 多并行、嵌套循环的输出结果测试

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 测试存在多层并行循环、嵌套循环的输出结果 | 执行1条用例，执行结果符合预期 |

#### 4.1.1.5 导入导出的执行结果正确

| 测试步骤                                                  | 测试结果                       |
| --------------------------------------------------------- | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 测试包含LOOP新语法的对象导入导出的执行结果 | 执行2条用例，执行结果符合预期 |

#### 4.1.1.6 异常情景的执行结果正确

| 测试步骤                                                  | 测试结果                       |
| --------------------------------------------------------- | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 测试异常情景的执行结果 | 执行3条用例，执行结果符合预期 |

#### 4.1.1.7 函数在文档中的说明是否准确，示例的执行结果正确

| 测试步骤                                                  | 测试结果                       |
| --------------------------------------------------------- | ------------------------------ |
| 1. 测试函数在文档中的说明是否准确，示例的执行结果是否正确 | 符合预期 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果                  | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------------- | ------------ |
| openGauss 3.0.0 build a100917c | 23        | Passed：23  <br />Failed：0 | 0            |


数据说明
1、暂未发现缺陷


# 5     附件

## 5.1  LOOP循环语法结果示例
```sql
yat=# create table looptest_tab(a int);
CREATE TABLE
yat=# CREATE PROCEDURE loop_proc(a int) 
as 
BEGIN 
label1:
LOOP 
a:=a+1; 
if a<5 then 
insert into looptest_tab values(a);
ITERATE label1; 
END if; 
LEAVE label1; 
END LOOP label1; 
END;
/
CREATE PROCEDURE
yat=# call loop_proc(1);
 loop_proc
 ----------

 (1 rows)
 yat=# select * from looptest_tab order by a;
  a
 ---
  2
  3
  4
(3 rows)
```

