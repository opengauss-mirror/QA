![avatar](../../images/openGauss.png)

版权所有 © 2023 openGauss社区  您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>
了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

修订记录

| 日期     | 修订版本 | CR号 | 修改  章节                         | 修改描述           | 作者        |
| -------- | -------- | ---- | ---------------------------------- | ------------------ | ----------- |
| 2023.2.1 | 1.0      |      |                                    | 版本测试策略初稿   | yansong_lee |
| 2023.2.8 | 1.1      |      | 测试分层策略<br />测试分析设计策略 | 新特性验证策略补充 | yansong_lee |
|          |          |      |                                    |                    |             |


目 录

1 概述

>   1.1 版本背景

>   1.2 需求范围

2 风险

3 测试分层策略

4 测试分析设计策略

>   4.1 新增feature测试设计策略

>   4.2 继承feature/组件测试设计策略

>   4.3 专项测试策略

5 测试执行策略

6 附件

**Keywords 关键词**：openGauss 5.0.0 Release

Abstract 摘要：本文是openGauss 5.0.0 Release版本的整体测试策略，用于指导该版本测试活动开展

>   缩略语清单：

| 缩略语 | 英文全名                             | 中文解释       |
| ------ | ------------------------------------ | -------------- |
| CVE    | Common Vulnerabilities and Exposures | 公共漏洞和暴露 |
| SQL    | Structured Query Language            | 结构化查询语言 |
| DML    | Data Manipulation Language           | 数据操纵语言   |
| DDL    | Data Definition Language             | 数据定义语言   |
| DCL    | Data Control Language                | 数据控制语言   |

# <br>概述

openGauss是一款全面友好开放，携手伙伴共同打造的企业级开源关系型数据库。openGauss提供面向多核架构的极致性能、全链路的业务、数据安全、基于AI的调优和高效运维的能力。openGauss具有高性能、高可靠、高安全和易运维等特性，深度融合华为在数据库领域多年的研发经验，结合企业级场景需求，持续构建竞争力特性。

本文主要描述了openGauss 5.0.0 Release版本测试策略，将于2023年3月31日在openGauss社区发布，按照社区开发模式进行运作，结合社区release-manager团队指定的版本计划规划相应的测试活动。整体策略覆盖新需求、继承需求的测试分析和测试执行，明确各个测试周期的策略及出入口标准，指导后续测试活动。

## 版本背景

openGauss 5.0.0 Release版本2023年发布的openGauss Release版本，维护周期3年，旨在提前合入竞争力需求，以此腾出更多的时间来规划并执行质量加固活动。openGauss 5.0.0 Release版本面向openGauss的内核场景化、工具链和兼容性场景，提供更多新特性和功能，给开发者和用户带来全新的体验，服务更多的领域和更多的用户。除了修复bug和cve漏洞外，本次发布的有：

1. 【openGauss 5.0.0 Release】支持基于共享存储的资源池化架构
2. 【openGauss 5.0.0 Release】迁移工具的一站式解决方案
3. 【openGauss 5.0.0 Release】M数据库兼容性增强

等重大特性。

## 需求范围

结合社区release-manager团队制定的[版本计划](https://gitee.com/opengauss/release-management/blob/master/openGauss%205.0.0/release-plan.md)，openGauss 5.0.0 Release版本发布的需求列表如下：

1. **内核场景化**：涉及15个新特性，发布共享存储新特性，针对JDBC、ODBC等驱动侧做特性增强

   | no   | feature                                                      | status   | sig           | owner |
   | ---- | ------------------------------------------------------------ | -------- | ------------- | ----- |
   | 1    | 【openGauss 5.0.0 Release】支持XML类型                       | 方案设计 | StorageEngine |       |
   | 2    | 【openGauss 5.0.0 Release】支持慢SQL db_time统计补齐时间空洞 | 方案设计 | SQLEngine     |       |
   | 3    | 【openGauss 5.0.0 Release】dblink支持通过ODBC连接异构数据库  | 方案设计 | Connectors    |       |
   | 4    | 【openGauss 5.0.0 Release】ODBC windows版本发布              | 方案设计 | Connectors    |       |
   | 5    | 【openGauss 5.0.0 Release】支持openEuler 22.03 LTS系统       | 需求验收 | StorageEngine |       |
   | 6    | 【openGauss 5.0.0 Release】支持数据库物理读写块大小的配置功能 | 代码检视 | StorageEngine |       |
   | 7    | 【openGauss 5.0.0 Release】JDBC的cleanupTimer锁机制优化      | 方案设计 | Connectors    |       |
   | 8    | 【openGauss 5.0.0 Release】JDBC高可用优化                    | 方案设计 | Connectors    |       |
   | 9    | 【openGauss 5.0.0 Release】JDBC实现集群状态发生变化后，快速实现负载均衡效果 | 方案设计 | Connectors    |       |
   | 10   | 【openGauss 5.0.0 Release】升级后的数据字典校验              | 方案设计 | StorageEngine |       |
   | 11   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储支持非512字节整数倍读和写 | 方案设计 | StorageEngine |       |
   | 12   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储HA场景加固 | 方案设计 | StorageEngine |       |
   | 13   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储DFX增强 | 方案设计 | StorageEngine |       |
   | 14   | 【openGauss 5.0.0 Release】【资源池化】openGauss共享存储方案支持升级 | 方案设计 | StorageEngine |       |
   | 15   | 【openGauss 5.0.0 Release】【资源池化】资源池化支持Dorado复制，支持主备双集群部署 | 方案设计 | StorageEngine |       |

2. **工具链**：涉及16个新特性，主要是迁移工具、校验工具以及OM/CM等工具增强

   | no   | feature                                                      | status   | sig   | owner |
   | ---- | ------------------------------------------------------------ | -------- | ----- | ----- |
   | 1    | 【openGauss 5.0.0 Release】【迁移工具】支持一站式迁移工具portal | 需求验收 | Tools |       |
   | 2    | 【openGauss 5.0.0 Release】【迁移工具】数据校验支持行级、列级和全量比较规则 | 需求验收 | Tools |       |
   | 3    | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（增量迁移） | 需求验收 | Tools |       |
   | 4    | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（反向迁移） | 需求验收 | Tools |       |
   | 5    | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（校验工具） | 方案设计 | Tools |       |
   | 6    | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（全量迁移） | 方案设计 | Tools |       |
   | 7    | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（增量迁移） | 方案设计 | Tools |       |
   | 8    | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（数据校验） | 方案设计 | Tools |       |
   | 9    | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（反向迁移） | 方案设计 | Tools |       |
   | 10   | 【openGauss 5.0.0 Release】【迁移工具】一体化平台集成portal，支持可视化迁移管理 | 方案设计 | Tools |       |
   | 11   | 【openGauss 5.0.0 Release】【迁移工具】debezium全量迁移支持对MySQL对象的迁移 | 方案设计 | Tools |       |
   | 12   | 【openGauss 5.0.0 Release】【迁移工具】MySQL迁移工具适配内核兼容性 | 方案设计 | Tools |       |
   | 13   | 【openGauss 5.0.0 Release】【OM工具】支持python解析器和OM一起打包，屏蔽用户环境python版本差异 | 方案设计 | OM    |       |
   | 14   | 【openGauss 5.0.0 Release】支持一键式关闭CM集群服务          | 方案设计 | CM    |       |
   | 15   | 【openGauss 5.0.0 Release】CM支持事件结束后调用用户自定义脚本 | 方案设计 | CM    |       |
   | 16   | 【openGauss 5.0.0 Release】CM支持容器化部署                  | 方案设计 | CM    |       |

3. **兼容性**：涉及15个新特性，从数据类型兼容、系统函数兼容、DDL兼容、DML兼容、PL/SQL兼容、SHOW语法兼容和其他语法兼容方面提升openGauss对openGauss对M*的兼容率

   | no   | feature                                                      | status         | sig    | owner    |
   | ---- | ------------------------------------------------------------ | -------------- | ------ | -------- |
   | 1    | 【openGauss 5.0.0 Release】【M兼容性】支持隐藏索引           | 方案设计       | Plugin |          |
   | 2    | 【openGauss 5.0.0 Release】【M兼容性】支持union查询关联不同类型的字段 | 设计方案评审   | Plugin |          |
   | 3    | 【openGauss 5.0.0 Release】【M兼容性】支持建表语句中不常见选项语法兼容 | 设计方案评审   | Plugin |          |
   | 4    | 【openGauss 5.0.0 Release】【M兼容性】create function语法兼容 | 方案设计       | Plugin |          |
   | 5    | 【openGauss 5.0.0 Release】【M兼容性】支持操作符行为和M兼容  | 代码编写与自测 | Plugin |          |
   | 6    | 【openGauss 5.0.0 Release】【M兼容性】DataStudio/JDBC/ODBC/Go/python支持新数据类型的映射 | 方案设计       | Plugin |          |
   | 7    | 【openGauss 5.0.0 Release】【M兼容性】distinct支持order by带表达式 | 代码编写与自测 | Plugin |          |
   | 8    | 【openGauss 5.0.0 Release】【M兼容性】支持数据类型显式/隐式转换规则 | 方案设计       | Plugin |          |
   | 9    | 【openGauss 5.0.0 Release】【M兼容性】导入导出、备份恢复工具支持M兼容性 | 方案设计       | Plugin |          |
   | 10   | 【openGauss 5.0.0 Release】M兼容性 full text全文索引         | 方案设计       | Plugin | Enmotech |
   | 11   | 【openGauss 5.0.0 Release】M兼容性 'user'@'host' 用户        | 方案设计       | Plugin | Enmotech |
   | 12   | 【openGauss 5.0.0 Release】lock table相关特性                | 方案设计       | Plugin | Enmotech |
   | 13   | 【openGauss 5.0.0 Release】外键支持关联到普通索引            | 方案设计       | Plugin | Enmotech |
   | 14   | 【openGauss 5.0.0 Release】M兼容性 别名支持单引号            | 方案设计       | Plugin | Enmotech |
   | 15   | 【openGauss 5.0.0 Release】M兼容性 show status语法           | 方案设计       | Plugin | Enmotech |

# 风险

这里可以呈现已识别的影响版本交付的风险，根据版本需求调查、技术分析和物料状况进行汇总，识别出当前版本风险&障碍列举如下：

| 问题类型 | 问题描述                                | 问题等级 | 应对措施           | 责任人      | 状态 |
| -------- | --------------------------------------- | -------- | ------------------ | ----------- | ---- |
| 物料风险 | 缺少2P（Taishan 200 2280 5220）性能环境 | 高       | 求助上层，协调物料 | yansong_lee | open |

# 测试分层策略

| 序号 | 需求                                                         | 开发主体      | 测试主体    | 验证策略                                                     |
| ---- | ------------------------------------------------------------ | ------------- | ----------- | ------------------------------------------------------------ |
| 1    | 【openGauss 5.0.0 Release】支持XML类型                       | StorageEngine | QA          | 1.验证xml数据类型取值，对无效值得处理；<br />2.验证类型转换功能；<br />3.类型和函数、操作符之间的交互使用；<br />4.xml类型上创建索引、约束。 |
| 2    | 【openGauss 5.0.0 Release】支持慢SQL db_time统计补齐时间空洞 | SQLEngine     | QA          | 1.调整log_min_duration_statement，验证sql是否为慢sql<br />2.慢SQL是否满足parser+optimize+execute time=db_time<br />3.统计时间execute time是否存在时间空洞 |
| 3    | 【openGauss 5.0.0 Release】dblink支持通过ODBC连接异构数据库  | Connectors    | QA          | 1.验证dblink支持通过ODBC连接异构数据库；<br />2.验证连接异构数据库后，增删该查等功能正常；<br />3.验证连接异构数据库后，dblink支持的函数功能正常 |
| 4    | 【openGauss 5.0.0 Release】ODBC windows版本发布              | Connectors    | QA          | 验证ODBC是否支持windows平台，驱动的安装部署、基本函数的使用以及使用其连接数据库后增删改查等功能正常 |
| 5    | 【openGauss 5.0.0 Release】支持openEuler 22.03 LTS系统       | StorageEngine | QA          | 1.数据库内核、OM、CM、JDBC/ODBC/python驱动、libpq以及迁移工具在openEuler 22.03LTS可编译；<br />2.OM、CM、JDBC/ODBC/python驱动等工具在openEuler 22.03LTS正常使用；<br />3.TPCC+gazelle组件性能满足180W tpmC。 |
| 6    | 【openGauss 5.0.0 Release】支持数据库物理读写块大小的配置功能 | StorageEngine | QA          | 1.可修改的物理块大小的尺寸标准；<br />2.不同物理块大小的是适配对象；<br />3.验证物理块大小对数据库读取速度的影响。 |
| 7    | 【openGauss 5.0.0 Release】JDBC的cleanupTimer锁机制优化      | Connectors    | QA          | 验证优化jdbc锁cleanup Timer后，jdbc性能是否有提升以及原有功能是否被影响 |
| 8    | 【openGauss 5.0.0 Release】JDBC高可用优化                    | Connectors    | QA          | 对集群进行主备切换，主节点异常后备升主，主节点异常后恢复等操作，验证JDBC连接新主功能正常 |
| 9    | 【openGauss 5.0.0 Release】JDBC实现 集群状态发生变化后，快速实现负载均衡效果 | Connectors    | QA          | 对集群进行主备切换，主节点异常后备升主，主节点异常后恢复，备节点进行异常后恢复等操作，验证JDBC连接针对当时状态正常的节点负载均衡 |
| 10   | 【openGauss 5.0.0 Release】升级后的数据字典校验              | StorageEngine | QA          | 1.验证支持新版本数据字典（表、数据类型和cast、视图、函数）生成key为对象、值为对象hash值的基准文件不同类型覆盖测试<br/>2.针对升级后版本和基准文件进行校验，校验数量和结构，校验内容不能丢、不能出错等常见场景覆盖测试 |
| 11   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储支持非512字节整数倍读和写 | StorageEngine | QA          | 1.验证共享存储模式下非512字节整数倍读和写功能<br />2.验证共享存储模式下512字节整数倍读和写功能 |
| 12   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储HA场景加固 | StorageEngine | QA          | 验证多节点集群下HA功能、性能以及压力场景下的HA能力，关注备机的可读能力 |
| 13   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储DFX增强 | StorageEngine | QA          | 验证并发场景下内存资源版本一致                               |
| 14   | 【openGauss 5.0.0 Release】【资源池化】openGauss共享存储方案支持升级 | StorageEngine | QA          | 验证共享存储支持就地升级、灰度升级、滚动升级，升级前后数据一致，及升级后功能正常 |
| 15   | 【openGauss 5.0.0 Release】【资源池化】资源池化支持Dorado复制，支持主备双集群部署 | StorageEngine | QA          | 1.验证资源池化支持主备双集群安装部署方式，适配环境；<br />2.验证基于Dorado复制的基本功能和资料 |
| 16   | 【openGauss 5.0.0 Release】【迁移工具】支持一站式迁移工具portal | Tools         | QA          | 1.验证工具安装部署、卸载，以及工具命令参数校验<br/>2.验证是否具有全量迁移，增量迁移、反向迁移和数据校验能力，以及自定义组合命令使用 |
| 17   | 【openGauss 5.0.0 Release】【迁移工具】数据校验支持行级、列级和全量比较规则 | Tools         | QA          | 1.验证通过设置表的黑白名单、行号、列字段校验特定数据<br/>2.构造迁移异常场景，更改openGauss数据，通过自定义规则校验数据生效<br/>3.验证可靠性场景，注入网络、cpu等故障，自定义行列级规则不受影响<br/>4.验证资料的一致性 |
| 18   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（增量迁移） | Tools         | QA          | 1.验证增量迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,反向迁移支持迁移失败数据、DDL失败语句展示<br/>3.验证资料完整性和可操作性 |
| 19   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（反向迁移） | Tools         | QA          | 1.验证反向迁移数据类型转换的一致性<br/>2.验证反向迁移和全量、增量迁移工具的衔接是否正常<br/>3.验证反向迁移性能支持3w tps |
| 20   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（校验工具） | Tools         | QA          | 1.验证源端抽取服务从chameleon本地保存的csv文件解析<br/>2.验证通过csv文件解析后可正常进行数据校验且校验结果准确<br/>3.验证异常场景，构造数据差异，可以校验出两端数据以不一致，并给出修复提示<br/>4.可靠性测试，通过注入网络、cpu故障不影响解析csv文件及数据校验<br/>5.验证资料的一致性，可操作性 |
| 21   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（全量迁移） | Tools         | QA          | 1.验证全量迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证全量迁移是否支持迁移失败对象的展示<br/>3.验证资料完整性和可操作性 |
| 22   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（增量迁移） | Tools         | QA          | 1.验证增量迁移是否支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.增量迁移是否支持支持迁移失败数据、DDL失败语句展示<br/>3.验证资料完整性和可操作性 |
| 23   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（数据校验） | Tools         | QA          | 1.验证通过自定义命令可以查看数据校验进度信息、状态信息<br/>2.验证自定义命令显示的进度信息、状态信息与后台保持一致<br/>3.资料测试，自定义命令可执行，释义准确 |
| 24   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（反向迁移） | Tools         | QA          | 1.验证反向迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,反向迁移支持迁移失败数据、DDL失败语句展示<br/>3.验证资料完整性和可操作性 |
| 25   | 【openGauss 5.0.0 Release】【迁移工具】一体化平台集成portal，支持可视化迁移管理 | Tools         | QA          | 1.验证任务流创建<br />2.参数配置是否生效<br />3. 查看结果和性能展示是否成功 |
| 26   | 【openGauss 5.0.0 Release】【迁移工具】debezium全量迁移支持对MySQL对象的迁移 | Tools         | QA          | 1.验证是否支持使用Debezium对表、索引、约束、存储过程、函数、触发器、schema的全量迁移<br/>2.验证是否支持对MySQL对象的迁移 |
| 27   | 【openGauss 5.0.0 Release】【迁移工具】MySQL迁移工具适配内核兼容性 | Tools         | QA          | 1.验证全量迁移（变色龙）和增量迁移（dbz）是否适配数据类型，ddl，字段，表名，表数据，是否支持大小写等方面的适配<br/>2.验证MySQL迁移工具是否适配内核兼容性 |
| 28   | 【openGauss 5.0.0 Release】【OM工具】支持python解析器和OM一起打包，屏蔽用户环境python版本差异 | OM            | QA          | 不同python版本下，数据库的安装、卸载和工具使用以及功能完整性 |
| 29   | 【openGauss 5.0.0 Release】支持一键式关闭CM集群服务          | CM            | QA          | 1.验证一键启停CM集群仲裁服务的功能<br/>2.验证停止CM服务后，数据库的调试和维护操作 |
| 30   | 【openGauss 5.0.0 Release】CM支持事件结束后调用用户自定义脚本 | CM            | QA          | 1.验证定制化接口(failover后调度自定义脚本)的功能<br/>2.验证资料完整性和可操作性 |
| 31   | 【openGauss 5.0.0 Release】CM支持容器化部署                  | CM            | QA          | 1.验证支持容器化安装<br/>2.验证容器化中的集群管理(建立互信，CM安装拉起等)功能 |
| 32   | 【openGauss 5.0.0 Release】【M兼容性】支持隐藏索引           | Plugin        | QA          | 1.验证CREATE/ALTER TABLE时指定索引并设置可见性<br/>2.验证不同索引类型设置可见性<br/>3.验证设置不可见索引后查询计划是否忽略该索引<br/>4.验证多种数据类型、系统表新增及gs_dump工具导出结果<br/>5.参数控制索引可见性的设置 |
| 33   | 【openGauss 5.0.0 Release】【M兼容性】支持union查询关联不同类型的字段 | Plugin        | QA          | 1.验证不同类型字段结合union查询<br>2.验证不同类型的表中的字段集合union查询<br>3.验证在select语句中包含where、like、操作符、函数、以及join链接查询情况，结合union查询 |
| 34   | 【openGauss 5.0.0 Release】【M兼容性】支持建表语句中不常见选项语法兼容 | Plugin        | QA          | 1.验证建表及修改表时添加可选项是否成功<br>2.验证可选项的参数取值<br>3.验证回显结果，是否有warning提示 |
| 35   | 【openGauss 5.0.0 Release】【M兼容性】create function语法兼容 | Plugin        | QA          | 1.验证单流程控制语句函数支持创建函数时函数主体前不加as $$ begin，末尾不加end; $$ language plpgsql标识<br>2.验证begin-end场景支持创建函数时函数主体前不加as $$ begin，末尾不加end; $$ language plpgsql标识 |
| 36   | 【openGauss 5.0.0 Release】【M兼容性】支持操作符行为和M兼容  | Plugin        | QA          | 1.验证与M*行为不一致的操作符，其输出函数、返回值类型等<br/>2.验证系统表pg_operator_for_mysql的各字段及所存储的操作符信息 |
| 37   | 【openGauss 5.0.0 Release】【M兼容性】DataStudio/JDBC/ODBC/Go/python支持新数据类型的映射 | Plugin        | QA          | 1.验证JDBC/ODBC/Go/Python驱动对新增数据类型的映射支持<br>2.验证DataStudio对新增类型编辑支持 |
| 38   | 【openGauss 5.0.0 Release】【M兼容性】distinct支持order by带表达式 | Plugin        | QA          | 1.验证order by后指定单列或者多列，结合函数及运算符、指定asc/desc排序<br/>2.验证order by后跟的字段不在distinct列表中，并结合各类运算符<br/>3.验证order by后跟的字段不在distinct列表中时，distinct on expression语句<br/>4.参数控制distinct支持order by带表达式<br/>5.验证select子查询、嵌套查询及包含group by、having等子句带order by表达式的执行结果 |
| 39   | 【openGauss 5.0.0 Release】【M兼容性】支持数据类型显式/隐式转换规则 | Plugin        | QA          | 1.验证数据类型显式/隐式转换时对合法入参和非法入参的处理是否符合预期<br>2.验证显式/隐式转换后的数据和函数、操作符之间的交互使用 |
| 40   | 【openGauss 5.0.0 Release】【M兼容性】导入导出、备份恢复工具支持M兼容性 | Plugin        | QA          | 1.验证导入导出工具、备份恢复工具支持的对象<br>2.验证支持的数据类型<br>3.验证支持的语法<br>4.工具支持的参数测试<br>5.导出后执行导入，备份后执行恢复，验证数据是否一致完整<br>6.导出权限测试<br>7.工具可靠性测试，如频繁导入导出、导入文件异常、导出的对象不存在、备份恢复时数据库异常等情况 |
| 41   | 【openGauss 5.0.0 Release】M兼容性 full text全文索引         | Plugin        | QA-Enmotech |1.验证在DDL语法中创建全文索引的使用<br/>2.验证在DML查询语法中的使用<br/>3.验证全文索引在单独创建中的使用|
| 42   | 【openGauss 5.0.0 Release】M兼容性 'user'@'host' 用户        | Plugin        | QA-Enmotech |1.验证create user username@hostip的语法<br/>2.验证用户名@host方式的认证<br/>3.验证是否可以辨别来自不同主机相同用户名<br/>4.验证多个可匹配时的排序规则<br/>5.支持对象的owner字段支持用户名@host方式指定<br/>6.不支持username带@特殊字符<br/>7.验证兼容性开关对此函数的影响<br/>8.验证username@hostname合理报错 |
| 43   | 【openGauss 5.0.0 Release】lock table相关特性                | Plugin        | QA-Enmotech |1.验证lock tables name read 语法<br/>2.验证lock table name write 语法<br/>3.验证unlock tables语法<br/>4.验证flush tables with read lock语法<br/>5.验证支持外键和触发器|
| 44   | 【openGauss 5.0.0 Release】外键支持关联到普通索引            | Plugin        | QA-Enmotech |1.验证支持对唯一索引创建外键<br/>2.验证创建非唯一性索引的外键合理报错键<br/>3.验证对唯一索引创建外键，UPDATE之后对表中内容的影响键<br/>4.验证对唯一索引创建外键，DELETE 之后对表中内容的影响<br/>5.验证B_FORMAT模式对唯一索引创建外键的影响<br/> 6.B_FORMAT模式对非唯一索引创建外键的影响|
| 45   | 【openGauss 5.0.0 Release】M兼容性 别名支持单引号            | Plugin        | QA-Enmotech |                                                              |
| 46   | 【openGauss 5.0.0 Release】M兼容性 show status语法           | Plugin        | QA-Enmotech |                                                              |

# 测试分析设计策略

## 新增feature测试设计策略

| 序号 | Feature                                                      | 重点                                                         | 设计思路                                                     | 备注 |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| 1    | 【openGauss 5.0.0 Release】支持XML类型                       | 重点关注取值范围、类型转换功能                               | 创建表的字段使用xml类型，插入/更新/导出/导入数据；从取值范围，类型转换，数据类型结合操作符等方面验证 |      |
| 2    | 【openGauss 5.0.0 Release】支持慢SQL db_time统计补齐时间空洞 | 关注sql执行时间统计中是否存在时间空洞问题                    | 查看慢sql执行统计的时间是否为parser+optimize+execute time，并查看时间分配情况，验证execute time是否还存在时间空洞问题 |      |
| 3    | 【openGauss 5.0.0 Release】dblink支持通过ODBC连接异构数据库  | 重点验证验证连接端数据库、远程数据库的连接，以及SQL操作、断连等功能 | 1.验证dblink支持通过ODBC连接异构数据库；<br />2.验证连接异构数据库后，增删该查等功能正常；<br />3.验证连接异构数据库后，dblink支持的函数功能正常；<br />4.验证连接异构数据库认证加密等安全方面；<br />5.验证异构数据库数据类型兼容性 |      |
| 4    | 【openGauss 5.0.0 Release】ODBC windows版本发布              | 重点验证ODBC是否支持windows平台                              | 1.测试ODBC在windows平台安装部署；<br />2.windows平台通过ODBC连接数据库后，测试基本函数的功能正常；<br />3.windows平台通过ODBC连接数据库后，增删改查等功能正常 |      |
| 5    | 【openGauss 5.0.0 Release】支持openEuler 22.03 LTS系统       | 验证数据库内核、OM、CM、JDBC/ODBC/python驱动、libpq以及迁移工具在openEuler 22.03LTS可编译，工具能正常使用，性能满足180W tpmC | 在x86架构和arm架构的openEuler 22.03LTS系统分别编译数据库内核和工具，并分别测试编译安装、om方式安装、极简安装数据库并执行基本功能，安装gazelle组件测试TPCC性能。 |      |
| 6    | 【openGauss 5.0.0 Release】支持数据库物理读写块大小的配置功能 | 验证物理块大小可被修改，验证修改方式                         | 针对物理块可修改的范围，不同尺寸标准的物理块支持的存储对象以及不同大小物理块的读取速度多场景展开测试 |      |
| 7    | 【openGauss 5.0.0 Release】JDBC的cleanupTimer锁机制优化      | 重点验证此需求实现后现有的cleanup Timer锁与之前的区别，是否成功实现了提升jdbc的性能以及优化后的jdbc功能是否正常 | 1.此需求成功实现后每个连接占用一把cleanup Timer锁可提升并发度验证<br />2.测试原先jdbc相比优化后高并发场景下性能是否有提升<br />3.测试新优化的jdbc已有功能是否被影响，测试方式可以使用TPCC或者jmeter压测 |      |
| 8    | 【openGauss 5.0.0 Release】JDBC高可用优化                    | 主节点状态变化后，验证JDBC连接获取新主功能正常               | 模拟当前JDBC连接的主节点故障，主备状态发生切换或者未切换，新的JDBC连接是否能准确识别新主 |      |
| 9    | 【openGauss 5.0.0 Release】JDBC实现 集群状态发生变化后，快速实现负载均衡效果 | 验证根据集群下各个节点的状态是否正常，JDBC连接自动识别正常节点并进行负载均衡 | 模拟主节点、备节点、或者主备状态发生变化时，JDBC连接是否能自动检测感知，对异常节点剔除，正常节点重新加入连接，且当前正常的所有节点是否负载均衡 |      |
| 10   | 【openGauss 5.0.0 Release】升级后的数据字典校验              | 验证新版本和升级后数据字典等基准文件校验校验数量和结构内容不能出错 | 1.验证支持新版本数据字典（表、数据类型和cast、视图、函数）生成key为对象、值为对象hash值的基准文件不同类型覆盖测试<br/>2.针对升级后版本和基准文件进行校验，校验数量和结构，校验内容不能丢、不能出错等常见场景覆盖测试 |      |
| 11   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储支持非512字节整数倍读和写 | 重点验证共享存储模式下支持非512字节整数倍的读和写            | 1.测试共享存储模式下非512字节整数倍的读和写操作<br />2.测试512字节整数倍的读和写功能是否受影响 |      |
| 12   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储HA场景加固 | 重点验证不同压力场景下的HA能力，关注其成功率及性能是否增强   | 部署不同的集群及压力模型，覆盖常规场景下、不同业务场景以及switchover、failover过程中故障的HA功能、可靠性、性能增强 |      |
| 13   | 【openGauss 5.0.0 Release】【资源池化】openGauss 共享存储DFX增强 | 主要测并发读写叠加reform场景时，页面版本是否正确             | 1.部署一主两备集群，验证并发读写场景时是否会产生死锁或者core<br />2.部署一主两备集群，验证并发读写叠加reform场景时是否会产生死锁或者core；<br />3.验证并发读写叠加reform场景时，页面版本是否正确 |      |
| 14   | 【openGauss 5.0.0 Release】【资源池化】openGauss共享存储方案支持升级 | 验证共享存储支持就地升级、灰度升级、滚动升级，以及升级后基本功能是否正常，数据是否一致 | 1.测试在共享存储模式下就地升级、灰度升级、滚动升级功能正常<br />2.进行升级前后数据进行对比，数据保持一致<br />3.升级后连跑tpcc，测试升级后数据库功能正常 |      |
| 15   | 【openGauss 5.0.0 Release】【资源池化】资源池化支持Dorado复制，支持主备双集群部署 | 验证资源池化架构模式下基于Dorado复制的基本功能，关注双集群部署模式 | 1.关注Dorado复制的基本功能实现，度量是否涉及可靠性验证；<br />2.关注部署方式 |      |
| 16   | 【openGauss 5.0.0 Release】【迁移工具】支持一站式迁移工具portal | 验证迁移任务流创建，全量迁移，增量迁移，反向迁移和数据校验完整方案打通及资料描述 | 1.验证工具安装部署、卸载，以及工具命令参数校验<br/>2.验证是否具有全量迁移，增量迁移、反向迁移和数据校验能力，以及自定义组合命令使用 |      |
| 17   | 【openGauss 5.0.0 Release】【迁移工具】数据校验支持行级、列级和全量比较规则 | 表、行列级规则生效，可以通过正则匹配去校验特定的数据         | 1.验证通过设置表的黑白名单、行号、列字段校验特定数据<br/>2.构造迁移异常场景，更改openGauss数据，通过自定义规则校验数据生效<br/>3.验证可靠性场景，注入网络、cpu等故障，自定义行列级规则不受影响<br/>4.验证资料的一致性 |      |
| 18   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（增量迁移） | 验证增量迁移的功能、性能及资料描述                           | 1.验证增量迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,增量迁移支持迁移失败数据、DDL失败语句展示，增量量迁移支持迁移失败对象的展<br/>3.验证资料完整性和可操作性 |      |
| 19   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（反向迁移） | 验证反向迁移的功能、性能及资料描述                           | 1.验证反向迁移数据类型转换的一致性<br/>2.验证反向迁移和全量、增量迁移工具的衔接是否正常<br/>3.验证反向迁移性能支持3w tps |      |
| 20   | 【openGauss 5.0.0 Release】【迁移工具】MySQL数据迁移完整方案打通（校验工具） | 通过csv文件解析能够准确校验openGauss与MySQL数据的一致性      | 1.验证源端抽取服务从chameleon本地保存的csv文件解析<br/>2.验证通过csv文件解析后可正常进行数据校验且校验结果准确<br/>3.验证异常场景，构造数据差异，可以校验出两端数据以不一致，并给出修复提示<br/>4.可靠性测试，通过注入网络、cpu故障不影响解析csv文件及数据校验<br/>5.验证资料的一致性，可操作性 |      |
| 21   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（全量迁移） | 验证全量迁移进度以及报错提示信息的展示                       | 1.验证全量迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,全量迁移支持迁移失败数据、DDL失败语句展示，全量迁移支持迁移失败对象的展<br/>3.验证资料完整性和可操作性 |      |
| 22   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（增量迁移） | 验证增量迁移进度以及报错提示信息的展示                       | 1.验证增量迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,增量迁移支持迁移失败数据、DDL失败语句展示，全量迁移支持迁移失败对象的展<br/>3.验证资料完整性和可操作性 |      |
| 23   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（数据校验） | 自定义命令可执行、展示结果准确                               | 1.验证通过自定义命令可以查看数据校验进度信息、状态信息<br/>2.验证自定义命令显示的进度信息、状态信息与后台保持一致<br/>3.资料测试，自定义命令可执行，释义准确 |      |
| 24   | 【openGauss 5.0.0 Release】【迁移工具】迁移工具可调试性增强、可靠性增强（反向迁移） | 验证迁移和反向迁移进度以及报错提示信息的展示                 | 1.验证反向迁移支持迁移进度展示（总量、剩余量、剩余时间等）<br/>2.验证校验失败的数据展示是否完整,反向迁移支持迁移失败数据、DDL失败语句展示<br/>3.验证资料完整性和可操作性 |      |
| 25   | 【openGauss 5.0.0 Release】【迁移工具】一体化平台集成portal，支持可视化迁移管理 | 验证支持可视化迁移管理，包含迁移任务流创建，参数配置，过程打印，结果和性能展示 | 1.创建任务流，验证任务流创建<br />2.参数配置是否生效<br />3.查看过程打印是否成功<br />4. 查看结果和性能展示是否成功 |      |
| 26   | 【openGauss 5.0.0 Release】【迁移工具】debezium全量迁移支持对MySQL对象的迁移 | 验证是否支持使用Debezium对表、索引、约束、存储过程、函数、触发器、schema的全量迁移 | 1.验证是否支持使用Debezium对表、索引、约束、存储过程、函数、触发器、schema的全量迁移<br/>2.验证是否支持对MySQL对象的迁移 |      |
| 27   | 【openGauss 5.0.0 Release】【迁移工具】MySQL迁移工具适配内核兼容性 | 验证全量迁移（变色龙）和增量迁移（dbz）是否适配数据类型，ddl，字段，表名，表数据，是否支持大小写等方面的适配 | 1.验证全量迁移（变色龙）和增量迁移（dbz）是否适配数据类型，ddl，字段，表名，表数据，是否支持大小写等方面的适配<br/>2.验证MySQL迁移工具是否适配内核兼容性 |      |
| 28   | 【openGauss 5.0.0 Release】【OM工具】支持python解析器和OM一起打包，屏蔽用户环境python版本差异 | 不同python版本下，数据库的安装、卸载和工具使用以及功能完整性 | 1.验证不同python版本下，数据库的安装、卸载和工具使用以及功能完整性<br/>2.验证资料完整性和可操作性 |      |
| 29   | 【openGauss 5.0.0 Release】支持一键式关闭CM集群服务          | 验证一键启停CM集群仲裁服务的功能                             | 1.验证一键启停CM集群仲裁服务的功能<br/>2.验证停止CM服务后，数据库的调试和维护操作 |      |
| 30   | 【openGauss 5.0.0 Release】CM支持事件结束后调用用户自定义脚本 | 验证定制化接口的功能                                         | 1.验证定制化接口(failover后调度自定义脚本)的功能<br/>2.验证资料完整性和可操作性 |      |
| 31   | 【openGauss 5.0.0 Release】CM支持容器化部署                  | 验证在容器化中部署和集群管理功能                             | 1.验证支持容器化安装<br/>2.验证容器化中的集群管理(建立互信，CM安装拉起等)功能 |      |
| 32   | 【openGauss 5.0.0 Release】【M兼容性】支持隐藏索引           | 1.验证CREATE/ALTER TABLE时指定索引并设置可见性<br/>2.验证不同索引类型设置可见性 | 1.CREATE/ALTER TABLE指定PRIMARY KEY/UNIQUE约束并设置可见性，或CREATE/ALTER TABLE直接设置索引可见性<br/>如CREATE TABLE t1(ID INT,INDEX KEY_ID(ID) INVISIBLE);<br/>2.创建多种类型表如列存表、分区表等设置不同类型索引，设置可见性并观察执行计划是否执行该索引 |      |
| 33   | 【openGauss 5.0.0 Release】【M兼容性】支持union查询关联不同类型的字段 | 1.验证union/union all是否支持查询关联不同类型<br/>2.是否支持查询关联不同select语句 | 1.验证union/union all关联直接select不同的数据类型的场景<br/>2.验证关联select不同类型的表中数据的场景<br/>3.验证关联select不同函数的场景<br/>4.验证关联select语句中结合where/like使用的场景<br/>5.验证关联select语句中结合操作符、聚合函数使用的场景<br/>6.验证关联子查询及jion关联查询的场景 |      |
| 34   | 【openGauss 5.0.0 Release】【M兼容性】支持建表语句中不常见选项语法兼容 | 验证建表及修改表添加可选项是否支持                           | 1.从可选项参数取值测试<br>2.创建表成功查看回显结果测试<br>3.不同表类型，添加可选项测试<br>4.验证新增的可选项是否影响已有参数 |      |
| 35   | 【openGauss 5.0.0 Release】【M兼容性】create function语法兼容 | 主要验证create function支持创建函数时函数主体前不加as $$ begin，末尾不加end; $$ language plpgsql标识 | 1.验证单流程控制语句return、loop、while、if、repeat、case时函数功能正确性<br>2.验证函数体包含begin-end场景函数功能正确性<br>3.验证create function中函数选项支持，如comment、no sql、sql security等<br>4.验证函数创建语句查询显示正确性<br>5.验证函数return类型与主体返回不一致、函数选项不合理等异常场景 |      |
| 36   | 【openGauss 5.0.0 Release】【M兼容性】支持操作符行为和M兼容  | 验证与M*行为不一致的操作符，其输出函数、返回值类型等         | 1.针对与M*行为不一致的操作符，主要范围涉及数据类型(二进制、数字、浮点、字符串(set enum)、时间日期类型、json)的加减乘除运算，<br/>2.对操作符进行各种运算处理并结合函数运算，验证其执行结果和返回值类型 |      |
| 37   | 【openGauss 5.0.0 Release】【M兼容性】DataStudio/JDBC/ODBC/Go/python支持新数据类型的映射 | 主要验证DataStudio放开对新增类型编辑限制，数据类型映射及类型名映射正确性等 | 1.新增数据类型主要涉及year、uint1、uint2、uint4、uint8、binary、varbinary、tinyblob、mediumblob、longblob、bool、set、enum等，验证JDBC驱动对新增数据类型及类型名称映射正确性<br>2.验证ODBC驱动对新增数据类型的映射正确性<br>3.验证Go驱动对新增数据类型的映射正确性<br>4.验证Python驱动对新增数据类型的映射正确性 |      |
| 38   | 【openGauss 5.0.0 Release】【M兼容性】distinct支持order by带表达式 | 当order by后的字段在或不在distinct列表中时，order by指定单列或者多列，结合函数及运算符，以及指定asc/desc排序 | 1.order by后跟字段在distinct列表中，order by表达式结合数学运算、函数运算、类型转换函数以及指定asc/desc排序<br/>2.order by后跟字段不在distinct列表中，order by表达式结合数学运算、函数运算、类型转换函数以及指定asc/desc排序 |      |
| 39   | 【openGauss 5.0.0 Release】【M兼容性】支持数据类型显式/隐式转换规则 | 验证数据类型显式/隐式转换时对合法入参和非法入参的处理是否符合预期，验证转换后数据是否正确 | 从不同数据类型的取值范围、类型转换等方面结合系统函数和操作符等方面进行验证 |      |
| 40   | 【openGauss 5.0.0 Release】【M兼容性】导入导出、备份恢复工具支持M兼容性 | 重点验证导入导出、备份恢复工具是否可用及数据是否完整一致     | 1.功能方面验证：<br>1.1 验证支持的对象、数据类型、语法<br>1.2 验证工具支持的参数<br>1.3 验证数据是否完整一致<br>1.4 验证已有的功能是否正常<br>2.可靠性方面验证：<br>2.1 恢复时，节点异常<br>2.2 导入导出同时执行DML操作<br>2.3 事务中，对恢复的表做操作不提交<br>2.4 导入及导出用户权限、文件权限验证<br>2.5 修改、清空导入的文件<br>2.6 频繁执行导入导出；导入导出大数据<br>2.7 主备切换执行导入导出 |      |
| 41   | 【openGauss 5.0.0 Release】M兼容性 full text全文索引         | 主要验证full text全文索引语法与M执行结果是否一致 ，且保证一些特殊场景的应用 | 1.验证在DDL语法中创建全文索引的使用<br/>2.验证在DML查询语法中的使用<br/>3.验证全文索引在单独创建中的使用  |    |
| 42   | 【openGauss 5.0.0 Release】M兼容性 'user'@'host' 用户        | 主要验证 'user'@'host' 用户语法与M执行结果是否一致，且保证一些特殊场景的应用| 1.验证create user username@hostip的语法<br/>2.验证用户名@host方式的认证<br/>3.验证是否可以辨别来自不同主机相同用户名<br/>4.验证多个可匹配时的排序规则<br/>5.支持对象的owner字段支持用户名@host方式指定<br/>6.不支持username带@特殊字符<br/>7.验证兼容性开关对此函数的影响<br/>8.验证username@hostname合理报错  |     |
| 43   | 【openGauss 5.0.0 Release】lock table相关特性                |  主要验证 lock table语法与M执行结果是否一致，且保证一些特殊场景的应用   | 1.验证lock tables name read 语法<br/>2.验证lock table name write 语法<br/>3.验证unlock tables语法<br/>4.验证flush tables with read lock语法<br/>5.验证支持外键和触发器 | |
| 44   | 【openGauss 5.0.0 Release】外键支持关联到普通索引            |  主要验证外键支持关联到普通索引与M执行结果是否一致，且保证一些特殊场景的应用           | 1.验证支持对唯一索引创建外键<br/>2.验证创建非唯一性索引的外键合理报错键<br/>3.验证对唯一索引创建外键，UPDATE之后对表中内容的影响键<br/>4.验证对唯一索引创建外键，DELETE 之后对表中内容的影响<br/>5.验证B_FORMAT模式对唯一索引创建外键的影响<br/> 6.验证B_FORMAT模式对非唯一索引创建外键的影响 |     |
| 45   | 【openGauss 5.0.0 Release】M兼容性 别名支持单引号            |                                                              |                                                              |      |
| 46   | 【openGauss 5.0.0 Release】M兼容性 show status语法           |                                                              |                                                              |      |

## 继承feature/组件测试设计策略

| Domain   | Feature                | 测试策略                                                     |
| -------- | ---------------------- | ------------------------------------------------------------ |
| 接入层   | 应用开发接口           | 继承已有测试能力，支持JDBC、ODBC、PDBC、GDBC驱动             |
|          | 分布式中间件           | 继承已有测试能力，支持应用侧分布式解决方案shardingsphere     |
| SQL层    | 支持SQL语言版本SQL2003 | 继承已有测试能力，支持SQL 2003语言版本                       |
|          | 支持SQL基本语法        | 继承已有测试能力，支持DDL/DML/DCL/DQL语句                    |
|          | 存储过程               | 继承已有测试能力，关注声明语法、基本语句、动态语句、控制语句、事务管理和调试等 |
|          | 系统表和系统视图       | 继承已有测试能力                                             |
|          | DBE_PERF内视图         | 继承已有测试能力，关注OS、Instance、Memory等多个维度划分组织视图，DBE_PERF内视图主要用来诊断性能问题 |
|          | SQL关键字              | 继承已有测试能力，关注保留字和非保留字之分。根据标准，保留字决不能用做其他标识符。非保留字只是在特定的环境里有特殊的含义，而在其他环境里是可以用做标识符的 |
| 存储层   | 索引                   | 继承已有测试能力，支持B Tree索引，Hash索引等                 |
|          | 数据分区               | 继承已有测试能力，支持对分区的组合、交换、拆分、合并等功能；支持范围、列表、哈希等分区类型；支持二级分区 |
|          | 行列混合存储           | 继承已有测试能力，支持行存、列存两种方式，可以在不同的引用场景下选择相应的存储方式 |
|          | 内存表                 | 继承已有测试能力，支持MOT                                    |
|          | 物化视图               | 继承已有测试能力，支持物化视图，物化视图是一种特殊的物理表，物化视图是相对普通视图而言的 |
|          | 全文索引               | 继承已有测试能力，支持单字及词查询，长句子检索；支持中英文混排检索；支持and、or及not的条件组合检索 |
| 管理     | 命令行安装             | 继承已有测试能力，支持OM安装，极简安装和编译安装             |
|          | 版本升级               | 继承已有测试能力，支持数据库软件版本的升级功能，包括就地升级和灰度升级 |
|          | 数据库对象管理         | 继承已有测试能力，支持图形化的方式对模式、表、视图、用户、角色、数据库对象、存储过程、约束、函数、触发器、自增列、大对象等的管理 |
|          | 诊断分析报告           | 继承已有测试能力，支持生成WDR等报告                          |
|          | 智能运维               | 继承已有测试能力，具备智能化运维能力，如智能参数调优、智能索引推荐、慢SQL诊断分析、存储空间智能预测等 |
| 安全     | 身份鉴别               | 继承已有测试能力，支持定义鉴别失败的次数，用户具有唯一标识性 |
|          | 访问控制               | 继承已有测试能力，登录密码存储支持高级别密码存储加密         |
|          | 安全接入               | 继承已有测试能力，具备基于RFC5802机制的口令加密认证方法。加密认证过程中采用单项Hash不可逆加密算法PBKDF2，可防止彩虹攻击 |
|          | 强制访问控制           | 继承已有测试能力，支持强制访问控制：主体粒度达到用户级，客体粒度达到表、视图、触发器等数据库对象级或记录级及列级 |
|          | 安全审计               | 继承已有测试能力，支持安全审计，支持检测安全侵害事件，能将审计数据计入审计日志中 |
|          | 三权分立               | 继承已有测试能力，支持系统管理员、安全管理员和审计管理员角色，三种角色计入审计日志中 |
|          | 数据存储加密           | 继承已有测试能力，支持对用户数据的加密存储或其他有效性的保护措施 |
|          | 全密态数据库           | 继承已有测试能力，支持存储，分析密文数据的数据库系统技术，数据在传输、存储以及计算态均以加密形态存在，整个查询分析过程对用户无感知 |
|          | 动态脱敏               | 继承已有测试能力，支持数据库管理员在数据列上创建动态数据脱敏策略 |
|          | 防篡改功能             | 继承已有测试能力，具备多方共识防篡改、高效防篡改算法、账本数据分布式存储 |
|          | 恶意攻击防范           | 继承已有测试能力，支持system防命令注入，可防止缓冲区溢出；输入有效性检查 |
| 可靠可用 | 物理备份恢复           | 继承已有测试能力，支持物理全量/增量备份能力，还原能力，恢复能力，基于时间点恢复能力 |
|          | 全量PITR物理恢复       | 继承已有测试能力，全量PITR物理恢复                           |
|          | 逻辑导入导出           | 继承已有测试能力，逻辑备份/还原支持对指定库、指定表、指定一组对象（某个模式所属对象）进行备份及还原 |
|          | 延迟备份               | 继承已有测试能力，支持延迟备份                               |
|          | 逻辑复制               | 继承已有测试能力，支持异构数据库间的数据同步                 |
|          | 极致RTO                | 继承已有测试能力，支持快速故障倒换能力，实现RTO<10s          |
| 工具     | 客户端工具             | 继承已有测试能力，支持gsql工具、DS工具                       |
|          | 服务端工具             | 继承已有测试能力，关注gs_cgroupgs_check、gs_checkos、gs_checkperf、gs_collector、gs_dump、gs_dumpall、gs_guc、gs_encrypt、gs_om、gs_plan_simulator、gs_restore、gs_ssh等工具 |
|          | 系统内部使用工具       | 继承已有测试能力，关注gaussdb、gs_backup、gs_basebackup、gs_ctl、gs_expansion、gs_initdb、gs_install、gs_postuninstall、gs_preinstall、gs_dropnode、gs_sshexkey、gs_tar、gs_uninstall、gs_upgradectl、gstrace、pg_recvlogical、gs_probackup 等工具 |
|          | 迁移工具               | 继承已有测试能力，支持全量、增量迁移以及反向迁移             |
|          | 校验工具               | 继承已有测试能力，支持全量、增量数据校验能力                 |
| 兼容     | 数据类型兼容           | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的数据类型 |
|          | 系统函数兼容           | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的系统函数 |
|          | DDL兼容                | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的DDL语法  |
|          | DML兼容                | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的DML语法  |
|          | PL/SQL兼容             | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的PL/SQL语法 |
|          | SHOW语法兼容           | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的SHOW语法 |
|          | 其他语法兼容           | 继承已有测试能力，关注在对应兼容模式下，支持已兼容的其他语法 |

## 专项测试策略

### 安全测试

openGauss社区开源版本需要满足安全基本要求，以达到安全合规，避免安全危机，减少安全事故的目标。openGauss 5.0.0 Release版本的安全测试主要从新特性安全测试、渗透测试和二进制扫描三方面展开，保证openGauss发布版本的安全，提升社区的安全测试能力。

1. 新特性安全测试
2. 渗透测试
3. 二进制测试

| Domain         | 测试策略                                                     |
| -------------- | ------------------------------------------------------------ |
| 新特性安全测试 | 针对交付的新特性进行安全白盒检视，对新特性识别出的安全测试点进行覆盖验收 |
| 渗透测试       | 利用工具进行漏洞扫描、端口扫描、安全编码扫描、敏感信息扫描和Fuzz测试等 |
| 二进制扫描     | 对社区三方件CVE漏洞挖掘，并对新增漏洞确认，修复分支并编译验证；安全编译选项扫描；三方件优选版本扫描；病毒扫描 |

### 可靠性测试

可靠性测试建议覆盖硬件故障/操作系统故障/数据库系统故障/人为因素故障/RTO/工具/长时间负载等7个场景，针对7个场景所需要用到的资源有针对性注入关键配置异常、软件故障和硬件故障，关注大并发下的频繁操作以及长时间的负载压力测试。

在模拟业务压力下，采用故障注入工具模拟故障的注入，在观测系统在故障时的反应，集群监控、告警提示、日志输出是否符合预期。在已出现故障的场景下，观测故障恢复后，数据库集群是否可正常运行，数据有无丢失，主备数据是否一致。

在故障注入后检查故障是否影响数据库运行、检查故障后主备数据库状态是否正常、是否能正常处理SQL、主备服务器数据是否一致，若进程异常退出是否有定位信息；故障恢复后数据库服务是否正常工作、SQL语句是否正常执行，主备数据是否一致。

| Domain         | 测试策略                                                     |
| -------------- | ------------------------------------------------------------ |
| 硬件故障       | 注入CPU、内存、网络和磁盘故障，关注数据库的表现，是否有有效提示，故障消除后数据库是否可回复正常，数据有无丢失，主备数据是否一致 |
| 操作系统故障   | 注入系统时间、端口、文件句柄、信号量、文件目录等故障，关注数据库的表现，是否有有效提示，故障消除后数据库是否可回复正常，数据有无丢失，主备数据是否一致 |
| 数据库系统故障 | 模拟双机故障、事务管理、数据库进程异常退出、高并发大数据量、数据库参数调整等场景，观察数据库的表现，消除故障后数据库可恢复正常，数据有无丢失，主备数据是否一致 |
| 人为因素故障   | 人为破坏系统表、业务执行过程中启停数据库等操作，观察是否有对应日志记录，并且消除故障后数据库可恢复正常，数据有无丢失，主备数据是否一致 |
| RTO            | 开启极致RTO后，构造业务背景，进行数据库停止启动、数据库重启和主备切换等操作，观察数据库是否正常，数据有无丢失，主备数据是否一致 |
| 工具           | 结合备机重建、主备机同步、备份恢复和导入导出等特性，进行硬件/软件故障注入关注数据库表现，是否有有效提示，消除故障后，观察数据库是否正常，数据有无丢失，主备数据是否一致 |
| 长时间负载测试 | 在一主一同步备部署方式下，进行7*24小时的TPC-C稳定性测试，观察系统资源的使用情况，数据有无丢失，主备数据是否一致 |

### 性能测试

性能测试除了关注关键性能指标不劣化外，还需要对新的性能指标进行摸底和测试。利用benckmarksql等工具辅助完成性能测试。

| **指标大项** | **指标小项**                                     | **指标值** | **说明**                              |
| ------------ | ------------------------------------------------ | ---------- | ------------------------------------- |
| TPCC         | 2P（Taishan 200 2280 7260）单节点 1H             | 150万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 7260）单节点 8H             | 150万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 7260）一主一备 1H           | 120万      | 与Release基线数据差异小于5%以内可接受 |
|              | 4P（Taishan 200 2280 7260）单节点 1H             | 230万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 5220）单节点 1H             | 100万      | 与Release基线数据差异小于5%以内可接受 |
|              | 分布式ss-jdbc性能损耗场景                        | 15%        | 与Release基线数据差异小于5%以内可接受 |
|              | 分布式OLTP，2P（Taishan 200 2280 7260）15节点 1H | 1200万     | 此即为release基线                     |
|              | 分布式OLTP，2P（Taishan 200 2280 7260）32节点 1H | 2100万     | 此即为release基线                     |
| RTO          | 一主两同步备failover                             | 10s        | 与Release基线数据差异小于5%以内可接受 |
| 工具链       | 全量迁移                                         | 300MB/s    | 此即为release基线                     |
|              | 增量迁移                                         | 3w tps     | 此即为release基线                     |
|              | 反向迁移                                         | 1w tps     | 此即为release基线                     |
|              | 全量数据校验                                     | 70 MB/s    | 此即为release基线                     |

### 兼容性测试

#### 升级兼容

| Domain     | 测试策略                                                     |
| ---------- | ------------------------------------------------------------ |
| 升级路径   | 1.升级路径<br>--支持openGauss 2.0.0升级到openGauss 5.0.0 Release；<br/>--支持openGauss 2.0.1升级到openGauss 5.0.0 Release；<br/>--支持openGauss 3.0.0升级到openGauss 5.0.0 Release<br/>2.升级失败或者升级未提交，可以回滚到原版本<br>3.故障场景下，环境恢复后升级可以重入并升级成功 |
| 升级兼容性 | 关注升级后特性功能运行正常                                   |

#### 硬件兼容

| Domain       | 测试策略                                                     |
| ------------ | ------------------------------------------------------------ |
| 服务器兼容   | 继承已有测试能力，支持在X86（Intel(R) Xeon(R) Gold）/鲲鹏（Kunpeng 920）服务器上部署 |
| 存储设备兼容 | 继承已有测试能力，支持在本地盘、云盘上部署，支持在SAS，SATA，SSD部署 |

#### 软件兼容

| Domain       | 测试策略                                                     |
| ------------ | ------------------------------------------------------------ |
| 支持云化部署 | 继承已有测试能力，支持容器化部署                             |
| 操作系统兼容 | 继承已有测试能力，支持在X86+openEuler 20.03 LTS、X86+CentOS 7.6、ARM+麒麟V10和ARM+openEuler 20.03 LTS操作系统上部署。新增支持在openGauss 22.03 LTS上部署 |

### 资料测试

明确发布资料的测试策略，明确资料中英文测试策略，如下表格样式供参考：

| **手册名称**   | **覆盖策略**                                                 | **中英文测试策略**                                           |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 《发行说明》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《产品描述》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《技术白皮书》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《特性描述》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《编译指导书》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《快速入门》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《安装指南》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《管理员指南》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《开发者指南》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《工具参考》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |

# 测试执行策略

openGauss 5.0.0 Release版本按照社区release-management团队既定的版本计划，共有9轮测试，按照社区研发模式，所有的需求在2023年2月28日前完成合入。版本计划采取6+4的测试方式，即6轮系统测试+4轮集成验证的策略。

### 测试计划

openGauss 5.0.0 Release版本按照社区开发模式进行运作，结合社区release-management团队指定的版本计划规划相应的测试活动。

| Stage name | Begin time | End time |
| :---- | :---- | :---- |
| Test round 1 | 2023-1-11 | 2023-1-17 |
| Test round 2 | 2023-1-18 | 2023-1-28 |
| Test round 3 | 2023-1-29 | 2023-2-7 |
| Test round 4 | 2023-2-8 | 2023-2-14 |
| Test round 5 | 2023-2-15 | 2023-2-21 |
| Test round 6 | 2023-2-22 | 2023-2-28 |
| Test round 7 | 2023-3-1 | 2023-3-7 |
| Test round 8 | 2023-3-8 | 2023-3-14 |
| Test round 9 | 2023-3-15 | 2023-3-21 |
| Test round 10 | 2023-3-22 | 2023-3-30 |

### 测试重点

#### 测试阶段1：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性的规格验收
2. 通过qa sig组对伙伴同步openGauss 5.0.0 Release测试节奏
3. 继承功能通过自动化看护

#### 测试阶段2：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性的规格验收
3. 回归问题单

#### 测试阶段3：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性的规格验收
2. 专项测试：性能指标测试，防止指标大幅劣化在集成验收阶段才发现，同时有助于界定性能问题出现的阶段
3. 回归问题单

#### 测试阶段4：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性的规格验收
2. 回归问题单
3. 专项测试：安全测试，资料测试

#### 测试阶段5：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性的规格验收
2. 回归问题单
3. 专项测试：安全测试，资料测试

#### 测试阶段6：

1. 评审新特性测试设计，重点关注内核场景化、工具链和兼容性新特性新特性的规格验收
2. 专项测试：兼容性测试（不含升级兼容性测试）
3. 本阶段为集成验证的最后一轮，需要统一审视新特性的规格是否达成

#### 测试阶段7：

1. 进入系统验收阶段，评审新特性测试设计，重点关注兼容性、工具、内核新特性的规格验收
2. 回归问题单
3. 专项测试：可靠性测试（7*24H 负载测试）、资料测试

#### 测试阶段8：

1. 回归问题单
2. 专项测试：可靠性测试（7*24H 负载测试），兼容性测试（升级测试），性能测试，安全测试（二进制扫描），资料测试

#### 测试阶段9：

1. 关注所有交付新特性的验收进展，检查系统集成的完整性和正确性
2. 回归问题单
3. 专项：可靠性测试（7*24H 负载测试），安全测试（CVE漏洞扫描）
4. 启动编写openGauss 5.0.0 Release版本、专项和新特性测试报告

#### 测试阶段10：

1. 关注版本构建，包括数据库的编译安装，社区三方件的编译和其他组件的适配
2. 通过自动化进行版本发布前的验收测试
3. 回归问题单
4. 专项：资料测试
5. openGauss 5.0.0 Release新特性、专项测试报告编写、评审并合入社区。openGauss 5.0.0 Release版本测试报告评审

### 入口标准

1. 所有新需求均按照社区运作方式进入版本
2. 上个测试阶段无阻塞问题遗留
3. 转测版本通过自动化流水线测试，且无阻塞性问题

### 出口标准

1. 测试策略规划的测试活动涉及测试用例100%执行完毕
2. 新特性关键规格达成，继承功能不丢失
3. 可靠性/性能/兼容性等基线数据满足版本规划目标
4. 版本无阻塞性问题遗留，其他问题要有影响分析和相应的规避措施

# 附件

*附件为本测试策略的补充部分*

无
