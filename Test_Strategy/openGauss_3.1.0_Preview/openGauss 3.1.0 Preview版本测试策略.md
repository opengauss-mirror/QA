![avatar](../../images/openGauss.png)

版权所有 © 2022 openGauss社区  您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>
了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

修订记录

| 日期      | 修订版本 | CR号 | 修改  章节                     | 修改描述         | 作者                      |
| --------- | -------- | ---- | ------------------------------ | ---------------- | ------------------------- |
| 2022.8.4  | 1.0      |      |                                | 版本测试策略初稿 | yansong_lee<br>zhangao_za |
| 2022.9.5  | 2.0      |      | 测试分层策略；测试分析设计策略 | 补充相关策略     | yansong_lee               |
| 2022.9.15 | 2.1      |      | 测试分层策略；测试分析设计策略 | 补充相关策略     | yansong_lee               |


目 录

1 概述

>   1.1 版本背景

>   1.2 需求范围

2 风险

3 测试分层策略

4 测试分析设计策略

>   4.1 新增feature测试设计策略

>   4.2 继承feature/组件测试设计策略

>   4.3 专项测试策略

5 测试执行策略

6 附件

**Keywords 关键词**：openGauss 3.1.0 Preview

Abstract 摘要：本文是openGauss 3.1.0 Preview版本的整体测试策略，用于指导该版本测试活动开展

>   缩略语清单：

| 缩略语 | 英文全名                             | 中文解释       |
| ------ | ------------------------------------ | -------------- |
| LTS    | Long time support                    | 长时间维护     |
| CVE    | Common Vulnerabilities and Exposures | 公共漏洞和暴露 |
| SQL    | Structured Query Language            | 结构化查询语言 |
| DML    | Data Manipulation Language           | 数据操纵语言   |
| DDL    | Data Definition Language             | 数据定义语言   |
| DCL    | Data Control Language                | 数据控制语言   |

# <br>概述

openGauss是一款全面友好开放，携手伙伴共同打造的企业级开源关系型数据库。openGauss提供面向多核架构的极致性能、全链路的业务、数据安全、基于AI的调优和高效运维的能力。openGauss具有高性能、高可靠、高安全和易运维等特性，深度融合华为在数据库领域多年的研发经验，结合企业级场景需求，持续构建竞争力特性。

本文主要描述了openGauss 3.1.0 Preview版本测试策略，将于2022年9月30日在openGauss社区发布，按照社区开发模式进行运作，结合社区release-manager团队指定的版本计划规划相应的测试活动。整体策略覆盖新需求、继承需求的测试分析和测试执行，明确各个测试周期的策略及出入口标准，指导后续测试活动。

## 版本背景

openGauss 3.1.0 Preview版本是openGauss第二个创新版本，维护周期为0.5年，面向openGauss的场景化、工具链和兼容性场景，提供更多新特性和功能，给开发者和用户带来全新的体验，服务更多的领域和更多的用户。除了修复bug和cve漏洞外，本次发布的有：

1. 【openGauss 3.1.0 Preview】支持基于共享存储、共享内存的资源池化架构，满足实时一致性的一写多读
2. 【openGauss 3.1.0 Preview】集成openLookeng，提供集群AP能力
3. 【openGauss 3.1.0 Preview】CM管理ShardingSphere Proxy和注册中心，支持异常情况重新拉起
4. 【openGauss 3.1.0 Preview】轻量化版本支持发布订阅功能
5. 【openGauss 3.1.0 Preview】行存表压缩能力增强（高效压缩算法）

等重大特性。

## 需求范围

结合社区release-manager团队制定的[版本计划](https://gitee.com/opengauss/release-management/blob/master/openGauss%203.1.0/%20release-plan.md)，openGauss 3.1.0 Preview版本发布的需求列表如下：

| no   | feature                                                      | status     | sig                | owner |
| ---- | ------------------------------------------------------------ | ---------- | ------------------ | ----- |
| 1    | 【openGauss 3.1.0 Preview】支持基于共享存储、共享内存的资源池化架构，满足实时一致性的一写多读 | Developing | StorageEngine      |       |
| 2    | 【openGauss 3.1.0 Preview】集成openLookeng，提供集群AP能力   | Developing | Plugin             |       |
| 3    | 【openGauss 3.1.0 Preview】CM管理ShardingSphere Proxy和注册中心，支持异常情况重新拉起 | Developing | CM                 |       |
| 4    | 【openGauss 3.1.0 Preview】轻量化版本支持发布订阅功能        | Developing | StorageEngine      |       |
| 5    | 【openGauss 3.1.0 Preview】行存表压缩能力增强（高效压缩算法） | Developing | StorageEngine      |       |
| 6    | 【openGauss 3.1.0 Preview】发布订阅能力增强，支持基础数据同步和备份恢复 | Developing | SQLEngine          |       |
| 7    | 【openGauss 3.1.0 Preview】支持基于主备双集群流式复制的异地容灾方案 | Developing | StorageEngine      |       |
| 8    | 【openGauss 3.1.0 Preview】主机支持记录满足多数派日志的LSN，gs_ctl build支持拒绝目标LSN比此LSN要小的增量build | Developing | StorageEngine      |       |
| 9    | 【openGauss 3.1.0 Preview】CM开放状态查询和推送能力，支持用户应用/中间件感知当前主备角色 | Developing | CM                 |       |
| 10   | 【openGauss 3.1.0 Preview】CM支持用户自定义组件监控和管理    | Developing | CM                 |       |
| 11   | 【openGauss 3.1.0 Preview】DCF策略化多数派                   | Developing | DCF                |       |
| 12   | 【openGauss 3.1.0 Preview】postgresql_fdw执行性能提升，支持聚合和条件下推到远端执行功能 | Developing | Plugin             |       |
| 13   | 【openGauss 3.1.0 Preview】基础算子性能提升                  | Developing | SQLEngine          |       |
| 14   | 【openGauss 3.1.0 Preview】DBMind自治运维平台                | Developing | AI                 |       |
| 15   | 【openGauss 3.1.0 Preview】智能优化器                        | Developing | AI                 |       |
| 16   | 【openGauss 3.1.0 Preview】支持细粒度Any权限增强             | Developing | SecurityTechnology |       |
| 17   | 【openGauss 3.1.0 Preview】MySQL全量迁移性能提升             | Developing | Tools              |       |
| 18   | 【openGauss 3.1.0 Preview】支持MySQL增量迁移                 | Developing | Tools              |       |
| 19   | 【openGauss 3.1.0 Preview】支持数据全量&增量校验             | Developing | Tools              |       |
| 20   | 【openGauss 3.1.0 Preview】数据类型兼容                      | Developing | SQLEngine          |       |
| 21   | 【openGauss 3.1.0 Preview】系统函数兼容                      | Developing | SQLEngine          |       |
| 22   | 【openGauss 3.1.0 Preview】DDL兼容                           | Developing | SQLEngine          |       |
| 23   | 【openGauss 3.1.0 Preview】DML兼容                           | Developing | SQLEngine          |       |
| 24   | 【openGauss 3.1.0 Preview】PL/SQL兼容                        | Developing | SQLEngine          |       |
| 25   | 【openGauss 3.1.0 Preview】SHOW语法兼容                      | Developing | SQLEngine          |       |
| 26   | 【openGauss 3.1.0 Preview】其他语法兼容                      | Developing | SQLEngine          |       |

# 风险

这里可以呈现已识别的影响版本交付的风险，根据版本需求调查、技术分析和物料状况进行汇总，识别出当前版本风险&障碍列举如下：

| 问题类型 | 问题描述                                                     | 问题等级 | 应对措施         | 责任人           | 状态  |
| -------- | ------------------------------------------------------------ | -------- | ---------------- | ---------------- | ----- |
| 需求风险 | 需求未在release-management基线，现有的需求列表和openGauss 3.1.0看板的需求列表不能一一对应 | 高       | 明确需求交付列表 | 版本经理、版本SE | close |

# 测试分层策略

| 序号 | 需求                                                         | 开发主体           | 测试主体 | 验证策略                                                     |
| ---- | ------------------------------------------------------------ | ------------------ | -------- | ------------------------------------------------------------ |
| 1    | 【openGauss 3.1.0 Preview】支持基于共享存储、共享内存的资源池化架构，满足实时一致性的一写多读 | StorageEngine      | QA       | 1、验证数据文件目录按实例和集群拆分及DMS启动分配<br>2、验证页面管理适配及备机一致性读<br>3、验证基础故障恢复及主备切换<br>4、验证pg_controldata、pg_xlogdum p、pagehack工具适配<br>5、验证tpcc with segment=on场景无异常 |
| 2    | 【openGauss 3.1.0 Preview】集成openLookeng，提供集群AP能力   | Plugin             | QA       | 1、验证openLookeng协同部署，获取元数据功能及可靠性测试<br>2、验证openLookeng基础SQL语法及复杂查询结果功能及性能测试<br>3、关注注册中心元数据修改，openLookeng正确获取变更信息，覆盖单表、广播表、分片表等不同类型；验证openLookeng基础SQL语法，包括支持的数据类型、查询语法覆盖、垮库数据关联查询结果准确性及性能 |
| 3    | 【openGauss 3.1.0 Preview】CM管理ShardingSphere Proxy和注册中心，支持异常情况重新拉起 | CM                 | QA       | 1、验证CM集群对ShardingSphere Proxy资源管理和监控的功能和可靠性<br>2、关注自定义资源异常后，CM重新拉起资源的状况 |
| 4    | 【openGauss 3.1.0 Preview】轻量化版本支持发布订阅功能        | StorageEngine      | QA       | 1、验证轻量化版本数据库发布订阅基础功能是否正常<br>2、关注数据库包大小以及空载内存的变化 |
| 5    | 【openGauss 3.1.0 Preview】行存表压缩能力增强（高效压缩算法） | StorageEngine      | QA       | 1、验证行存表压缩功能和压缩效率                              |
| 6    | 【openGauss 3.1.0 Preview】发布订阅能力增强，支持基础数据同步和备份恢复 | SQLEngine          | QA       | 1、验证发布订阅支持同步基础数据<br>2、验证发布订阅与数据库备份恢复等特性交互场景 |
| 7    | 【openGauss 3.1.0 Preview】支持基于主备双集群流式复制的异地容灾方案 | StorageEngine      | QA       | 1、验证支持基于主备的双集群流式复制的异地容灾方案<br/>2、验证灾难及容灾演练场景下的一键式切换，满足RTO<10min |
| 8    | 【openGauss 3.1.0 Preview】主机支持记录满足多数派日志的LSN，gs_ctl build支持拒绝目标LSN比此LSN要小的增量build | StorageEngine      | QA       | 1、验证主机正常或异常停止时重新build进行恢复，关注是否造成数据丢失、是否拒绝目标LSN比此LSN小的增量build<br>2、验证单机模式、同步提交模式、无同步备和最大可用模式等反向场景<br>3、验证新增GUC参数enable_confirm_synced的功能 |
| 9    | 【openGauss 3.1.0 Preview】CM开放状态查询和推送能力，支持用户应用/中间件感知当前主备角色 | CM                 | QA       | 1、验证CM开放状态的查询和推送能力<br>2、验证用户应用/中间件感知当前主备角色的功能和可靠性 |
| 10   | 【openGauss 3.1.0 Preview】CM支持用户自定义组件监控和管理    | CM                 | QA       | 1、验证CM集群对自定义资源（ShardingSphere、Zookeeper和openLookeng）管理的功能和可靠性<br>2、关注存在多种自定义资源时，CM的监控状况 |
| 11   | 【openGauss 3.1.0 Preview】DCF策略化多数派                   | DCF                | QA       | 1、验证支持当某一AZ故障时，另外AZ有可用副本的能力            |
| 12   | 【openGauss 3.1.0 Preview】postgresql_fdw执行性能提升，支持聚合和条件下推到远端执行功能 | Plugin             | QA       | 1、验证插件远程和本地关联操作数据库功能和可靠性，验证资料的有效性<br>2、关注插件使用后性能是否明显提升 |
| 13   | 【openGauss 3.1.0 Preview】基础算子性能提升                  | SQLEngine          | QA       | 1、验证基础算子及代价模型优化后，执行效率提升                |
| 14   | 【openGauss 3.1.0 Preview】DBMind自治运维平台                | AI                 | QA       | 1、验证自制运维平台的端到端能力<br/>2、验证异常检测能力<br/>3、验证增强后的自监控、自诊断和自调优能力 |
| 15   | 【openGauss 3.1.0 Preview】智能优化器                        | AI                 | QA       | 1、验证智能基数估计算法                                      |
| 16   | 【openGauss 3.1.0 Preview】支持细粒度Any权限增强             | SecurityTechnology | QA       | 1、验证新增支持ANY权限的功能                                 |
| 17   | 【openGauss 3.1.0 Preview】MySQL全量迁移性能提升             | Tools              | QA       | 1、验证MySQL全量迁移支持100MB/S                              |
| 18   | 【openGauss 3.1.0 Preview】支持MySQL增量迁移                 | Tools              | QA       | 1、验证支持MySQL增量迁移<br>2、验证增量迁移性能支持3w tps<br>3、验证支持反向迁移，支持迁移后逃生 |
| 19   | 【openGauss 3.1.0 Preview】支持数据全量&增量校验             | Tools              | QA       | 1、验证源端与宿端表结构的一致性，如表结构包含主外键约束等<br>2、验证源端与宿端表数据类型及值的一致性，如时间、整型等数据类型<br>3、验证生成的校验结果文件中的准确性，易用性。如校验结果文件清晰直观，提示正确等<br>4、验证全量校验性能支持30MB/S |
| 20   | 【openGauss 3.1.0 Preview】数据类型兼容                      | SQLEngine          | QA       | 1、通过编译或om安装的方式安装数据库，验证数据类型的功能、性能和资料等<br>2、针对bit/tinyint/smallint/mediumint/int/bigint等类型，从取值范围、无效值、默认值和类型交互等方面进行测试。此外，对于tinyint/smallint/int/bigint四种类型，关注加上unsigned属性后对取值范围和无效值的处理<br/>3、针对date/timestamp[(n)]/datetime[(n)]/year/year(2)/year(4)，从取值范围、无效值、默认值、精度、时区处理和类型交互等方面进行测试<br/>4、针对enum类型，覆盖枚举值的数据类型和长度测试等<br/>5、使用迁移工具，迁移上述数据类型，关注迁移是否成功，迁移后数据类型是否能正常使用 |
| 21   | 【openGauss 3.1.0 Preview】系统函数兼容                      | SQLEngine          | QA       | 1、验证系统函数功能和资料<br/>2、函数有效入参、无效入参验证；返回值验证；函数嵌套使用验证 |
| 22   | 【openGauss 3.1.0 Preview】DDL兼容                           | SQLEngine          | QA       | 1、验证create/update view时设置definer执行成功<br/>2、验证create database时带if not exists执行成功<br/>3、验证drop/alter tablespace带engine执行成功<br/>4、onlineMigration工具验证create/drop/alter column/constraint/index、drop/rename/truncate/alter table语句，是否支持在线迁移<br/>5、chameleon工具验证create/drop/rename/truncate/alter分区表语句、create/drop index/foreign key/unique constraint语句，是否支持在线迁移<br/>6、验证兼容DDL资料描述及示例是否正确 |
| 23   | 【openGauss 3.1.0 Preview】DML兼容                           | SQLEngine          | QA       | 1、验证DML语句兼容后的功能及可靠性<br/>2、关注DML语句的在线、离线迁移功能<br/>3、关注DML语句兼容后的性能指标达成情况<br/>4、关注数据迁移的一致性 |
| 24   | 【openGauss 3.1.0 Preview】PL/SQL兼容                        | SQLEngine          | QA       | 1、兼容PL/SQL中支持使用#符号注释，验证该特性的功能及资料     |
| 25   | 【openGauss 3.1.0 Preview】SHOW语法兼容                      | SQLEngine          | QA       | 1、针对show processlist，验证有无full参数和不同用户权限下的查询表现<br/>2、针对show columns/tables/plugins，验证功能是否正常<br/>3、针对show index，验证索引信息显示是否正常，且与alter table的语法兼容<br/>4、针对show databases/slave hosts/master status/set charset/optimize，验证功能是否正常 |
| 26   | 【openGauss 3.1.0 Preview】其他语法兼容                      | SQLEngine          | QA       | 1、通过编译或om安装的方式安装数据库，验证语法的功能、性能和资料等<br/>2、关注语法是否已兼容；语法功能是否正确；新增语法和已有功能交互使用有无影响 |

# 测试分析设计策略

## 新增feature测试设计策略

| 序号 | Feature                                                      | 重点                                                         | 设计思路                                                     | 备注 |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| 1    | 【openGauss 3.1.0 Preview】支持基于共享存储、共享内存的资源池化架构，满足实时一致性的一写多读 | 验证共享存储架构， 满足一写多读                              | 部署1+2共享存储集群，验证基础功能及基础故障恢复场景，验证tpcc场景无异常 |      |
| 2    | 【openGauss 3.1.0 Preview】集成openLookeng，提供集群AP能力   | 验证openLookeng协同ShardingSphere，对分库分表的openGauss数据库中的数据进行分析，满足openGauss的OLAP能力 | 部署openLookeng系统集群，验证openLookeng数据库基础语法功能和大数据量下的复杂查询功能及性能测试 |      |
| 3    | 【openGauss 3.1.0 Preview】CM管理ShardingSphere Proxy和注册中心，支持异常情况重新拉起 | 验证CM工具对ShardingSphere Proxy的管理能力，满足openGauss集群管理的要求 | 部署包含CM工具的openGauss集群，对CM自定义资源管理进行功能测试和可靠性测试，包含资源异常重新拉起等场景 |      |
| 4    | 【openGauss 3.1.0 Preview】轻量化版本支持发布订阅功能        | 基于轻量化版本验证发布订阅功能，关注集成发布订阅后轻量化版本包大小及空载内存大小 | 安装轻量化数据库，执行发布订阅用例；验证轻量化版本的各规格指标 |      |
| 5    | 【openGauss 3.1.0 Preview】行存表压缩能力增强（高效压缩算法） | 新增高效压缩算法，提升行存表压缩效率和执行性能               | 针对压缩表完成DDL/DML相关语法测试，                          |      |
| 6    | 【openGauss 3.1.0 Preview】发布订阅能力增强，支持基础数据同步和备份恢复 | 验证发布订阅支持基础数据同步和备份恢复                       | 主要进行发布订阅支持基础数据同步和备份恢复测试，且发布订阅继承功能不受影响 |      |
| 7    | 【openGauss 3.1.0 Preview】支持基于主备双集群流式复制的异地容灾方案 | 从组网搭建、基本功能、性能、压力和长稳等方面对流式容灾进行测试 | 1、验证容灾搭建、容灾倒换、灾备升主、灾备解除和灾备查询等基本功能<br/>2、覆盖交互特性测试、性能测试、压力测试、长稳测试和可靠性测试等 |      |
| 8    | 【openGauss 3.1.0 Preview】主机支持记录满足多数派日志的LSN，gs_ctl build支持拒绝目标LSN比此LSN要小的增量build | 验证openGauss一主多备build功能和同步提交功能的增强，验证主机正常或异常停止时是否记录当前达成多数派一致性的位置 | 主要进行功能测试和可靠性测试，包括主机正常停止、主机异常停止、异步备等场景测试 |      |
| 9    | 【openGauss 3.1.0 Preview】CM开放状态查询和推送能力，支持用户应用/中间件感知当前主备角色 | 验证openGauss增强后的一主多备build功能和同步提交功能，验证主机正常或异常停止时是否记录当前达成多数派一致性的位置，验证备机是否能重新build恢复 | 主要进行功能测试和可靠性测试，包括主机正常停止、主机异常停止和异步备等场景的测试 |      |
| 10   | 【openGauss 3.1.0 Preview】CM支持用户自定义组件监控和管理    | 验证CM注册机制、状态查询和推送功能，支持用例/中间件感知当前主备角色的功能 | 部署包含CM工具的openGauss集群，对CM自定义资源管理进行功能测试和可靠性测试，包括资源异常重新拉起等场景 |      |
| 11   | 【openGauss 3.1.0 Preview】DCF策略化多数派                   | 验证支持当某一AZ故障时，另外AZ有可用副本的能力               | 验证参数测试、功能测试、可靠性测试以及其他耦合性测试         |      |
| 12   | 【openGauss 3.1.0 Preview】postgresql_fdw执行性能提升，支持聚合和条件下推到远端执行功能 | 验证插件使用后数据库性能提升率以及聚合、关联操作下推到远程数据库进行操作的功能 | 结合数据库关联查询、远程推送和本地进行测试，包括性能、可靠性等场景 |      |
| 13   | 【openGauss 3.1.0 Preview】基础算子性能提升                  | 验证基础算子及代价模型优化后，在特定从场景下的执行效率提升   | 1、针对PI算子消除、函数依赖、SeqScan底噪消除、分区表页面估算优化和新增选择率模型等性能优化点，覆盖新增优化参数、性能优化场景和hint等功能测试<br/>2、覆盖相关特性交互测试、性能测试和一致性测试等 |      |
| 14   | 【openGauss 3.1.0 Preview】DBMind自治运维平台                | 验证自制运维平台的端到端能力，覆盖功能测试和可靠性测试等     | 1、针对DBMind支持服务化、异常检测等进行功能测试，包括一键式部署、命令接口的正常异常测试<br/>2、覆盖特性交互测试和可靠性测试等 |      |
| 15   | 【openGauss 3.1.0 Preview】智能优化器                        | 验证智能基数估计算法的功能、性能和一致性测试等               | 1、针对智能基数估计、自适应计划选择进行基本功能测试，包括新增参数、模型创建和hint支持等<br/>2、覆盖相关特性交互测试、性能测试和一致性测试等 |      |
| 16   | 【openGauss 3.1.0 Preview】支持细粒度Any权限增强             | 验证新增支持ANY权限的功能、安全和压力测试等                  | 1、针对客户端、赋权对象、权限校验、跨库操作、用户权限、权限传递、新增接口等进行功能测试<br/>2、联合表、索引（包含压缩表和压缩索引）进行特性交互测试<br/>3、覆盖安全测试和压力测试等 |      |
| 17   | 【openGauss 3.1.0 Preview】MySQL全量迁移性能提升             | 验证chameleon工具特定场景下全量迁移性能满足100MB/S           | 1、验证chameleon工具进行全量迁移，openGauss侧查询迁移后的总数据量，结合迁移过程用时计算迁移性能达成目标<br>2、验证MySQL全量迁移支持100MB/S |      |
| 18   | 【openGauss 3.1.0 Preview】支持MySQL增量迁移                 | 验证增量迁移性能支持3w tps，且支持反向迁移，支持迁移后逃生   | 1、验证支持MySQL增量迁移<br/>2、验证增量迁移性能支持3w tps<br/>3、验证支持反向迁移，支持迁移后逃生 |      |
| 19   | 【openGauss 3.1.0 Preview】支持数据全量&增量校验             | 验证源端MySQL表数据与宿端openGauss表数据的一致性及生成的校验结果文件提示的正确性。全量校验性能达到30MB/S | 1、验证源端与宿端表结构一致性。通过在MySQL创建表，包括外键约束、主键约束、唯一、非空约束等。通过chameleon工具进行迁移，迁移完成后，查看表结构是否准确，并用数据校验工具校验，观察是否达到预期结果<br>2、验证源端与宿端的数据类型和数据的一致性，包括二进制、字符、bit类型等、通过工具chameleon工具进行迁移，迁移完成过后查看数据类型及其值是否准确，并用数据校验工具校验，观察是否达到预期结果<br>3、测试生成的结果文件的准确性、直观性 |      |
| 20   | 【openGauss 3.1.0 Preview】数据类型兼容                      | 验证兼容后的数据类型功能和资料                               | 验证数据类型功能是否正确，是否影响已有数据类型               |      |
| 21   | 【openGauss 3.1.0 Preview】系统函数兼容                      | 验证兼容后的函数功能和资料                                   | 验证兼容后的系统函数功能正常                                 |      |
| 22   | 【openGauss 3.1.0 Preview】DDL兼容                           | 1、验证兼容DDL语法功能实现正常，文档资料描述正确<br/>2、验证在线迁移DDL语句 | 1、主要关注DDL语法功能的实现<br/>2、关注在线迁移DDL语句功能的实现 |      |
| 23   | 【openGauss 3.1.0 Preview】DML兼容                           | 1、验证兼容DML语法功能、性能和资料<br/>2、验证在线迁移、离线迁移DML语句 | 1、主要关注DML语法功能的实现<br/>2、性能指标验证<br/>3、关注数据迁移前后的一致性 |      |
| 24   | 【openGauss 3.1.0 Preview】PL/SQL兼容                        | 验证兼容后的PL/SQL功能及资料                                 | 验证兼容PL/SQL中支持使用#符号注释的功能和资料                |      |
| 25   | 【openGauss 3.1.0 Preview】SHOW语法兼容                      | 验证兼容后的SHOW语法的功能和资料                             | 1、针对show processlist，验证有无full参数和不同用户权限下的查询表现<br/>2、针对show columns/tables/plugins，验证功能是否正常<br/>3、针对show index，验证索引信息显示是否正常，且与alter table的语法兼容<br/>4、针对show databases/slave hosts/master status/set charset/optimize，验证功能是否正常 |      |
| 26   | 【openGauss 3.1.0 Preview】其他语法兼容                      | 验证兼容后的其他语法的功能和资料                             | 1、通过编译或om安装的方式安装数据库，验证语法的功能、性能和资料等<br/>2、关注语法是否已兼容；语法功能是否正确；新增语法和已有功能交互使用有无影响 |      |

## 继承feature/组件测试设计策略

| Domain   | Feature                | 测试策略                                                     |
| -------- | ---------------------- | ------------------------------------------------------------ |
| 接入层   | 应用开发接口           | 继承已有测试能力，支持JDBC、ODBC、PDBC、GDBC驱动             |
| SQL层    | 支持SQL语言版本SQL2003 | 继承已有测试能力，支持SQL 2003语言版本                       |
|          | 支持SQL基本语法        | 继承已有测试能力，支持DDL/DML/DCL/DQL语句                    |
|          | 存储过程               | 继承已有测试能力，关注声明语法、基本语句、动态语句、控制语句、事务管理和调试等 |
|          | 系统表和系统视图       | 继承已有测试能力                                             |
|          | DBE_PERF内视图         | 继承已有测试能力，关注OS、Instance、Memory等多个维度划分组织视图，DBE_PERF内视图主要用来诊断性能问题 |
|          | SQL关键字              | 继承已有测试能力，关注保留字和非保留字之分。根据标准，保留字决不能用做其他标识符。非保留字只是在特定的环境里有特殊的含义，而在其他环境里是可以用做标识符的 |
| 存储层   | 索引                   | 继承已有测试能力，支持B Tree索引，Hash索引等                 |
|          | 数据分区               | 继承已有测试能力，支持对分区的组合、交换、拆分、合并等功能；支持范围、列表、哈希等分区类型；支持二级分区 |
|          | 行列混合存储           | 继承已有测试能力，支持行存、列存两种方式，可以在不同的引用场景下选择相应的存储方式 |
|          | 内存表                 | 继承已有测试能力，支持MOT                                    |
|          | 物化视图               | 继承已有测试能力，支持物化视图，物化视图是一种特殊的物理表，物化视图是相对普通视图而言的 |
|          | 全文索引               | 继承已有测试能力，支持单字及词查询，长句子检索；支持中英文混排检索；支持and、or及not的条件组合检索 |
| 管理     | 命令行安装             | 继承已有测试能力，支持OM安装，极简安装和编译安装             |
|          | 版本升级               | 继承已有测试能力，支持数据库软件版本的升级功能，包括就地升级和灰度升级 |
|          | 数据库对象管理         | 继承已有测试能力，支持图形化的方式对模式、表、视图、用户、角色、数据库对象、存储过程、约束、函数、触发器、自增列、大对象等的管理 |
|          | 诊断分析报告           | 继承已有测试能力，支持生成WDR等报告                          |
|          | 智能运维               | 继承已有测试能力，具备智能化运维能力，如智能参数调优、智能索引推荐、慢SQL诊断分析、存储空间智能预测等 |
| 安全     | 身份鉴别               | 继承已有测试能力，支持定义鉴别失败的次数，用户具有唯一标识性 |
|          | 访问控制               | 继承已有测试能力，登录密码存储支持高级别密码存储加密         |
|          | 安全接入               | 继承已有测试能力，具备基于RFC5802机制的口令加密认证方法。加密认证过程中采用单项Hash不可逆加密算法PBKDF2，可防止彩虹攻击 |
|          | 强制访问控制           | 继承已有测试能力，支持强制访问控制：主体粒度达到用户级，客体粒度达到表、视图、触发器等数据库对象级或记录级及列级 |
|          | 安全审计               | 继承已有测试能力，支持安全审计，支持检测安全侵害事件，能将审计数据计入审计日志中 |
|          | 三权分立               | 继承已有测试能力，支持系统管理员、安全管理员和审计管理员角色，三种角色计入审计日志中 |
|          | 数据存储加密           | 继承已有测试能力，支持对用户数据的加密存储或其他有效性的保护措施 |
|          | 全密态数据库           | 继承已有测试能力，支持存储，分析密文数据的数据库系统技术，数据在传输、存储以及计算态均以加密形态存在，整个查询分析过程对用户无感知 |
|          | 动态脱敏               | 继承已有测试能力，支持数据库管理员在数据列上创建动态数据脱敏策略 |
|          | 防篡改功能             | 继承已有测试能力，具备多方共识防篡改、高效防篡改算法、账本数据分布式存储 |
|          | 恶意攻击防范           | 继承已有测试能力，支持system防命令注入，可防止缓冲区溢出；输入有效性检查 |
| 可靠可用 | 物理备份恢复           | 继承已有测试能力，支持物理全量/增量备份能力，还原能力，恢复能力，基于时间点恢复能力 |
|          | 全量PITR物理恢复       | 继承已有测试能力，全量PITR物理恢复                           |
|          | 逻辑导入导出           | 继承已有测试能力，逻辑备份/还原支持对指定库、指定表、指定一组对象（某个模式所属对象）进行备份及还原 |
|          | 延迟备份               | 继承已有测试能力，支持延迟备份                               |
|          | 逻辑复制               | 继承已有测试能力，支持异构数据库间的数据同步                 |
|          | 极致RTO                | 继承已有测试能力，支持快速故障倒换能力，实现RTO<10s          |
| 工具     | 客户端工具             | 继承已有测试能力，支持gsql工具                               |
|          | 服务端工具             | 继承已有测试能力，关注gs_cgroupgs_check、gs_checkos、gs_checkperf、gs_collector、gs_dump、gs_dumpall、gs_guc、gs_encrypt、gs_om、gs_plan_simulator、gs_restore、gs_ssh等工具 |
|          | 系统内部使用工具       | 继承已有测试能力，关注、gaussdb、gs_backup、gs_basebackup、gs_ctl、gs_expansion、gs_initdb、gs_install、gs_postuninstall、gs_preinstall、gs_dropnode、gs_sshexkey、gs_tar、gs_uninstall、gs_upgradectl、gstrace、pg_recvlogical、gs_probackup 等工具 |

## 专项测试策略

### 安全测试

openGauss社区开源版本需要满足安全基本要求，以达到安全合规，避免安全危机，减少安全事故的目标。openGauss 3.1.0版本的安全测试主要从新特性安全测试、渗透测试和二进制扫描三方面展开，保证openGauss发布版本的安全，提升社区的安全测试能力。

1. 新特性安全测试
2. 渗透测试
3. 二进制测试

| Domain         | 测试策略                                                     |
| -------------- | ------------------------------------------------------------ |
| 新特性安全测试 | 针对交付的新特性进行安全白盒检视，对新特性识别出的安全测试点进行覆盖验收 |
| 渗透测试       | 利用工具进行漏洞扫描、端口扫描、安全编码扫描、敏感信息扫描和Fuzz测试等 |
| 二进制扫描     | 对社区三方件CVE漏洞挖掘，并对新增漏洞确认，修复分支并编译验证；安全编译选项扫描；三方件优选版本扫描；病毒扫描 |

### 可靠性测试

可靠性测试建议覆盖硬件故障/操作系统故障/数据库系统故障/人为因素故障/RTO/工具/长时间负载等7个场景，针对7个场景所需要用到的资源有针对性注入关键配置异常、软件故障和硬件故障，关注大并发下的频繁操作以及长时间的负载压力测试。

在模拟业务压力下，采用故障注入工具模拟故障的注入，在观测系统在故障时的反应，集群监控、告警提示、日志输出是否符合预期。在已出现故障的场景下，观测故障恢复后，数据库集群是否可正常运行，数据有无丢失，主备数据是否一致。

在故障注入后检查故障是否影响数据库运行、检查故障后主备数据库状态是否正常、是否能正常处理SQL、主备服务器数据是否一致，若进程异常退出是否有定位信息；故障恢复后数据库服务是否正常工作、SQL语句是否正常执行，主备数据是否一致。

| Domain         | 测试策略                                                     |
| -------------- | ------------------------------------------------------------ |
| 硬件故障       | 注入CPU、内存、网络和磁盘故障，关注数据库的表现，是否有有效提示，故障消除后数据库是否可回复正常，数据有无丢失，主备数据是否一致 |
| 操作系统故障   | 注入系统时间、端口、文件句柄、信号量、文件目录等故障，关注数据库的表现，是否有有效提示，故障消除后数据库是否可回复正常，数据有无丢失，主备数据是否一致 |
| 数据库系统故障 | 模拟双机故障、事务管理、数据库进程异常退出、高并发大数据量、数据库参数调整等场景，观察数据库的表现，消除故障后数据库可恢复正常，数据有无丢失，主备数据是否一致 |
| 人为因素故障   | 人为破坏系统表、业务执行过程中启停数据库等操作，观察是否有对应日志记录，并且消除故障后数据库可恢复正常，数据有无丢失，主备数据是否一致 |
| RTO            | 开启极致RTO后，构造业务背景，进行数据库停止启动、数据库重启和主备切换等操作，观察数据库是否正常，数据有无丢失，主备数据是否一致 |
| 工具           | 结合备机重建、主备机同步、备份恢复和导入导出等特性，进行硬件/软件故障注入关注数据库表现，是否有有效提示，消除故障后，观察数据库是否正常，数据有无丢失，主备数据是否一致 |
| 长时间负载测试 | 在一主一同步备部署方式下，进行7*24小时的TPC-C稳定性测试，观察系统资源的使用情况，数据有无丢失，主备数据是否一致 |

### 性能测试

性能测试除了关注关键性能指标不劣化外，还需要对新的性能指标进行摸底和测试。利用benckmarksql等工具辅助完成性能测试。

| **指标大项** | **指标小项**                                                 | **指标值** | **说明**                              |
| ------------ | ------------------------------------------------------------ | ---------- | ------------------------------------- |
| TPCC         | 2P（Taishan 200 2280 7260）单节点 1H                         | 150万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 7260）单节点 8H                         | 150万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 7260）一主一备 1H                       | 120万      | 与Release基线数据差异小于5%以内可接受 |
|              | 4P（Taishan 200 2280 7260）单节点 1H                         | 230万      | 与Release基线数据差异小于5%以内可接受 |
|              | 2P（Taishan 200 2280 5220）单节点 1H                         | 100万      | 与Release基线数据差异小于5%以内可接受 |
|              | 分布式OLTP，TPCC线性度0.8，2P（Taishan 200 2280 7260）16节点 1H | 1000万     | 与Release基线数据差异小于5%以内可接受 |
| RTO          | 一主两同步备failover                                         | 10s        | 与Release基线数据差异小于5%以内可接受 |

### 兼容性测试

#### 升级兼容

| Domain     | 测试策略                                                     |
| ---------- | ------------------------------------------------------------ |
| 升级路径   | 1.升级路径<br>--支持openGauss 2.0.0升级到openGauss 3.1.0；<br/>--支持openGauss 2.0.1升级到openGauss 3.1.0；<br/>--支持openGauss 3.0.0升级到openGauss 3.1.0<br/>2.升级失败或者升级未提交，可以回滚到原版本<br>3.故障场景下，环境恢复后升级可以重入并升级成功 |
| 升级兼容性 | 关注升级后特性功能运行正常                                   |

#### 硬件兼容

| Domain       | 测试策略                                                     |
| ------------ | ------------------------------------------------------------ |
| 服务器兼容   | 继承已有测试能力，支持在X86（Intel(R) Xeon(R) Gold）/鲲鹏（Kunpeng 920）服务器上部署 |
| 存储设备兼容 | 继承已有测试能力，支持在本地盘、云盘上部署，支持在SAS，SATA，SSD部署 |

#### 软件兼容

| Domain       | 测试策略                                                     |
| ------------ | ------------------------------------------------------------ |
| 支持云化部署 | 继承已有测试能力，支持容器化部署                             |
| 操作系统兼容 | 继承已有测试能力，支持在X86+openEuler 20.03 LTS、X86+CentOS 7.6、ARM+麒麟V10和ARM+openEuler 20.03 LTS操作系统上部署 |

### 资料测试

明确发布资料的测试策略，明确资料中英文测试策略，如下表格样式供参考：

| **手册名称**   | **覆盖策略**                                                 | **中英文测试策略**                                           |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 《发行说明》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《产品描述》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《技术白皮书》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《特性描述》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《编译指导书》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《快速入门》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《安装指南》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《管理员指南》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《开发者指南》 | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |
| 《工具参考》   | 1、可操作性：按照命令描述进行操作。<br>2、文字逻辑：检查其描述的上下文逻辑，有无目标不清，逻辑混乱，信息冗余，导致读者不知所云的问题。<br>3、网页中超链接是否可正常跳转。 | 1、按照资料描述是否可正确操作。<br>2、结合产品实际情况，描述资料的正确性和合理性。<br>3、检查格式问题以及链接跳转是否正常。 |

# 测试执行策略

openGauss 3.1.0 Preview版本按照社区release-management团队既定的版本计划，共有12轮测试，按照社区研发模式，所有的需求在2022年2月20日前完成合入。版本计划分为2个阶段进行测试，每个阶段规划6轮测试，采取3+3的测试方式，即3轮系统测试+3轮集成验证的策略。

### 测试计划

openGauss 3.1.0 Preview版本按照社区开发模式进行运作，结合社区release-management团队指定的版本计划规划相应的测试活动。

| Stage name | Begin time | End time |
| :---- | :---- | :---- |
| Test round 1 | 2022-5-25 | 2022-5-31 |
| Test round 2 | 2022-6-1 | 2022-6-8 |
| Test round 3 | 2022-6-9 | 2022-6-15 |
| Test round 4 | 2022-6-16 | 2022-6-20 |
| Test round 5 | 2022-6-21 | 2022-6-25 |
| Test round 6 | 2022-6-26 | 2022-6-30 |
| Test round 7 | 2022-8-12 | 2022-8-19 |
| Test round 8 | 2022-8-20 | 2022-8-24 |
| Test round 9 | 2022-8-25 | 2022-8-30 |
| Test round 10 | 2022-8-31 | 2022-9-6 |
| Test round 11 | 2022-9-7 | 2022-9-13 |
| Test round 12 | 2022-9-14 | 2022-9-20 |

### 测试重点

#### 测试阶段1：

1. 评审特性测试设计，重点关注兼容性新特性的规格验收
2. 继承功能通过自动化看护

#### 测试阶段2：

1. 评审特性测试设计，重点关注兼容性新特性的规格验收
2. 继承功能通过自动化看护
3. 回归问题单

#### 测试阶段3：

1. 评审特性测试设计，重点关注兼容性、内核和分布式解决方案新特性的规格验收
2. 继承功能通过自动化看护
3. 回归问题单

#### 测试阶段4：

1. 开始撰写新特性测试报告，并建议对新特性进行发散测试
2. 专项测试：安全测试，可靠性测试（包括7*24H长稳测试），资料测试

#### 测试阶段5：

1. 评审新特性测试报告并合入社区
2. 专项测试：兼容性测试（不含升级兼容性测试）,性能测试，资料测试，安全测试

#### 测试阶段6：

1. 通过自动化进行阶段一的验收测试
2. 剩余问题单回归

#### 测试阶段7：

1. 评审特性测试设计，重点关注兼容性新特性的规格验收
2. 继承功能通过自动化看护

#### 测试阶段8：

1. 评审特性测试设计，重点关注兼容性、工具、内核新特性的规格验收
2. 回归问题单
3. 专项测试：安全测试，可靠性测试，资料测试

#### 测试阶段9：

1. 评审特性测试设计，重点关注资源池化新特性的规格验收
2. 回归问题单
3. 专项测试：可靠性测试（7*24H 负载测试），兼容性测试（升级测试），性能测试，安全测试（二进制扫描）

#### 测试阶段10：

1. 关注所有交付新特性的验收进展，进行系统集成验证，检查系统集成的完整性和正确性
2. 回归问题单
3. 启动编写openGauss 3.1.0 Preview版本测试报告和新特性测试报告
4. 专项：可靠性测试（7*24H 负载测试），安全测试（CVE漏洞扫描）

#### 测试阶段11：

1. 关注版本构建，包括数据库的编译安装，社区三方件的编译和其他组件的适配
2. 测试执行动作收尾闭环
3. 回归问题单
4. 专项：资料测试，性能基线数据验收

#### 测试阶段12：

1. 通过自动化进行版本发布前的验收测试
2. 剩余问题单回归
3. openGauss 3.1.0 Preview版本测试报告完善
4. 专项：资料测试

### 入口标准

1. 所有新需求均按照社区运作方式进入版本
2. 上个测试阶段无阻塞问题遗留
3. 转测版本通过自动化流水线测试，且无阻塞性问题

### 出口标准

1. 测试策略规划的测试活动涉及测试用例100%执行完毕
2. 新特性关键规格达成，继承功能不丢失
3. 可靠性/性能/兼容性等基线数据满足版本规划目标
4. 版本无阻塞性问题遗留，其他问题要有影响分析和相应的规避措施

# 附件

*附件为本测试策略的补充部分*

无
