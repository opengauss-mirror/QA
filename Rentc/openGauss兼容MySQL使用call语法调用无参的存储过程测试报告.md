![](../../images/openGauss.png#crop=0&crop=0&crop=1&crop=1&id=n6KaE&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

版权所有 © 2022  openGauss社区<br />您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| --- | --- | --- | --- |
| 2022-09-23 | 1.0 | 测试报告初稿完成 | Rentc |


关键词：

dolphin插件，call，无参存储过程

摘要：

本文档主要介绍openGauss在兼容B库且有dolphin插件的情形下，实现兼容call在调用无参的存储过程和函数可以省略括号直接调用，且可以调用成功。本次测试聚焦定义不同类型的自定义无参函数和无参存储过程，在不同的场景下能否省略括号直接调用。


# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现call在调用无参的存储过程和函数可以省略括号直接调用，其功能及执行结果与mysql侧一致。


# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称 | 测试起始时间 | 测试结束时间 |
| --- | --- | --- |
| mysql 5.7 | 2022-06-20 | 2022-06-25 |
| openGauss 3.0.0 build b410c303 | 2022-06-20 | 2022-06-25 |
| dolphin 1.0 | 2022-06-20 | 2022-06-25 |


描述特性测试的环境信息

| 环境信息 | 配置信息 | 备注 |
| --- | --- | --- |
| 虚拟机 | CPU： Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz 64核  <br />内存：32GB<br />硬盘：100G<br />OS：CentOS Linux release 7.6.1810 (Core) |  |



# 3     测试结论概述


## 3.1   测试整体结论

openGauss兼容mysql共计执行用例15条，主要覆盖了功能测试。功能测试覆盖在创建自定义的无参函数和存储过程，在其中有嵌套各种自定义函数、数据库已有函数和存储过程。函数、存储过程的实现内容包括if loop while loop等条件判断、事务、ddl、dql、dml、exception等。同时包含数据库导入导出和创建新用户调用等场景。目前并未发现缺陷。

| 测试活动 | 活动评价 |
| --- | --- |
| 功能测试 | 存储过程在函数、存储过程中调用，执行结果符合预期 |
| 功能测试 | 在存储过程中添加事务、条件判断、exception等，执行结果符合预期 |
| 功能测试 | 在存储过程，函数中执行ddl、dml操作，执行结果符合预期 |
| 功能测试 | 异常（省略括号）调用有参的存储过程，函数执行结果符合预期，通过 |
| 功能测试 | 异常在不同兼容模式下（TD、PG、Oracle)使用call省略括号调用无参的存储过程 |
| 资料测试 | 资料描述准确，示例的执行结果正确，通过 |



## 3.2   约束说明
1.openGauss需使用兼容B库且有dolphin插件

## 3.3   遗留问题分析

<a name="b6f1e919"></a>
### 3.3.1  遗留问题影响以及规避措施
| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| --- | --- | --- | --- | --- |
| N/A |  |  |  |  |



### 3.3.2  问题统计
|  | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| --- | --- | --- | --- | --- | --- |
| 数目 | 0 | 0 | 0 | <br /> | 0 |
| 百分比 | 100% | 0 | 0 | 100% | 0 |



### 3.3.3  问题单汇总
| 序号 | issue号 | 问题级别 | 问题简述 | 问题状态 |
| --- | --- | --- | --- | --- |



# 4     测试执行


## 4.1   测试执行步骤


### 4.1.1 编译库及插件执行测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 编译库及插件成功，共执行15条用例，<br />未发现bug |


#### 4.1.1.1  存储过程在函数、存储过程中嵌套调用测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 存储过程在函数、存储过程中嵌套调用， | 执行3条用例，执行结果符合 |



#### 4.1.1.2 在存储过程中添加事务、条件判断、exception等结果测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.在存储过程中添加事务、条件判断、exception等 | 执行5条用例，执行结果符合预期 |



#### 4.1.1.3 在存储过程，函数中执行ddl、dml操作结果测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 在存储过程，函数中执行ddl、dml操作 | 执行3条用例，执行结果符合预期 |



#### 4.1.1.4 异常（省略括号）调用有参的存储过程结果测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 异常（省略括号）调用有参的存储过程 | 执行1条用例，执行结果符合预期 |



#### 4.1.1.5 异常在不同兼容模式下（TD、PG、Oracle)使用call省略括号调用无参的存储过程结果测试
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.异常在不同兼容模式下（TD、PG、Oracle)使用call省略括号调用无参的存储过程 | 执行3条用例，执行结果符合预期 |



#### 4.1.1.6 测试函数在文档中的说明是否准确
| 测试步骤 | 测试结果 |
| --- | --- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.  测试函数在文档中的说明是否准确，示例的执行结果是否正确 | 符合预期 |



## 4.2   测试执行统计数据
| 版本名称 | 测试用例数 | 用例执行结果 | 发现问题单数 |
| --- | --- | --- | --- |
| openGauss 3.0.0 build b410c303 | 15 | Passed：15<br />Failed：0 | 0 |


数据说明<br />暂未发现缺陷

## 4.3   后续测试建议
无

# 5     附件
```sql
yat=# create table t_call_(i int,d varchar);
CREATE TABLE
yat=# create or replace procedure proc_call() 
as
begin
insert into t_call_ values(1,'asd');
insert into t_call_ values(2,'biuubi');
insert into t_call_ values(3,'test测试');
update t_call_ set d ='abcdef' where i=1;
delete from t_call_ where i=2;
end;
/
CREATE PROCEDURE
yat=# call proc_call;
 proc_call
 ----------

 (1 rows)
 yat=# select *from t_call_;
  a | d
 --- --------
  3 |test测试
  1 |abcdef
(3 rows)
```
