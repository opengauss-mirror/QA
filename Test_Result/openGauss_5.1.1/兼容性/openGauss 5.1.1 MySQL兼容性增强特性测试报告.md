![avatar](../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述 | 作者   |
| ---------- | ----------- | -------- | ------ |
| 2023.12.23 | v1.0        | 初稿     | 吕林涛 |

 关键词： MySQL兼容性增强，功能测试，资料测试

 

摘要：本文档是对MySQL兼容性增强特性测试说明，包括对本次三个功能点进行MySQL兼容性对比测试，

1.RANDOM_BYTES(len)、rand(N)函数兼容

2.列支持binary/ASCII属性

3.支持16进制格式的数字输入

同时对该兼容性增强的资料进行测试，测试相关功能点使用方法及一些约束条件是否正确添加

 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|        |          |          |
|        |          |          |

# 1     特性概述

该测试需求的目的是支持部分MySQL 5.7语法，增强openGauss的MySQL兼容性，帮助用户达成应用0修改迁移到openGauss的诉求

主要包含三个功能点：

1.RANDOM_BYTES(len)、rand(N)函数兼容

2.列支持binary/ASCII属性

3.支持16进制格式的数字输入

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称       | 测试起始时间 | 测试结束时间 |
| -------------- | ------------ | ------------ |
| openGauss5.1.1 | 2023.11.17   | 2023.12.20   |
| MySQL5.7       | 2023.11.17   | 2023.12.20   |
|                |              |              |

描述特性测试的硬件环境信息

| 环境信息 | 配置信息                     | 备注 |
| -------- | ---------------------------- | ---- |
| 虚拟机   | openGauss5.1.1、MySQL 5.7.36 |      |

# 3     测试结论概述

## 3.1   测试整体结论

MySQL兼容性增强特性，共计执行22个用例，主要覆盖功能测试和资料测试，通过手动执行用例，未发现功能问题，资料测试发现问题已解决，回归通过，无遗留风险，整体质量良好；

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 功能测试与需求相符，对于边界值等异常情况给出合理报错，执行结果符合预期，通过 |
| 资料测试 | 资料描述与需求基本相符，在CREATE-TABLE相关说明中未补充对BINARY/ASCII属性的支持，相关单号[18O1UM](https://e.gitee.com/opengaussorg/issues/list?issue=I8O1UM)，其他资料与需求点一一对应，通过 |

## 3.2   约束说明

特性使用时涉及到的约束及限制条件

RANDOM_BYTES函数入参取值范围为[1,1024]，超范围直接报错，入参为NULL时返回NULL；

RAND函数返回值范围为[0，1)。参数取值范围为[-2^63,2^64-1]。入参为NULL时等价于入参为0；

BINARY/ASCII属性实现，ASCII属性实际为“character set latin1”，但当前实际上指定列的字符集为“latin1”会报错（原始设计如此），本需求不处理此问题，所以如果给列赋ASCII属性，虽然语法能通过，但实际会报错。

支持16进制输入，不同于MySQL。当数字个数为奇数时，不会自动补0。当前openGauss的XCONST表现与MySQL的0x不完全一致，需要通过SQL_MODE控制（其他同事开发，具体表现不一致不在本需求覆盖）。需要注意，MySQL侧不支持0x、0x123G、0xG123这种非法输入，但是在openGauss侧，由于在词法分析时，两个词可以不用空格分隔，所以对于上述三种特殊场景，openGauss实际会识别成select 0 x; select 0x123 G;select 0 xG123;而不会直接报错

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 0    | 0    | 1      |
| 百分比 | 100%     | 0%   | 0%   | 0%   | 100%   |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题描述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [18O1UM](https://e.gitee.com/opengaussorg/issues/list?issue=I8O1UM) | 不重要   | dolphin-CREATE-TABLE说明资料中未添加对ASCII和BINARY的支持说明 | 已回归   |



# 4     测试执行

## 4.1测试执行步骤

### 4.1.1 RANDOM_BYTES(len)、rand(N)函数兼容执行测试

| 测试步骤                                                     | 测试结果                     |
| ------------------------------------------------------------ | ---------------------------- |
| 1.创建兼容B库并安装dolphin插件<br>2.执行RANDOM_BYTES(len)、rand(N)函数用例 | 共执行16个用例，共发现0个bug |

### 4.1.2 列支持binary/ASCII属性执行测试

| 测试步骤                                                     | 测试结果                    |
| ------------------------------------------------------------ | --------------------------- |
| 1.创建兼容B库并安装dolphin插件<br>2.执行列支持binary/ASCII属性用例 | 共执行4个用例，共发现0个bug |

### 4.1.3 支持16进制格式的数字输入执行测试

| 测试步骤                                                     | 测试结果                    |
| ------------------------------------------------------------ | --------------------------- |
| 1.创建兼容B库并安装dolphin插件<br>2.执行16进制格式的数字输入用例 | 共执行2个用例，共发现0个bug |

### 4.1.4 三个功能点自动化用例执行测试

| 测试步骤                                                     | 测试结果                     |
| ------------------------------------------------------------ | ---------------------------- |
| 1.使用yat测试框架配置JDBC连接<br>2.执行RANDOM_BYTES(len)、rand(N)函数用例<br>3.执行列支持binary/ASCII属性用例<br/>4.执行16进制格式的数字输入用例 | 共执行22个用例，共发现0个bug |



## 4.2   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称       | 测试用例数 | 用例执行结果       | 发现问题单数 |
| -------------- | ---------- | ------------------ | ------------ |
| openGauss5.1.1 | 22         | Passed:22 Failed:0 | 1            |

*数据项说明：*

1.累计发现问题单1个

2.修改代码量为0.996kloc， 缺陷密度为1.004个/kloc

## 4.2   后续测试建议

后续测试需要关注点：

1.BINARY/ASCII属性实现中，ASCII属性实际为“character set latin1”，但当前实际上指定列的字符集为“latin1”会报错，待后续此部分功能实现，补充此处的测试

# 5     附件

5.1 源代码及文档PR

MySQL兼容性增强源代码合入PR：

https://gitee.com/opengauss/Plugin/pulls/1115

MySQL兼容性增强源文档合入PR：

https://gitee.com/opengauss/docs/pulls/5914

5.2 示例

select RANDOM_BYTES(1);

select rand(1);

CREATE TABLE t(

 c1 TEXT BINARY

) CHARACTER SET utf8mb4;

 



 

 