![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述           | 作者       |
| ---------- | ----------- | ------------------ | ---------- |
| 2023-12-5  | 1.0         | 特性测试报告初版   | lichunlong |
| 2023-12-10 | 2.0         | 增加第二轮测试结果 | lichunlong |

 关键词： 

 backup，restore

摘要：

 资源池化适配gs_probackup，支持全量备份、增量备份、合并、删除、恢复、验证等全量功能。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

gs_probackup是一个用于管理openGauss数据库物理备份和恢复的工具，本特性实现资源池化适配gs_probackup工具，支持全量备份、 增量备份、合并、删除、恢复、验证等全量功能。

# 2     特性测试信息

测试版本

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.1 build 6460c491 | 2023-11-22   | 2023-12-1    |
| openGauss 5.1.1 build 01b191f0 | 2023-12-07   | 2023-12-10   |

环境信息

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 物理机   | CPU：Kunpeng 920 7260 2p 128核<br />内存：24*32GB<br />硬盘：NVME 3T * 4<br />OS：openEuler release 20.03 (LTS)<br />文件系统：XFS<br />网卡：10GE |      |

# 3     测试结论概述

## 3.1   测试整体结论

资源池化适配gs_probackup，支持备份恢复特性，共执行83个用例，主要覆盖了功能测试、可靠性测试、长稳测试、性能测试以及文档验证。功能测试覆盖：全量、增量备份和恢复，备份集的删除、合并以及验证等功能；可靠性测试覆盖：在备份恢复过程中对DN进程、gs_probackup进程注入故障测试；长稳测试在长稳流水线中增加备份任务；性能测试使用1000仓tpcc数据进行备份恢复，备份恢复时间保持在4-5分钟以内。测试过程中累计发现4个问题，特性质量一般。

| 测试活动   | 活动评价                                                     |
| ---------- | ------------------------------------------------------------ |
| 功能测试   | 全量、增量备份、恢复、合并、删除和验证功能验证符合预期，通过 |
| 可靠性测试 | 备份恢复过程中注入故障，测试结果符合预期，通过               |
| 长稳测试   | 7*24小时长稳测试，通过                                       |
| 性能测试   | 1000仓tpcc数据进行备份恢复，备份/恢复保持在4-5分钟           |
| 资料测试   | 资料描述准确，约束覆盖全面，整体质量良好                     |

## 3.2   约束说明

需在资源池化模式下使用，在配置文件中指定enable_dss参数并配置磁阵环境。 

增量备份需设置参数enable_cbm_tracking=on。 

需在进行增量备份、备份合并、增量恢复之前需要有完整的全量备份，且两者压缩算法一致。 

其余约束见[gs_probackup文档](https://docs-opengauss.osinfra.cn/zh/docs/latest/docs/ToolandCommandReference/gs_probackup.html)。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 0    | 2    | 1    | 1      |
| 百分比 | 100%     | 0%   | 50%  | 25%  | 25%    |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I8J6FC](https://e.gitee.com/opengaussorg/issues/table?issue=I8J6FC) | 主要     | 【资源池化】debug版本，资源池化集群修改，设置enable_cbm_tracking=on后，主备切换发生coredump | 已验收   |
| 2    | [I8JT33](https://e.gitee.com/opengaussorg/issues/table?tab=files&issue=I8JT33) | 主要     | 【资源池化】debug版本，资源池化集群，执行tpcc业务过程中执行备份失败 | 已验收   |
| 3    | [I8KLML](https://e.gitee.com/opengaussorg/issues/table?tab=files&issue=I8KLML) | 不重要   | 【资源池化】资源池化gs_probackup资料不准确                   | 已验收   |
| 4    | [I8KSEF](https://e.gitee.com/opengaussorg/issues/table?issue=I8KSEF) | 次要     | 【资源池化】gs_probackup执行恢复之后，执行增量备份报错       | 已验收   |



# 4     测试执行

## 4.1   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果         | 发现问题单数 |
| ------------------------------ | ---------- | -------------------- | ------------ |
| openGauss 5.1.1 build 6460c491 | 83         | Passed：77 Failed: 6 | 4            |
| openGauss 5.1.1 build 01b191f0 | 10         | Passed：10 Failed: 0 | 0            |

*数据项说明：*

1. 测试过程中共发现4个缺陷，1个问题转为修改资料，共计2个资料单不计入代码缺陷密度计算，剩余一个问题已验收通过。
2. 缺陷密度为 2(缺陷个数)/0.518k(代码行数)=3.86(个/kloc)。

## 4.2   后续测试建议

无

# 5     附件

gs_probackup工具资源池化集群全量恢复流程简化脚本：

https://gitee.com/opengauss/blog/blob/f47793a0d96329cb5c7d218524acdb70dff4efe4/app/zh/blogs/liuzhanfeng/gs_probackup%E5%85%A8%E9%87%8F%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B%E7%AE%80%E5%8C%96%E8%84%9A%E6%9C%AC.md

 



 

 
