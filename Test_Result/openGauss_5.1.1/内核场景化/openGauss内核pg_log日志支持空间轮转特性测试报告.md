![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订版本 | 修改描述           | 作者  |
| ---------- | -------- | ------------------ | ----- |
| 2023/11/29 | 1.0      | 特性报告初稿完成   | lixin |
| 2023/12/14 | 1.1      | 增加第二轮测试结果 | lixin |

关键词：pg_log，log_max_size，日志

摘要：本文档主要介绍openGauss内核pg_log日志支持空间轮转特性测试 ，主要包含log_max_size参数设置测试、pg_log日志空间轮转功能验证，及与其他业务交互场景测试等，并给出最终测试结论。

缩略语清单：

| 缩略语    | 英文全名  | 中文解释          |
| --------- | --------- | ----------------- |
|NA |  | |

# 1     特性概述

该特性主要旨在让openGauss支持固定日志空间设置，在此空间范围内支持日志轮转使用，保证openGauss的日志不会因为长时间的使用导致磁盘被占用满。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.1 build 6460c491 | 2023-11-24   | 2023-11-29   |
| openGauss 5.1.1 build 01b191f0 | 2023-12-11   | 2023-12-11   |

| 环境信息 | 配置信息                                                     | 备注          |
| -------- | ------------------------------------------------------------ | ------------- |
| 虚拟机   | Inter(R) Xeon(R) Gold 6278C CPU @ 2.60GHz 4核<br/>内存：8GB<br/>硬盘：220GB<br/>OS：openEuler release 20.03(LTS) | 安装openGauss |

# 3     测试结论概述

## 3.1   测试整体结论

共设计22个测试用例，主要包含log_max_size参数设置测试、pg_log日志空间轮转功能验证，及与其他业务交互场景测试等。发现2个问题，一个非问题已取消，另一个已修复并验收通过，整体质量良好。

| 测试活动 | 活动评价                                       |
| -------- | ---------------------------------------------- |
| 功能测试 | log_max_size参数设置测试                       |
| 功能测试 | pg_log日志空间轮转功能验证                     |
| 功能测试 | 与其他业务交互场景测试                         |
| 资料测试 | 官方文档已更新参数相关资料，描述清晰，示例正确 |

## 3.2   约束说明

- log_max_size当前仅对pg_log日志生效

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 0    | 1    | 0      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                                     | 状态   |
| ---- | ------------------------------------------------------------ | ---- | ------------------------------------------------------------ | ------ |
| 1    | [I8JT00](https://gitee.com/opengauss/openGauss-server/issues/I8JT00?from=project-issue) | 次要 | 【测试类型：SQL功能】【测试版本：5.1.1】修改pg_log日志文件名后，log_max_size参数控制失效，log_rotation_size参数控制失效 | 已验收 |
| 2    | [I8NGRU](https://gitee.com/opengauss/openGauss-server/issues/I8NGRU?from=project-issue) | 次要 | 【测试类型：SQL功能】【测试版本：5.1.1】设置日志按照星期写入对应文件，日志生成过程中，切换系统时间，出现同一日期日志写入不同星期日志文件 | 已取消 |

# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 log_max_size参数设置测试

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1. 使用gs_guc set/reload、alter system set等方式设置log_max_size参数，覆盖设置方式及有效参数值、无效参数值<br />2. 恢复参数默认值 | 执行8条用例，执行通过，未发现缺陷 |

### 4.1.2 pg_log日志空间轮转功能验证

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1. 打开参数，执行业务，查看日志，验证日志空间轮转功能<br />2. 反复修改log_max_size，日志大小随参数值控制，稳定在参数值附近，删除日志后数据库状态无影响<br />3. 恢复环境 | 执行4条用例，执行通过，未发现缺陷 |

### 4.1.3 与其他业务交互场景测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 开启pg_log日志空间轮转功能，测试其与修改日志目录、修改日志权限、修改日志名、覆写方式写入日志、csvlog、cm清理日志等功能同时开启，功能正常不冲突，数据库状态无影响<br />2. 清理环境 | 执行10条用例，4个用例执行失败，提交2个缺陷，1个非问题已取消，另一个已修复并验证通过 |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果             | 发现问题单数 |
| ------------------------------ | ---------- | ------------------------ | ------------ |
| openGauss 5.1.0 build 6460c491 | 22 | Passed：18<br>Failed：4<br />Unavaliable：0 | 1       |
| openGauss 5.1.0 build 01b191f0 | 4 | Passed：4<br/>Failed：0<br />Unavaliable：0 | 0 |

*数据项说明：*

1.测试过程中共发现有效问题1个，已修复并验收通过

2.缺陷密度为 1(缺陷个数)/0.233k(代码行数)=4.29(个/kloc)。

## 4.3   后续测试建议

无

# **5     附件**

无

****

