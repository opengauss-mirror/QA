修订记录

| 日期           | 修订   版本 | 修改描述                 | 作者   |
| -------------- | ----------- | ------------------------ | ------ |
| 2023年12月29日 | 1.0         | 测试报告初次编写         | 魏亚军 |
| 2023年1月15日  | 1.1         | 增加测试步骤             | 魏亚军 |
| 2023年1月16日  | 1.2         | 修改内部评审存在部分问题 | 魏亚军 |

 关键词： 

 步长、循环、最小值、最大值、起始值、下一个值、缓存值、属主

摘要：

 对OpenGauss新增需求“支持对序列的修改”进行功能测试

# 1     特性概述

后台启用对序列各项属性的修改功能，包括对序列步长、是否循环、最大值、最小值、起始值、当前值、缓存值和属主的修改。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称 | 测试轮次 | 测试起始时间   | 测试结束时间   |
| -------- | -------- | -------------- | -------------- |
| 5.1.1    | 第一轮   | 2023年12月20日 | 2023年12月29日 |
| 5.1.1    | 第二轮   | 2024年1月2日   | 2024年1月15日  |

描述特性测试的硬件环境信息

| 环境信息 | 配置信息                        | 备注 |
| -------- | ------------------------------- | ---- |
| CPU      | 8核                             | 无   |
| 操作系统 | Kylin Linux Advanced Server V10 | 无   |
| 内存     | 16G                             | 无   |
| 磁盘     | 128G                            | 无   |

# 3     测试结论概述

## 3.1   测试整体结论

支持对序列的修改，共执行107条用例，主要覆盖修改各属性的功能测试，累计发现缺陷单2个，均已解决并验收通过，整体质量良好。

| 测试活动               | 活动评价                                                     |
| ---------------------- | :----------------------------------------------------------- |
| 修改序列步长           | 分别测试sequence和large sequence修改步长，测试通过。         |
| 修改序列是否循环       | 分别测试sequence和large sequence修改是否循环，测试通过。     |
| 修改序列最小值         | 分别测试sequence和large sequence修改最小值，测试通过。       |
| 修改序列最大值         | 分别测试sequence和large sequence修改最大值，测试通过。       |
| 修改序列起始值         | 分别测试sequence和large sequence修改起始值，测试通过         |
| 修改序列下一个值       | 分别测试sequence和large sequence修改序列的下一个值， 测试通过 |
| 修改序列缓存值         | 分别测试sequence和large sequence修改序列缓存值，测试通过。   |
| 修改序列属主           | 分别测试sequence和large sequence修改序列属主，测试通过。     |
| 属性组合修改           | 分别测试sequence和large sequence属性两两组合修改，测试通过   |
| 权限管理是否有效       | 分别测试sequence和large sequence不具备alter权限的用户是否可以修改序列、grant和revoke是否可以正常限制alter权限，测试通过 |
| 其他对象引用序列的修改 | 分别测试sequence和large sequence被serial类型引用、列归属、表引用、函数和存储过程引用的序列修改及调用是否正常，测试通过 |
| 并发修改序列属性       | 分别测试sequence和large sequence在并发情况下修改序列属性，开启事务，手动执行 |
| 在线升级修改序列       | 在升级时分别修改sequence和large sequence属性，查看升级成功时是否commit，回滚版本后是否随之回滚，提交升级后是否commit |

## 3.2   约束说明

特性无约束

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无遗留问题。

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 2        | 0    | 1    | 1    | 0      |
| 百分比 | 100%     | 0%   | 50%  | 50%  | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号    | 问题级别 | 问题简述                                      | 问题状态 |
| ---- | ---------- | -------- | --------------------------------------------- | -------- |
| 1    | [I8VD2N]() | 主要     | 报错中起始值和当前值都是RESTART value，不合理 | 已验收   |
| 2    | [I8TH65]() | 次要     | 不允许在事务中修改序列最大值                  | 已验收   |

# 4     测试执行

## 4.1 测试执行步骤

### 4.1.1 修改序列步长

| 测试步骤：                                                   | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence步长由大改小、小改大和事务中修改，进行非常规字段的异常测试 | 执行10条用例，未发现bug |

### 4.1.2 修改序列是否循环

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence由循环改非循环、非循环改循环和事务中修改，进行非常规字段的异常测试 | 执行8条用例，未发现bug |

### 4.1.3 修改序列最小值

| 测试步骤：                                                   | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改最小值大于当前最小值，小于当前最小值，修改为没有最小值，事务中修改和非常规字段、最小值大于当前值、最小值大于最大值的异常测试 | 执行14条用例，未发现bug |

### 4.1.4 修改序列最大值

| 测试步骤：                                                   | 测试结果                              |
| ------------------------------------------------------------ | ------------------------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改最大值大于当前最大值，小于当前最大值，修改为没有最大值，事务中修改和非常规字段、最大值小于当前值、最大值小于最小值的异常测试 | 执行14条用例，发现一个bug，已验收通过 |

### 4.1.5 修改序列起始值

| 测试步骤：                                                   | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改起始值大于、小于当前起始值、在事务中修改和修改起始值大于最大值、小于最小值、异常字段的异常测试 | 执行14条用例，未发现bug |

### 4.1.6 修改序列下一个值

| 测试步骤：                                                   | 测试结果                              |
| ------------------------------------------------------------ | ------------------------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改序列的下一个值、事务中修改和修改下一个值大于最大值，小于最小值、非常规字段的异常测试 | 执行10条用例，发现一个bug，已验收通过 |

### 4.1.7 修改序列缓存值

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改序列缓存值由1改为非1、非1改为1、事务中修改和cache为1时多并发、cache不为1时会话退出、后台宕机、序列属性修改、多会话并发其他会话修改序列属性，造成序列空洞的异常测试 | 执行8条用例，未发现bug |

### 4.1.8 修改序列属主

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence修改序列属主、事务中修改和修改属主为不存在用户、非常规字段的异常测试 | 执行8条用例，未发现bug |

### 4.1.9 属性组合修改

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence属性两两组合修改、三个属性组合修改、全部属性组合修改 | 执行6条用例，未发现bug |

### 4.1.10 权限管理是否有效

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence不具备alter权限的用户是否可以修改序列、grant和revoke是否可以正常限制alter权限 | 执行2条用例，未发现bug |

### 4.1.11 其他对象引用序列的修改

| 测试步骤：                                                   | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 1. 使用yat工具自动化执行测试用例，分别测试sequence和large sequence被serial类型引用、列归属、表引用、函数和存储过程引用的序列修改及调用是否正常 | 执行10条用例，未发现bug |

### 4.1.12 并发修改序列属性

| 测试步骤：                                                   | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1. 开启两个窗口，手动开启事务，同时修改序列属性，在第一个session事务提交之前，会阻塞其他session的序列属性修改，待第一个session事务提交后，第二个session被释放，成功修改，符合预期，测试通过。 | 执行1条用例，未发现bug |

### 4.1.13 在线升级修改序列

| 测试步骤：                                                   | 测试结果               |
| :----------------------------------------------------------- | ---------------------- |
| 1. 使用gs_updatactl工具执行数据库在线升级，在升级的时候执行序列属性的修改，更新完成后序列修改是否生效，执行版本回滚，验证回滚后序列属性是否也回滚，执行提交更新，验证提交更新后序列修改是否生效。符合预期，测试通过。 | 执行2条用例，未发现bug |

## 4.2   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称 | 测试用例数 | 用例执行结果       | 发现问题单数 |
| -------- | ---------- | ------------------ | ------------ |
| 5.1.1    | 107        | 执行成功且符合预期 | 2            |

*数据项说明：*

- 累计发现缺陷单2个，2个已解决并验收通过。


- 缺陷密度为2个(缺陷个数)/0.016kloc(代码行数)=125(个/kloc)

## 4.2   后续测试建议

无

# 5     附件

需求：https://e.gitee.com/opengaussorg/projects/545985/requirements/table?issue=I85TQZ&issue_detail_tab=link-pull-request

开发自验结果：https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-server/pulls/4376

功能说明：https://e.gitee.com/opengaussorg/repos/opengauss/docs/pulls/6019