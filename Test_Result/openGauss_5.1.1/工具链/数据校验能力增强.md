![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述           | 作者     |
| :--------- | ----------- | ------------------ | -------- |
| 2023-12-14 | 1.0         | 特性测试报告初稿完 | lihongji |

 关键词： 

openGauss、以分片为粒度进行校验

摘要：

本文档主要介绍数据校验能力增强测试报告

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

针对大表数据时，按照大表分片规则并行读取数据，以分片粒度进行校验，汇总各分片数据校验结果为当前表的校验结果

# 2     特性测试信息

| 版本名称   | 测试起始时间 | 测试结束时间 |
| ---------- | ------------ | ------------ |
| M*  5.7.27 | 2023-11-16   | 2023-12-13   |

| 硬件型号          | 硬件配置信息                                                 | 备注                |
| ----------------- | ------------------------------------------------------------ | ------------------- |
| aarch64+openEuler | CPU：Kunpeng-920 2600MHz<br/>内存：765GB<br/>硬盘：3TB<br/>OS：openEuler release 20.03 (LTS-SP1) | 部署openGauss数据库 |
| aarch64+openEuler | CPU：Kunpeng-920  2600MHz<br/>内存：765GB<br/>硬盘：3TB<br/>OS：openEuler release 20.03 (LTS-SP1) | 部署校验工具、kafka |
| aarch64+openEuler | CPU：Kunpeng-920  2600MHz<br/>内存：765GB<br/>硬盘：3TB<br/>OS：openEuler release 20.03 (LTS-SP1) | 部署M*数据库        |

# 3     测试结论概述

## 3.1   测试整体结论

​        数据校验能力增强，以分片粒度进行数据校验。累计发现缺陷单4个，其中已验收4个，整体质量良好。

## 3.2   约束说明

-  M\*5.7版本
-  jdk11以上
-  kakfa 2.13-2.81

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 |
| -------- | -------- |
| NA       |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 0    | 0    | 4    | 0      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I8B4JO](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I8B4JO?from=project-issue) | 次要     | 每张表100w数据，分片数为5。openauss侧多数据校验结果不准确    | 已验收   |
| 2    | [I8BAR9](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I8BAR9?from=project-issue) | 次要     | M*与openGauss数据总条数一致、分片数一致，当update部分数据，repair结果文件无内容 | 已验收   |
| 3    | [I8BNVM](https://e.gitee.com/opengaussorg/dashboard?issue=I8BNVM) | 次要     | 全量数据校验结果文件，统计的行数与校验前配置的校验行数不一致 | 已验收   |
| 4    | [I8B65K](https://e.gitee.com/opengaussorg/dashboard?issue=I8B65K) | 次要     | 当M\*表a有数据，openGauss对应的表a没数据。宿端抽取服务报错，未生成校验结果文件 | 已验收   |

# 4     测试执行

##  4.1 功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.验证M\*与openGauss分片数不相同的场景，例如：分片数M\*>OG、分片数M\*<OG <br/>2.验证openGauss表对象缺失、新增场景<br/>3.验证待校验的表的数据条数小于、等于以及大于1个分片的数据量的场景 | 执行65条用例，执行结果符合预期，测试通过.累计发现个bug4个，4个问题已解决回归通过 |

## 4.2 性能测试

| 测试步骤                                                     | 测试结果                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 1.sybench预置50张表、每张表1000w数据至M\*<br/>2.单个分片设置为10w行<br/>3.启动数据校验工具 | 执行1条用例，性能速率达20w 条/s。测试通过，未发现bug |

## 4.3 可靠性测试

| 测试步骤                                                     | 测试结果                                           |
| ------------------------------------------------------------ | -------------------------------------------------- |
| 1.datachecker工具所在虚拟机注入网络延时、网络闪断、cpu80%故障 | 执行3条用例，执行结果符合预期，测试通过，未发现bug |

## 4.4资料测试

| 测试步骤：                               | 测试结果           |
| ---------------------------------------- | ------------------ |
| 1.校验资料的描述及示例的执行结果是否成功 | 资料一致性测试通过 |



## 4.5  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果             | 发现问题单数 |
| ------------------------------ | ---------- | ------------------------ | ------------ |
| openGauss 5.1.1 build 016e33c1 | 69         | Passed：55<br>Failed：14 | 4            |
| openGauss 5.1.1 build 1e74d4f2 | 14         | Passed：14<br/>Failed：0 | 0            |

**数据项说明：**

* 第一阶段累计发现缺陷单4个，已验收4个
* 缺陷密度为4个(缺陷个数)/0.178kloc(代码行数)=22.47(个/kloc)

## 4.6   后续测试建议

暂无

# 5     附件

```
单表分片数=单表数据总数/每个分片的数据总数
注：每个分片的数据总数在application-sink.yml、application-source.yml文件的参数maximum-table-slice-size中配置

```



##  

