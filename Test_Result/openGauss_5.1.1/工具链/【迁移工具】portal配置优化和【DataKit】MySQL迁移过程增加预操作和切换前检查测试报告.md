

版权所有 © 2023 openGauss社区 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[https://creativecommons.org/licenses/by-sa/4.0/](https://gitee.com/link?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-sa%2F4.0%2F) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[https://creativecommons.org/licenses/by-sa/4.0/legalcode。](https://gitee.com/link?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-sa%2F4.0%2Flegalcode%E3%80%82)

修订记录

| 日期       | 修订 版本 | 修改描述 | 作者        |
| ---------- | --------- | -------- | ----------- |
| 2023-11-15 | V1.0      | 初稿     | houshaolong |

关键词：

portal配置优化、mysql迁移、预操作检查

摘要：

本文档主要介绍portal配置优化和Mysql迁移过程增加预操作和切换前检擦功能，并给出最终测试结论。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| N/A    | N/A      | N/A      |

# 1 特性概述

## 1.1 【迁移工具】portal配置优化

该特性可优化Datakit->portal->工具配置能力，支持新增工具参数配置而不用重新出Datakit portal版本，支持kafka配置都那口安装，提高portal的安装效率，下发portal任务后配置得以保留，优化工具的问题定位能力。

## 1.2 【DataKit】MySQL迁移过程增加预操作和切换前检查

MySQL迁移过程中因为无写入权限或者磁盘空间不够，参数设置不合理，导致迁移失败或者迁移缓慢，并且迁移本身非常耗时，且需要人为检查迁移失败的原因，修复后又需要重新迁移，不太友好，故需要提前识别迁移过程中存在的问题进行预检查防护，保证迁移成功率，反向迁移前需要确认业务已停止，无增量数据写入，且数据已追平才能执行反向迁移，客户能接受数据丢失的前提下提供强制停止增量迁移业务。

# 2 特性测试信息

##### 功能测试

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.1 build 812682c6 | 2023-11-30   | 2023-12-7    |
| PortalControl-5.1.1            | 2023-11-30   | 2023-12-22   |
| MySQL 5.7.35                   | 2023-11-30   | 2023-12-22   |

硬件环境信息：

##### 功能测试

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核 内存：32GB 硬盘：300GB OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3 测试结论概述

## 3.1 测试整体结论

portal配置优化，共执行用例19个，主要覆盖了功能测试、资料测试以及易用性测试。功能测试主要覆盖了portal安装后修改全量迁移参数配置文件、增量迁移参数配置文件配置文件、反向迁移参数配置文件、portal统一参数配置文件后等级迁移，以及迁移后参数配置是否生效，修改后的参数配置文件是否保留等功能。资料测试主要覆盖操作手册是否完整，易用性主要覆盖操作流程是否符合李鸿基，按键布局及UI是否涉及合理，弹框大小及位子是否布局合理等功能。累计发现缺陷单4个，3个缺陷已解决，回归通过，整体质量良好。

MySQL迁移过程增加预操作和切换前检查，共执行用例20个，主要覆盖功能测试、资料测试以及易用性测试，功能测试主要覆盖服务可用性检查、数据库连接检查、数据库权限检查、大小写参数配置检查、磁盘空间检查和切换迁移前检查以及迁移前是否选择开启调整内核参数等功能。资料测试主要覆盖惭怍手册是否完整，易用性主要覆盖操作流程是否符合李鸿基，按键布局及UI是否涉及合理，弹框大小及位子是否布局合理等功能。累计发现缺陷1个，1个缺陷已解决，回归通过，整体质量良好。



## 3.2 约束说明

1、MySQL 5.7及以上版本

2、Java为11及其以上

## 3.3 遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      | N/A      | N/A      | N/A                | N/A      |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 5        | 0    | 1    | 13   | 1      |
| 百分比 | 100%     | 0%   | 20%  | 60%  | 20%    |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别   | 问题简述                                                     | 状态   | 备注 |
| ---- | ------------------------------------------------------------ | ------ | ------------------------------------------------------------ | ------ | ---- |
| 1    | [I8R568](https://e.gitee.com/opengaussorg/issues/list?issue=I8R568) | 主要   | portal配置优化的功能没有对应的资料说明                       | 已验收 |      |
| 2    | [I8M7WQ](https://e.gitee.com/opengaussorg/issues/list?issue=I8M7WQ) | 次要   | DataKit上离线安装portal时，后端日志显示已经报错了，但是前端页面一直显示安装中 | 已验收 |      |
| 3    | [I8LNJI](https://e.gitee.com/opengaussorg/issues/list?issue=I8LNJI) | 次要   | 迁移工具在页面进行参数配置时操作不方便                       | 已验收 |      |
| 4    | [I8P60T](https://e.gitee.com/opengaussorg/issues/list?issue=I8P60T) | 次要   | 全量迁移工具参数配置数之后，用户跟目录下配置文件未同步更改   | 已验收 |      |
| 5    | [I8OAAV](https://e.gitee.com/opengaussorg/issues/list?issue=I8OAAV) | 不重要 | DataKit在原有基座基座数据库不变时，更新新的基座插件，卸载掉之前的迁移插件，安装新的迁移插件时安装失败 | 已验收 |      |

# 4 测试执行

## 4.1 测试执行步骤

### 4.1.1 portal配置优化

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.修改不同配置文件参数，进行迁移<br />2.查看配置文件是否生效并保存 | 执行19条用例，发现4个bug，3个问题已解决并回归通过，1个问题待确认 |

### 4.1.2 MySQL迁移过程增加预操作和切换前检查

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 创建迁移任务，检查服务可用性检查、数据库连接检查、数据库权限检查、大小写参数配置检查、磁盘空间检查和切换迁移前检查以及迁移前是否选择开启调整内核参数等功能 | 执行20条用例，执行结果符合预期，测试通过，发现个bug1个，1个问题已解决回归通过 |

## 4.3 资料测试

| 测试步骤                   | 测试结果                   |
| -------------------------- | -------------------------- |
| 1. 文档描述<br>2. 文档示例 | 文档描述准确，示例正确无误 |

## 4.4 测试数据统计

根据用例进行测试验证，结果如下：

| 版本名称            | 测试用例数 | 用例执行结果            | 发现问题单数 |
| ------------------- | ---------- | ----------------------- | ------------ |
| PortalControl-5.1.1 | 31         | Passed:28<br/>Failed:3  | 3            |
| PortalControl-5.1.1 | 39         | Passed:37<br/>Failed: 2 | 2            |
| PortalControl-5.1.1 | 39         | Passed:39<br/>Failed:0  | 0            |

*数据项说明：*

累计发现缺陷单5个，5个缺陷已解决且回归通过，其中1个为资料单

失败用例已在后续问题修复后，回归issue执行通过

缺陷密度：

portal配置优化：3(缺陷个数)4.832/kloc(代码行数)=0.621(个/kloc)

MySQL迁移过程增加预操作和切换前检查：1(缺陷个数)2.121/kloc(代码行数)=0.471(个/kloc)

## 4.5 后续测试建议

1、测试复杂场景下工具功能

# 5 附件

## 5.1 源代码及文档PR

【工具链】portal配置优化PR
https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-workbench/pulls/458

【工具链】portal配置优化文档PR
https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-workbench/pulls/528

【工具链】MySQL迁移过程增加预操作和切换前检查PR

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-migration-portal/pulls/97

【工具链】MySQL迁移过程增加预操作和切换前检查文档PR

https://gitee.com/opengauss/openGauss-workbench/pulls/528

