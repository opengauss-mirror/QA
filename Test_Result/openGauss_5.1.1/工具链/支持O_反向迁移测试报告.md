![avatar](../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订版本 | 修改描述             | 作者 |
| ---------- | -------- | -------------------- | ---- |
| 2023-12-27 | 1.0      | 初稿                 | 2JQ  |
| 2024-01-24 | 1.1      | 补充测试项和bug验收  | 张山 |
| 2024-02-22 | 1.2      | 根据检视意见修改描述 | 张山 |

 关键词： 

O*，openGauss，反向迁移 

摘要：

 本报告主要介绍O*向openGauss反向迁移的测试结果。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

支持O*数据库在全量迁移和增量迁移过后，对openGauss数据库进行数据的反向迁移操作。

其中，支持的反向迁移操作包括：

dml操作：insert、update、delete操作

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称           | 测试起始时间 | 测试结束时间 |
| ------------------ | ------------ | ------------ |
| openGauss5.1.1B009 | 2023-12-15   | 2023-12-22   |
| openGauss5.1.1B009 | 2024-01-17   | 2024-01-24   |
|                    |              |              |

描述特性测试的硬件环境信息

| 环境信息 | 配置信息        | 备注                                                         |
| -------- | --------------- | ------------------------------------------------------------ |
| 硬件     | 服务器架构      | Linux  localhost 3.10.0-1127.el7.x86_64 #1 SMP Tue Mar 31 23:36:51 UTC 2020 x86_64  x86_64 x86_64 GNU/Linux |
| 硬件     | CPU             | 2核                                                          |
| 硬件     | 内存            | 7GB                                                          |
| 硬件     | 磁盘            | SDA  100GB                                                   |
| 硬件     | 网络            | 10000Mb/s                                                    |
| 软件     | openGauss数据库 | openGauss-5.1.1-CentOS-64bit                                 |
| 软件     | O*数据库        | O*_11g-11.2.0.1.0-64bit                                      |
| 软件     | Kafka中间数据库 | Kafka_2.13-3.6.0                                             |
| 软件     | Confluent中间件 | Confluent-5.5.1                                              |
| 软件     | Postman         | Postman-10.21.0.0                                            |

# 3     测试结论概述

## 3.1   测试整体结论

反向迁移特性，共计执行55个用例，主要覆盖了功能测试和资料测试，功能测试覆盖已支持的O*常用数据类型、表类型等测试，以及不同的dml语法对于反向迁移的影响。校验资料的描述及示例的执行结果是否通过。累计发现issue2个，已验收通过，整体质量良好。

| 测试活动   | 活动评价                                                     |
| ---------- | ------------------------------------------------------------ |
| 功能测试   | 带有常用数据类型的表及表类型反向迁移，测试通过               |
| 功能测试   | 使用常用的dml语法进行反向迁移，测试通过                      |
| 易用性测试 | 对命令配置及程序启用过程的易用性进行测试，测试通过，配置项说明清晰、错误提示详尽 |
| 可靠性测试 | 对异常（如：kill进程等）场景下的增量迁移过程进行测试，异常恢复后增量迁移过程可以继续进行 |
| 性能测试   | 1张大表边写入1w条数据边进行增量迁移，反向迁移速率约909条/s   |
| 资料测试   | 校验资料的描述及示例的执行结果是否通过，测试通过             |
| 稳定性测试 | 运行7*24后，进行反向迁移，测试通过                           |

## 3.2   约束说明

1. 需要将执行反向迁移任务的机器ip设置到openGauss数据库的白名单内

2. 需要为openGauss数据库用户开启replication相关权限

   host replication 【user】 0.0.0.0/0 sha256

   调整guc参数：

   alter system set wal_level to logical;

3. 在启动反向迁移任务之前，需要启动zookeeper、kafka等工具

   cd kafka_2.13-3.2.3
   ./bin/zookeeper-server-start.sh ./config/zookeeper.properties

   ./bin/kafka-server-start.sh ./config/server.properties

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 2        | 0    | 0    | 2    | 0      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |

### 问题汇总单

| 序号 | issue号 | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------- | -------- | ------------------------------------------------------------ | -------- |
| 1    | I8PYGN  | 严重     | Debezium+Kafka反向迁移有主键的表，无法完成update和delete     | 已验收   |
| 2    | I8Q5TZ  | 次要     | Debezium+Kafka反向迁移含有nchar、clob、blob、raw、date、timestamp，无法完成同步 | 已验收   |



# 4     测试执行

## 4.1   测试执行统计数据

| 版本名称           | 测试用例数 | 用例执行结果 | 发现问题单数 |
| ------------------ | ---------- | ------------ | ------------ |
| openGauss5.1.1B009 | 55         | 通过：53     | 2            |
|                    |            |              |              |
|                    |            |              |              |

*数据项说明：*

- 首轮测试用例执行55个，不通过2个，缺陷问题单汇总；第二轮回归问题单执行2个用例，通过2个；
- 本需求缺陷密度为2(缺陷个数)/0.298k(代码行数)=6.71(个/kloc)。

## 4.2   后续测试建议

无

# 5     附件

文档资料：

https://gitee.com/openGauss/debezium/blob/master/README.md

代码资料：

 https://gitee.com/openGauss/debezium/pulls/194

https://gitee.com/openGauss/debezium/pulls/210

 



 

 
