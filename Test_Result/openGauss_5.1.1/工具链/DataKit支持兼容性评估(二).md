![avatar](C:\images\openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述           | 作者     |
| :--------- | ----------- | ------------------ | -------- |
| 2023-12-14 | 1.0         | 特性测试报告初稿完 | lihongji |

 关键词： 

监测sql语句、监测执行sql的堆栈信息

摘要：

本文档主要介绍DataKit支持兼容性评估第二阶段的测试报告

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

​       实现jvm进程持续监测，收集jvm进程执行的sql语句，将收集的sql语句输出至文件，打印执行sql语句的堆栈信息。

# 2     特性测试信息

| 版本名称   | 测试起始时间 | 测试结束时间 |
| ---------- | ------------ | ------------ |
| M*  5.7.27 | 2023-11-16   | 2023-12-13   |

| 硬件型号       | 硬件配置信息                                                 | 备注 |
| -------------- | ------------------------------------------------------------ | ---- |
| x86_64+centOS  | CPU：Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz<br/>内存：31GB<br/>硬盘：400GB<br/>OS：CentOS Linux release 7.6.1908 (Core) |      |
| aarch64+centOS | CPU：Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz<br/>内存：15GB<br/>硬盘：98GB<br/>OS：openEuler release 20.03 (LTS-SP1) |      |

# 3     测试结论概述

## 3.1   测试整体结论

​        DataKit支持兼容性评估，实现抽取jdbc执行的SQL语句及堆栈信息并输出到文本文件中。累计发现缺陷单4个，其中待办的1个、修复中1个、已完成2个，整体质量一般。

## 3.2   约束说明

-  jdk版本11.0.20以上
-  mysql数据库版本8.0.x,5.0.x
-  scheduled的startTime必须设置在当前时间之后，否则会无法启动
-  conf文件下的yml信息,linux的config信息,默认用户为root用户,该用户需要有创建directory,上传文件的权限,运行启动命令的权限,否则会导致失败

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 |
| -------- | -------- |
| NA       |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 0    | 1    | 1    | 2      |
| 百分比 | 100%     | 0%   | 25%  | 25%  | 50%    |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I8I98B](https://gitee.com/opengauss/compatibility-assessment/issues/I8I98B?from=project-issue) | 不重要   | 采集到的sql语句及stack信息没有对应的时间                     | 待办的   |
| 2    | [I8IVRT](https://gitee.com/opengauss/compatibility-assessment/issues/I8IVRT?from=project-issue) | 不重要   | tool.jar工具配置application.yml的账户名或密码错误，提示信息不准确 | 修复中   |
| 3    | [I8IT5I](https://gitee.com/opengauss/compatibility-assessment/issues/I8IT5I?from=project-issue) | 主要     | user.jar与tool.jar在不同的机器上，采集到的sql、stack无法下载到本地与Linux且 采集到的sql、stack信息未按天多文件保存 | 已完成   |
| 4    | [I8HQOQ](https://gitee.com/opengauss/compatibility-assessment/issues/I8HQOQ?from=project-issue) | 次要     | 采集到的sql语句+号丢失。当sql语句中有换行的两关键字时，采集到的信息将这两个关键字拼接到了一起 | 已完成   |

# 4     测试执行

##  4.1 功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 使用jdk1.8.0、jdk11.0.21环境打包user.jar程序 ，jdk11.0.21环境打包tool.jar工具<br/>2.启动user.jar工具，获取进程号A<br/>3.conf/application.yml文件配置获取的进程号A，配置监测时间等参数。启动tool.jar工具<br/>4.在user.jar程序中覆盖了DML、DCL、DQL、DDL语句<br/>5.jdk版本，测试user.jar在jdk11.0.21环境下启动后，可正常被tool.jar工具采集<br/>6.M*版本，测试了M\*5、M\*8版本<br/>7.驱动版本，测试了jdbc5.1.47、jdbc8.0.29 | 执行63条用例，执行结果符合预期，测试通过，发现个bug4个，2个问题已解决回归通过 |

## 4.1.2 性能测试

| 测试步骤                                                     | 测试结果                                           |
| ------------------------------------------------------------ | -------------------------------------------------- |
| 1.sybench预置20000张表至M\*<br/>2.编写10线程、10并发，持续运行20min的jmeter脚本<br/>3.启动jmeter脚本jmeter -n -t  test.jmx -l result.jtl<br/>4.tool.jar程序监测jmeter进程进程sql语句采集 | 执行1条用例，执行结果符合预期，测试通过，未发现bug |

4.1.1 测试步骤执行

### 4.1.3 可靠性测试

| 测试步骤                                                   | 测试结果                                           |
| ---------------------------------------------------------- | -------------------------------------------------- |
| 1.tool.jar工具所在虚拟机注入网络延时、网络闪断、cpu80%故障 | 执行3条用例，执行结果符合预期，测试通过，未发现bug |



### 4.1.5资料测试

| 测试步骤：                               | 测试结果           |
| ---------------------------------------- | ------------------ |
| 1.校验资料的描述及示例的执行结果是否成功 | 资料一致性测试通过 |



## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果            | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------- | ------------ |
| openGauss 5.1.1 build 3172134f | 29         | Passed：25<br>Failed：4 | 4            |

*数据项说明：*

* 第一阶段累计发现缺陷单4个，待办的1个、修复中1个、已完成2个
* 缺陷密度为4个(缺陷个数)/3.470kloc(代码行数)=1.15(个/kloc)

## 4.3   后续测试建议

暂无

# 5     附件

无

