版权所有 © 2023 openGauss社区 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[https://creativecommons.org/licenses/by-sa/4.0/](https://gitee.com/link?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-sa%2F4.0%2F) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[https://creativecommons.org/licenses/by-sa/4.0/legalcode。](https://gitee.com/link?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-sa%2F4.0%2Flegalcode%E3%80%82)

修订记录

| 日期       | 修订 版本 | 修改描述 | 作者        |
| ---------- | --------- | -------- | ----------- |
| 2023-11-15 | V1.0      | 初稿     | houshaolong |

关键词：

root用户 解除依赖

摘要：

本文档主要介绍数据库安装流程解除对root用户的依赖，使用omm用户可以直接完成预安装和安装流程的功能，并给出最终测试结论。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| N/A    | N/A      | N/A      |

# 1 特性概述

本特性来源于客户现场，主要介绍数据库安装流程解除对root用户的依赖，使用omm用户可以直接完成预安装和安装流程的功能，方便没有root权限的用户安装和使用openGauss。


# 2 特性测试信息

##### 功能测试

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.1 build 1e74d4f2 | 2023-11-30   | 2023-12-7    |

硬件环境信息：

##### 功能测试 

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核 内存：32GB 硬盘：300GB OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3 测试结论概述

## 3.1 测试整体结论

数据库安装流程解除对root用户的依赖，共执行用例11个，主要覆盖了功能测试及资料测试，功能测试主要覆盖了使用omm用户进行预安装和安装不带cm和带cm的数据库，以及使用omm用户执行gs_sshexkey、gs_checkos、gs_upgradectl、gs_expansion等功能，资料测试主要测试安装指南对使用omm方式安装数据库的描述以及工具参考中对之前使用root用户执行的工具，添加可以使用omm用户执行的描述。



## 3.2 约束说明

* 需要将omm用户写入到定时任务
* 创建多节点数据库时，须提前在各节点使用root用户创建好用户和用户组

## 3.3 遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      | N/A      | N/A      | N/A                | N/A      |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 0    | 1    | 0      |
| 百分比 | 100%     | 0%   | 0%  | 100%  | 0%     |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                                   | 状态   | 备注 |
| ---- | ------------------------------------------------------------ | ---- | ---------------------------------------------------------- | ------ | ---- |
| 1    | [I8MK2A](https://e.gitee.com/opengaussorg/issues/list?issue=I8MK2A) | 次要 | 缺少 数据库安装流程解除对root用户的依赖 相关操作的资料说明 | 已验收 |      |

# 4 测试执行

## 4.1 功能测试实现步骤

1、创建用户和用户组

2、vim /etc/cron.allow 写入omm用户

3、使用omm用户执行gs_preinstall 命令

4、使用omm用户执行ga_install 命令

### 4.1.1 功能测试-使用omm用户安装数据库并测试工具功能

| 测试步骤                                                     | 测试结果                                 |
| ------------------------------------------------------------ | ---------------------------------------- |
| 1. 使用omm用户进行预安装和安装不带cm和带cm的数据库，以及使用omm用户执行gs_sshexkey、gs_checkos、gs_upgradectl、gs_expansion等功能 | 执行11条用例，执行结果符合预期，测试通过 |

## 4.3 资料测试

| 测试步骤                   | 测试结果                                                |
| -------------------------- | ------------------------------------------------------- |
| 1. 检查描述<br>2. 文档示例 | 文档描述准确，示例正确无误，发现1个问题单，已验收通过 |

## 4.4 测试数据统计

根据用例进行测试验证，结果如下：

| 版本名称                       | 测试用例数 | 用例执行结果           | 发现问题单数 |
| ------------------------------ | ---------- | ---------------------- | ------------ |
| openGauss 5.1.1 build 1e74d4f2 | 11         | Passed:11<br/>Failed:0 | 0            |

*数据项说明：*

- 累计发现缺陷单1个，为资料单
- 缺陷密度：0(缺陷个数)0.595/kloc(代码行数)=0(个/kloc)

## 4.5 后续测试建议

1、测试omm用户进行资源池化数据库安装

# 5 附件

## 5.1 om去除root权限依赖

 om去除root权限依赖PR<br>

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-OM/pulls/610

 om去除root权限依赖资料PR<br>

暂无

