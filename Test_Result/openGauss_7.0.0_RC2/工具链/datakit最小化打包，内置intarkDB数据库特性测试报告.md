![avatar](../../images/openGauss.png)

版权所有 © 2025  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期      | 修订版本 | 修改描述                                                  | 作者 |
| --------- | -------- | --------------------------------------------------------- | ---- |
| 2025.5.27 | 1.0      | datakit最小化打包，内置intarkDB数据库特性测试报告初稿完成 | 刘桐 |

[TOC]

**Keywords 关键词**：datakit、最小化打包、内置数据库、intarkDB

**Abstract 摘要**：本文对datakit最小化打包，内置intarkDB数据库特性的测试情况进行详细说明，并给出最终测试结论。

**缩略语清单： **

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|        |          |          |


# 1 概述

随着插件的日益增加，datakit完整版安装包体积也逐步增加，但是客户可能并不需要其中的全部插件功能，为节省客户的网络资源，满足客户的个性化需求，本特性对datakit进行了最小化打包，只保留核心组件，其他插件单独放出供客户下载。同时，之前客户下载datakit前需要先下载安装openGauss，增加了客户的使用成本，所以本特性添加了内置数据库intarkDB，保证datakit下载即用，真正达成datakit的轻量化。针对该需求出具本测试报告。

# 2 测试版本说明

## 2.1 测试版本信息

###   2.1.1 被测版本

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                 | 测试起始时间 | 测试结束时间 | 测试人员 |
| ------------------------ | ------------ | ------------ | -------- |
| openGauss 7.0.0-RC2 B006 | 2025-5-14    | 2025-5-20    | 刘桐     |
| openGauss 7.0.0-RC2 B007 | 2025-5-21    | 2025-5-27    | 刘桐     |

## 2.2 测试环境描述

###  2.2.1 环境硬件信息

硬件环境信息：

| 硬件型号              | 硬件配置信息                                                 | 备注 |
| --------------------- | ------------------------------------------------------------ | ---- |
| CentOS Linux 7 (Core) | CPU：Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz<br />内存：32G<br />硬盘：SCSI storage controller: Red Hat, Inc. Virtio block device<br />OS：CentOS Linux 7 (Core) x86<br />文件系统：ext4<br />网卡：Ethernet controller: Red Hat, Inc. Virtio network device |      |

### 2.2.2 虚拟化平台

不涉及

### 2.2.3 OS版本

| 操作系统       | OS版本 | 版本说明                  |
| -------------- | ------ | ------------------------- |
| CentOS Linux 7 | 7      | CentOS Linux 7 (Core) x86 |

# 3 版本概要测试结论、关键风险和规避措施

## 3.1 测试结论总结

需求共计执行13个用例，主要覆盖了完整版、Mini版和各插件的下载、安装、卸载功能测试、插件离线安装及在线安装时的可靠性测试等场景，共发现3个问题单，缺陷密度0.344(个/kloc)，整体质量良好。

| 测试活动                                                | 活动评价                                                     |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| 完整版、Mini版和各插件的下载、安装、卸载功能测试        | 完整版、Mini版和各插件的下载、安装、卸载功能均正常           |
| 离线安装历史版本和历史版本号插件测试                    | 离线安装插件时，datakit会检查插件真正的版本号，与文件名无关，如果实际安装的插件与当前版本不符，则上传完成后报错，提示用户应该上传哪个版本的插件 |
| 插件安装时网络故障测试                                  | 制造网络故障时页面卡死，进度暂停，报错Network error，无法重新登录datakit。后台可以看到对应的jar包的大小和完整的jar包不一致。</br >重新安装时报错zip END header not found，后台删除错误插件后可以安装成功，安装过程正常显示进度，安装完成后点击插件对应的各一级和二级页面均能正常加载 |
| datakit新建用户赋予没有插件管理权限的角色登录及使用测试 | 创建没有插件管理权限和部分插件使用权限的角色，并新增用户赋予该角色。新用户可以正常登录，无法进行插件管理。</br >管理员用户安装或卸载新用户有使用权限的插件时，重新登录新用户可以发现datakit界面变化。</br >若管理员安装或卸载新用户没有使用权限的插件，则新用户不感知。 |
| datakit新建用户赋予有插件管理权限的角色登录及使用测试   | 创建有插件管理权限和部分插件使用权限的角色，并新增用户赋予该角色。新用户可以正常登录，可以进行插件管理。</br >新用户安装或卸载有使用权限的插件时，重新登录管理员可以发现datakit界面变化。</br >若管理员安装或卸载新用户没有使用权限的插件，则新用户可以看到插件变化，但是无法使用没有使用权限的插件。 |
| 内置数据库intarkDB功能测试                              | 安装datakit时使用内置的intarkDB数据库作为datakit存放数据的数据库。</br >启动datakit后通过dbeaver连接该数据库，新建intarkDB引擎后可以连接数据库并执行简单的增删改查语句，结果均符合期望。</br >停止datakit后dbeaver无法连接内置数据库intarkDB，符合期望。</br >datakit和内置数据库intarkDB均不区分架构，所以没有进行各架构下的功能测试。 |
| 内置数据库intarkDB端口占用故障测试                      | 在启动内置intarkDB数据库的datakit前先启动一个openGauss数据库占用intarkDB数据库配置的端口，再启动datakit。</br >发现datakit登录失败，dbeaver无法连接内置的intarkDB数据库。关闭openGauss后重启datakit，登录datakit成功，插件功能正常 |
| datakit升级加载插件测试                                 | 安装历史版本datakit并启动，确认功能正常，插件全在后卸载部分插件并后台停止datakit。</br >然后替换datakit的jar包和部分插件为新版本之后，重启datakit，发现datakit尝试加载旧版本插件且可以加载部分旧版本插件和全部新版本插件。</br >后台删除历史版本插件后前台显示插件停用启动失败，重新安装新版本插件，前台显示插件启用，功能正常。</br >保持datakit启动，后台向文件夹中添加未安装的新版本插件，然后前台在线安装新版本插件，发现下载进度达到100%，直接使用了后台的插件 |
| datakit升级intarkDB内容留存测试                         | 安装最新版本datakit（支持intarkDB数据库）并启动，确认功能正常，插件全在，确认历史版本monitor-tools插件已安装，点击“监控插件工具”—“配置中心”—“openGauss”，输入相关信息后保存配置，然后点击“指标发布”，可以看到之前保存的信息</br >卸载历史版本插件monitor-tools并停止datakit，然后重启datakit并安装最新版本插件monitor-tools</br >点击“监控插件工具”—“指标发布”，可以看到之前保存的信息，说明intarkDB数据库保留了之前的信息 |
| datakit不同版本安装优先级测试                           | 安装最新版本datakit，部分插件准备历史版本和最新版本。在停止状态同时放入新版本插件和历史版本插件，启动datakit，发现datakit安装了最新版本的插件。</br >将历史版本和最新版本的插件文件名中的版本号互换，datakit依然安装了最新版本的插件，删除文件名的版本号为最新版本的插件（实际上是历史版本的插件），停用并启用插件，插件功能正常。</br >删除文件名的版本号为历史版本的插件（实际上是最新版本的插件），停用并启用插件，插件启动失败，说明确实安装的是该插件。 |

### 

## 3.2 约束说明

无

## 3.3 关键风险和规避措施

无

# 4 版本详细测试结论

## 4.1 特性测试结论

###   4.1.1 新需求质量评价

| 特性                                      | 特性价值评估                                                 | 应用说明及关键约束假设依赖 | 关键遗留事项如缺陷等 | 测试整体覆盖情况                                             | 特性质量评估               | 主要风险 |
| ----------------------------------------- | ------------------------------------------------------------ | -------------------------- | -------------------- | ------------------------------------------------------------ | -------------------------- | -------- |
| datakit最小化打包，内置intarkDB数据库特性 | 本特性对datakit进行了最小化打包，只保留核心组件，其他插件单独放出供客户下载节省客户的网络资源，满足客户的个性化需求。本特性还添加了内置数据库intarkDB，降低了客户的使用成本，无需再提前下载openGauss，保证datakit下载即用，真正达成datakit的轻量化。 | 无                         | 无                   | 覆盖了完整版、Mini版和各插件的下载、安装、卸载功能测试、插件离线安装及在线安装时的可靠性测试等场景 | <font color=green>▮</font> | /        |

*特性质量评估说明*：

<font color=red><font color=red>●</font></font>： *表示特性不稳定，风险高*

<font color=yellow><font color=yellow>▲</font></font>： *表示特性基本可用，遗留少量问题*

<font color=green>▮</font>： *表示特性质量良好*

## 4.2 产品质量属性目标(DFX)测试结论

###  4.2.1 性能测试结论

不涉及

###  4.2.2 可靠性测试结论

| 可靠性测试项目                     | 测试结果                                                     |
| ---------------------------------- | ------------------------------------------------------------ |
| 插件安装时网络故障测试             | 制造网络故障时页面卡死，进度暂停，报错Network error，无法重新登录datakit。后台可以看到对应的jar包的大小和完整的jar包不一致。</br >重新安装时报错zip END header not found，后台删除错误插件后可以安装成功，安装过程正常显示进度，安装完成后点击插件对应的各一级和二级页面均能正常加载 |
| 内置数据库intarkDB端口占用故障测试 | 在启动内置intarkDB数据库的datakit前先启动一个openGauss数据库占用intarkDB数据库配置的端口，再启动datakit。</br >发现datakit登录失败，dbeaver无法连接内置的intarkDB数据库。关闭openGauss后重启datakit，登录datakit成功，插件功能正常 |

###  4.2.3 安全&隐私保护测试结论

不涉及

### 4.2.4 可服务性测试结论

不涉及

### 4.2.5 生命周期管理测试结论

不涉及

### 4.2.6 韧性测试结论

不涉及

###  4.2.7 兼容性测试结论

不涉及

###  4.2.8 升级测试结论

| 升级测试项目                    | 测试结果                                                     |
| ------------------------------- | ------------------------------------------------------------ |
| datakit升级加载插件测试         | 安装历史版本datakit并启动，确认功能正常，插件全在后卸载部分插件并后台停止datakit。</br >然后替换datakit的jar包和部分插件为新版本之后，重启datakit，发现datakit尝试加载旧版本插件且可以加载部分旧版本插件和全部新版本插件。</br >后台删除历史版本插件后前台显示插件停用启动失败，重新安装新版本插件，前台显示插件启用，功能正常。</br >保持datakit启动，后台向文件夹中添加未安装的新版本插件，然后前台在线安装新版本插件，发现下载进度达到100%，直接使用了后台的插件 |
| datakit升级intarkDB内容留存测试 | 安装最新版本datakit（支持intarkDB数据库）并启动，确认功能正常，插件全在，确认历史版本monitor-tools插件已安装，点击“监控插件工具”—“配置中心”—“openGauss”，输入相关信息后保存配置，然后点击“指标发布”，可以看到之前保存的信息</br >卸载历史版本插件monitor-tools并停止datakit，然后重启datakit并安装最新版本插件monitor-tools</br >点击“监控插件工具”—“指标发布”，可以看到之前保存的信息，说明intarkDB数据库保留了之前的信息 |
| datakit不同版本安装优先级测试   | 安装最新版本datakit，部分插件准备历史版本和最新版本。在停止状态同时放入新版本插件和历史版本插件，启动datakit，发现datakit安装了最新版本的插件。</br >将历史版本和最新版本的插件文件名中的版本号互换，datakit依然安装了最新版本的插件，删除文件名的版本号为最新版本的插件（实际上是历史版本的插件），停用并启用插件，插件功能正常。</br >删除文件名的版本号为历史版本的插件（实际上是最新版本的插件），停用并启用插件，插件启动失败，说明确实安装的是该插件。 |

## 4.3 资料测试结论

| 序号 | 测试章节                                                     | 测试结论     |
| ---- | ------------------------------------------------------------ | ------------ |
| 1    | https://gitcode.com/opengauss/openGauss-workbench/blob/master/README.md | 整体质量良好 |

# 5 测试对象质量评估

##  5.1 覆盖率分析

本次测试主要覆盖了完整版、Mini版和各插件的下载、安装、卸载功能测试、插件安装时的可靠性测试，资料测试等模块。

##  5.2 缺陷统计和分析

###   5.2.1 缺陷统计

|        | 问题总数 | 严重 | 主要   | 次要   | 不重要 |
| ------ | -------- | ---- | ------ | ------ | ------ |
| 数目   | 3        | 0    | 1      | 1      | 1      |
| 百分比 | 100%     | 0%   | 33.33% | 33.33% | 33.33% |

###   5.2.2 缺陷列表

| 序号 | issue链接                                                    | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | https://gitcode.com/opengauss/openGauss-workbench/issues/988 | 主要     | 1.使用intarkDB内置数据库安装最新版本datakit<br/>2.使用admin用户登录后在页面左下角 安全中心-角色与权限 创建新角色并授予插件管理外其他所有插件的权限，再创建新用户赋予角色<br/>3.使用新用户重新登录报错 | 已验收   |
| 2    | https://gitcode.com/opengauss/openGauss-workbench/issues/989 | 次要     | 新版本的插件列表相比旧版本datakit缺少兼容性评估相关插件      | 已验收   |
| 3    | https://gitcode.com/opengauss/openGauss-workbench/issues/990 | 不重要   | 上传旧版本插件安装报错没有提示用户应该上传哪个版本的插件     | 已验收   |

# 6 测试过程评估

##  6.1 测试策略回顾

| 编号 | 特性       | 验证策略                                                 | 是否按照测试策略执行 |
| ---- | ---------- | -------------------------------------------------------- | -------------------- |
| 1    | 功能测试   | 针对完整版、Mini版和各插件的下载、安装、卸载功能进行测试 | YES                  |
| 2    | 可靠性测试 | 针对插件离线安装及在线安装时的可靠性进行测试             | YES                  |
| 3    | 升级测试   | 针对升级过程中不同版本插件的安装卸载功能进行测试         | YES                  |
| 4    | 资料测试   | 整体质量良好，参数均已注明用途                           | YES                  |

##  6.2 测试设计评估

| 编号 | 测试点修改说明 | 修改原因 | 是否影响测试质量 |
| ---- | -------------- | -------- | ---------------- |
| na   |                |          |                  |

##  6.3 测试执行评估

###  6.3.1 测试执行统计数据

| 版本名称                 | 工作量投入(人天) | 测试用例数 | 用例执行数 | 发现缺陷数 | 代码量（KLOC） | 缺陷密度 |
| ------------------------ | ---------------- | ---------- | ---------- | ---------- | -------------- | -------- |
| openGauss 7.0.0-RC2 B006 | 2                | 13         | 10         | 3          | 8.674          | 0.346    |
| openGauss 7.0.0-RC2 B007 | 3                | 13         | 13         | 3          | 8.720          | 0.344    |

备注：

特性测试需求缺陷密度：3/8.720k=0.344(个/kloc)，开发质量良好。

###  6.3.2 测试用例执行结果统计数据

|        | 计划测试用例数 | 实际测试的用例数 | Passed | Failed | Blocked | Unavailable | 执行率 | 执行通过率 |
| ------ | -------------- | ---------------- | ------ | ------ | ------- | ----------- | ------ | ---------- |
| 第一轮 | 13             | 10               | 7      | 3      | 0       | 0           | 76.9%  | 53.8%      |
| 第二轮 | 13             | 13               | 13     | 0      | 0       | 0           | 100%   | 100%       |

# 7 附件

##  7.1 附件1：遗留问题列表

| 序号 | issue号 | 问题级别 | 问题简述 | 问题状态 |
| ---- | ------- | -------- | -------- | -------- |
|      |         |          |          |          |

##  7.2 附件2：特性相关PR

需求链接：

https://e.gitee.com/opengaussorg/dashboard?issue=IC25AO

代码合入链接：

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-workbench/pulls/1098

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-workbench/pulls/1095

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-workbench/pulls/1079

资料：

https://gitcode.com/opengauss/openGauss-workbench/blob/master/README.md

测试设计：

https://devcloud.cn-east-3.huaweicloud.com/testmind/project/03669bfd256c444bbfda6d7fb8b83bb2/testmind/mindmap?mindId=c3b46721d5dc4476a3c5d46d0e43b3e2&hideDevcloudHead=true

测试用例：

https://devcloud.cn-east-3.huaweicloud.com/cloudtestportal/project/03669bfd256c444bbfda6d7fb8b83bb2/testcase?branch_id=vb2100010cof2bn7
