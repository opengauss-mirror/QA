![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订   版本 | 修改描述             | 作者    |
| :-------- | ----------- | -------------------- | ------- |
| 2023-3-22 | 1.0         | 特性测试报告初稿完成 | qiuying |
|           |             |                      |         |

 关键词： 

CM、容器、触发器、pause、resume

摘要：

本文档主要介绍实现CM的容器化部署，支持事件结束后调用用户自定义脚本和一键式关闭CM集群服务功能，并给出最终测试结论。 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|CM     | Cluster Manager         |  统一数据库管理工具        |

# 1     特性概述

**1.1.CM支持容器化部署**

docker独立代码仓，移植OM对静态配置文件生成、刷新和查看的能力，支持容器化安装，支持互信建立，支持CM安装拉起，满足容器化环境数据库安装和集群管理要求。

**1.2.CM支持事件结束后调用用户自定义脚本**

CM支持事件触发器，即在特定事件发生后，由CM自动触发用户自定义的脚本，执行相应的操作

**1.3.支持一键式关闭CM集群服务**

支持一键启/停CM集群仲裁服务，执行一键暂停命令后，可以将CM对DN的自动仲裁和故障处理功能暂停掉，避免运维操作被干扰，运维操作完成后，再执行一键恢复操作，可以重新恢复CM的仲裁和故障处理功能

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.0.0 build c323237f | 2023-2-23    | 2023-3-8     |
| openGauss 5.0.0 build 5a69c469 | 2023-3-8     | 2023-3-9     |
| openGauss 5.0.0 build e94d3b43 | 2023-3-9     | 2023-3-10    |

| 环境信息      | 配置信息                                                 | 备注 |
| ------------- | ------------------------------------------------------------ | ---- |
| 虚拟机 | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300G<br/>OS：CentOS Linux release 7.6.1810 (Core) |      |
| 虚拟机 | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300G<br/>OS：openEuler release 20.03 (LTS) | |

# 3     测试结论概述

## 3.1   测试整体结论

CM支持容器化部署，共计执行77条用例，主要覆盖了功能测试、可靠性和资料测试。功能测试覆盖手动创建openGauss镜像、创建容器拉起集群、使用社区镜像创建拉起集群等功能。可靠性测试覆盖在暂停状态、容器、集群进程、磁盘异常时，CM仲裁功能正常，可以自动调用自定义脚本。资料测试覆盖校验资料的描述是否完整。累计发现缺陷单10个，10个问题已解决且回归通过，整体质量良好。

CM支持事件结束后调用用户自定义脚本，共计执行77条用例，主要覆盖了功能测试、可靠性和资料测试。功能测试覆盖对参数的配置，配置特定事件后参数的功能。可靠性测试覆盖在CPU、磁盘、网络异常时，CM是否可以正常管理资源。资料测试覆盖校验资料的描述是否完整。累计发现缺陷单1个，1个问题已解决且回归通过，整体质量良好。

支持一键式关闭CM集群服务，共计执行77条用例，主要覆盖了功能测试、可靠性和资料测试。功能测试覆盖对CM集群执行暂停和恢复后CM的功能。可靠性测试覆盖在暂停后磁盘、网络、集群双主等异常时，CM的功能是否可用。资料测试覆盖校验资料的描述是否完整。累计发现缺陷单1个，1个问题已解决且回归通过，整体质量良好。

| 测试活动   | 活动评价                                                     |
| ---------- | :----------------------------------------------------------- |
| 功能测试   | 手动创建openGauss镜像、使用社区镜像创建容器拉起集群，功能正常，通过 |
| 功能测试   | 配置特定事件后，可以自动调用相关事件的脚本，功能正常，通过   |
| 功能测试   | 执行暂停和恢复后CM的功能，功能正常，通过                     |
| 可靠性测试 | 网络，磁盘、容器等故障场景下CM功能正常，可以自动调用自定义脚本 |
| 资料测试   | 资料对于新增加的功能描述准确，示例的执行结果正确，整体质量良好 |

## 3.2   约束说明

- 数据库可适配安装CM
- 环境中已安装docker

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 10      | 0    | 0    | 10  | 0      |
| 百分比 |  100%        | 0%   | 0%   | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I5E6M8](https://gitee.com/opengauss/CM/issues/I5E6M8?from=project-issue) | 次要     | 自定义资源监控的json配置文件中,脚本名称设置为null/1，执行cm_ctl stop命令报错产生core文件 | 已验收   |
| 2    | [I5EGGT](https://gitee.com/opengauss/CM/issues/I5EGGT?from=project-issue) | 次要     | CM查询自定义资源的状态，带参数i的时候，Title栏有node_ip，实际查询未显示ip | 已验收   |
| 3    | [I5FE4G](https://gitee.com/opengauss/CM/issues/I5FE4G?from=project-issue) | 次要     | CM执行cm_ctl stop -n NODEID停止cms备节点实例和资源后，query查询显示资源状态为online | 已验收   |
| 4    | [I5FG8U](https://gitee.com/opengauss/CM/issues/I5FG8U?from=project-issue) | 次要     | CM执行cm_ctl stop -n NODEID停止某节点后，-I 单独启动资源，提示启动资源成功，实际query查询显示资状态Unknown | 已验收   |
| 5    | [I5H53F](https://gitee.com/opengauss/CM/issues/I5H53F?from=project-issue) | 次要     | interval设置超过2时cm_ctl 查询资源状态显示unknown            | 已验收   |

# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 CM支持容器化部署功能测试

| 测试步骤：                                       | 测试结果                                     |
| ------------------------------------------------ | -------------------------------------------- |
| 1. 创建容器镜像拉起CM集群<br/>2.查看CM状态和功能 | 执行17条用例，发现8个bug，现已修复且验收通过 |

### 4.1.2 CM支持事件结束后调用用户自定义脚本功能测试

| 测试步骤：                                       | 测试结果                                     |
| ------------------------------------------------ | -------------------------------------------- |
| 1. 配置触发器参数<br/>2.执行CM操作触发自定义脚本 | 执行30条用例，发现1个bug，现已修复且验收通过 |

### 4.1.3 支持一键式关闭CM集群服务功能测试

| 测试步骤：                                    | 测试结果                                     |
| --------------------------------------------- | -------------------------------------------- |
| 1. 执行暂停和恢复操作<br/>2. 查看CM状态和功能 | 执行10条用例，发现1个bug，现已修复且验收通过 |

### 4.1.4 可靠性测试

| 测试步骤：                                      | 测试结果                           |
| ----------------------------------------------- | ---------------------------------- |
| 1. 网络，磁盘、容器故障<br/>2. 查看CM状态和功能 | 执行20条用例，未发现问题，验收通过 |

##  4.1.5 资料测试

| 测试步骤                | 测试结果                                         |
| ----------------------- | ------------------------------------------------ |
| 1. 文档描述 2. 文档示例 | 文档描述准确，示例正确无误，未发现问题，验收通过 |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果        | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------- | ------------ |
| openGauss 5.0.0 build c323237f | 50         | Passed:35 Failed:15 | 10           |
| openGauss 5.0.0 build e94d3b43 | 7          | Passed:7 Failed:0   | 0            |
| openGauss 5.0.0 build eacf1d20 | 3          | Passed:3 Failed:0   | 0            |

*数据项说明：*

* 累计发现缺陷单10个，10个缺陷已解决且回归通过

* 失败用例已在后续问题修复后，回归issue执行通过

* 缺陷密度为10(缺陷个数)/1.5k(代码行数)=3.3(个/kloc)。


## 4.3   后续测试建议

无

# 5     附件

无
