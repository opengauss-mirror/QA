![avatar](../../../images/openGauss.png)

版权所有 © 2024  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期        | 修订版本 | 修改描述     | 作者 |
|-----------| -------- | ------------ |--|
| 2025.2.28 | v1.0     | 测试报告初稿 | peilinqian |

**Keywords 关键词**：DATAVEC PQ索引 HNSWPQ索引 IVFPQ索引

**Abstract 摘要**：本文档主要介绍 openGauss 向量数据库PQ索引相关功能的验证及测试结果；

**缩略语清单：**

| 缩略语 | 英文全名                                                     | 中文解释                     |
| ------ | ------------------------------------------------------------ | ---------------------------- |
| IVFPQ  | Inverted File with Product Quantization                      | 基于倒排与量化的向量索引算法 |
| HNSWPQ | Hierarchical Navigable Small World combined with Product Quantization | 基于图的量化向量索引算法     |


# 1 概述

本报告主要测试 openGauss 数据库 DataVec 向量引擎IVFPQ及HNSWPQ的两种索引创建、修改、重建、检索等功能，包括功能测试、性能测试、可靠性测试。

# 2 测试版本说明

## 2.1 测试版本信息

###   2.1.1 被测版本

| 版本名称                            | 软件包名称 | 测试起始时间 | 测试结束时间 | 测试人员   |
| ----------------------------------- | ---------- | ------------ | ------------ | ---------- |
| openGauss 7.0.0-RC1 build  807fd476 | openGauss  | 2025-2-1     | 2025-2-13    | peilinqian |
| openGauss 7.0.0-RC1 build  7e79432c | openGauss  | 2025-2-20    | 2025-2-25    | peilinqian |
| openGauss 7.0.0-RC1 build  6309f4cb | openGauss  | 2024-2-26    | 2025-2-28    | peilinqian |
| BoostKit 25.0.RC1                   | Boostkit   | 2025-2-20    | 2025-2-28    | peilinqian |

## 2.2 测试环境描述

###  2.2.1 环境硬件信息

**功能测试环境信息**

| 环境信息 | 硬件配置信息                                                 | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 物理机   | Kunpeng-920<br/>内存：721GB<br/>硬盘：1TB<br/>OS：openEuler release 20.03(LTS) |      |

**性能测试环境信息**

| 环境信息 | 硬件配置信息                                                 | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 物理机   | 鲲鹏920B 7280Z操作系统；openeuler 22.03LTS SP3，GCC 10.3，python3.11 | 整机 |

## 3.1 测试结论总结

本报告主要测试DataVec向量数据库PQ索引创建、修改、重建及检索模块，覆盖所有索引构建选项参数及查询检索参数，主要包含功能场景测试，输出测试用例154个，执行测试3轮，发现issue共8个，3个问题待解决；需求覆盖100%，整体质量一般。

## 3.2 约束说明

> 安装完数据库后，需要获取PQ加速安装包，详见[链接](https://support.huawei.com/enterprise/zh/kunpeng-computing/kunpeng-boostkit-pid-253662285/software/263761464?idAbsPath=fixnode01|23710424|251364417|9856629|253662285)获取libkvecturbo.so安装包。解压安装包获得rpm文件并安装，默认路径为/usr/local/sra_recall。配置环境变量export DATAVEC_PQ_LIB_PATH=<libkvecturbo.so所在路径>
>
> PQ特性暂时只支持ARM架构环境。
>
> PQ特性暂时只支持HNSW和IVF索引。
>
> PQ特性暂时只支持vector数据类型，在其他向量数据类型构建HNSWPQ以及IVFPQ索引会导致执行失败。
>
> 在创建PQ索引前需要先插入数据，无数据情况下会创建失败。
>



# 4 版本详细测试结论

## 4.1 特性测试结论

###   4.1.1 新需求质量评价

*建议以表格的形式汇总本阶段新特性的商用化建议（此章节除了考虑可靠性、性能、开源等风险评估之外，还需考虑基础特性安全与隐私风险），如下表格所示。*

*下表仅供参考，不作为强制输出方式。*

| 特性 | 特性价值评估             | 应用说明及关键约束假设依赖 | 关键遗留事项如缺陷等               | 测试整体覆盖情况             | 特性质量评估                                          | 主要风险              |
| ---- | ------------------------ | -------------------------- | ---------------------------------- | ---------------------------- | ----------------------------------------------------- | --------------------- |
| PQ   | PQ索引功能正常，性能达标 | 需要加载boostkit插件       | IVFPQ索引残差特性开启会导致dml卡死 | 功能、可靠性、性能覆盖完成。 | <font color=yellow><font color=yellow>▲</font></font> | 暂时存在功能bug待解决 |

*特性质量评估说明*：

<font color=red><font color=red>●</font></font>： *表示特性不稳定，风险高*

<font color=yellow><font color=yellow>▲</font></font>： *表示特性基本可用，遗留少量问题*

<font color=green>▮</font>： *表示特性质量良好*

## 4.2 产品质量属性目标(DFX)测试结论

###  4.2.1 功能测试结论

索引创建、修改、dml交互测试功能正常。

###  4.2.2 性能测试结论

基于920B完成HNSWPQ索引性能测试，openGauss向量数据库HNSW索引整体吞吐量相比EMR8558P上的PGVector/milvus提升30%；达到性能验收标准。

**性能测试比对EMR环境**

EMR8558P操作系统；openEuler 22.03LTS SP3，编译器：GCC10.3，python:3.11

**性能测试结果：**

| 压测工具       | 数据集        | 920B/openGaussPQ（QPS） | EMR  4numa/PGVector（QPS） | EMR  4numa/Milvus（QPS） | 性能提升 |
| -------------- | ------------- | ----------------------- | -------------------------- | ------------------------ | -------- |
| ann-benchmarks | DEEP          | 7913.043685             | 5691.05                    | /                        | 39.04%   |
| ann-benchmarks | Fashion-MNIST | 33088.50909             | 13792.12                   | /                        | 139.91%  |
| ann-benchmarks | GIST          | 8030.279434             | 2682.22                    | /                        | 199.39%  |
| ann-benchmarks | GloVe         | 4673.163259             | 3473.95                    | /                        | 34.52%   |
| ann-benchmarks | SIFT          | 12968.29436             | 7838.97                    | /                        | 65.43%   |
| VectorDBBench  | Cohere        | 6895.2584               | /                          | 3675.20                  | 87.62%   |

###  4.2.3 可靠性测试结论

索引构建、重建、修改、检索过程进行故障注入，功能正常抛错、数据库状态正常

###  4.2.4 安全&隐私保护测试结论

不涉及

### 4.2.5 可服务性测试结论

不涉及

### 4.2.6 生命周期管理测试结论

不涉及

### 4.2.7 韧性测试结论

不涉及

###  4.2.8 兼容性测试结论

不涉及

###  4.2.9 升级测试结论

不涉及

## 4.3 资料测试结论

| 序号 | 测试章节 | 测试结论                      |
| ---- | -------- | ----------------------------- |
| 1    |          | *整体质量良好/一般/较差，存在 |
|      |          |                               |

# 5 测试对象质量评估

*本章节对被测对象的质量进行评估，主要从需求覆盖、场景覆盖等情况和缺陷发现的情况进行分析，目的是审视被测试的充分性和完备性，以说明上述测试结论的可信。*

##  5.1 覆盖率分析

*对测试的覆盖率进行分析，根据版本具体覆盖策略给出相应覆盖率分析，如需求覆盖情况、代码覆盖情况、场景覆盖等。根据产品覆盖策略给出覆盖率统计，对于覆盖率异常情况给出分析和后续措施。*

##  5.2 缺陷统计和分析

*给出各特性或模块缺陷的分布或分类统计以及缺陷走势分析。建议通过表格说明，下表仅供参考，不作为强制输出方式*

###   5.2.1 缺陷统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 7        |      |      |      |        |
| 百分比 |          |      |      |      |        |

###   5.2.2 缺陷列表

| 问题单号 | 问题描述 | 问题级别 | 当前状态 |
| -------- | -------- | -------- | -------- |
|          |          |          |          |

# 6 测试过程评估

*本章节对测试过程进行评估，包括测试策略、测试设计和测试执行，目的是审视测试过程的执行情况，分析有待进一步开展测试和需要改进的地方。*

##  6.1 测试策略回顾

*回顾本阶段的测试策略，建议以表格的方式检查测试策略规定的活动是否都已经落实。*

| 编号 | 特性 | 验证策略                                         | 是否按照测试策略执行 |
| ---- | ---- | ------------------------------------------------ | -------------------- |
| 1    | xxx  | *测试设计阶段与测试owner、TSE、SE对齐的测试策略* | YES/NO               |
|      |      |                                                  |                      |
|      |      |                                                  |                      |

##  6.2 测试设计评估

*提供对本次测试活动的测试设计的评估。可结合测试设计评审建议；评审完成，测试过程中，发现的新增或删减的测试点进行说明。*

| 编号 | 测试点修改说明                                               | 修改原因    | 是否影响测试质量 |
| ---- | ------------------------------------------------------------ | ----------- | ---------------- |
|      | *测试设计评审通过后，在实际测试执行过程中，发现的新增或删减的测试点列举* | *增/删原因* | *是/否*          |
|      |                                                              |             |                  |
|      |                                                              |             |                  |

##  6.3 测试执行评估

*提供对本次测试活动的测试执行过程的评估结论。描述对测试执行活动的改进建议，以供后续测试执行活动中借鉴参考；*

*测试执行活动评估结论可依据以下提供的“测试执行统计数据”及“测试用例执行结果统计数据”进行分析而给出。*

###  6.3.1 测试执行统计数据

| 版本名称 | 工作量投入(人天) | 测试用例数 | 用例执行数 | 发现缺陷数 | 代码量（KLOC） | 缺陷密度 |
| -------- | ---------------- | ---------- | ---------- | ---------- | -------------- | -------- |
|          |                  |            |            |            |                |          |
|          |                  |            |            |            |                |          |

*数据项说明：*

- *版本名称--每个转测版本名称，例如openGauss 6.0.0 B016*
- *工作量投入--与本活动相关的所有工作量投入，包括测试计划、方案、用例、脚本、执行等所有与本测试相关的活动所花的投入，单位“人天”；不包括以前已经统计的投入，不包括开局、用户支援等非测试相关投入；*
- *测试用例数--到本测试活动结束时，本测试活动中所有可用测试用例数；*
- *执行用例数--在本测试活动中执行测试用例数，含手工和自动化用例，多次重复执行同一用例计算为1个；*
- *发现缺陷数--本测试活动总共发现的缺陷数（不含无效问题单数）。*
- 代码量--pr中统计的实际代码量
- *缺陷密度--缺陷个数/代码行数*

###  6.3.2 测试用例执行结果统计数据

*对本次测试用例执行结果统计，其中的字段可根据实际情况进行设计和裁剪。对于Failed，Blocked，Unavailable的测试用例项不为0，须给出说明，并明确相应的后续计划（如：对于物料问题导致未执行用例，则需明确相应的物料计划；对于Blocked用例，需明确问题解决与相应版本的测试时间等）。对于最后一轮测试，要给出相应的规避措施。正文内容写明该需求共计多少用例*

|        | 计划测试用例数 | 实际测试的用例数 | Passed | Failed | Blocked | Unavailable | 执行率 | 执行通过率 |
| ------ | -------------- | ---------------- | ------ | ------ | ------- | ----------- | ------ | ---------- |
| 第一轮 |                |                  |        |        |         |             |        |            |
| 第二轮 |                |                  |        |        |         |             |        |            |
| ...    |                |                  |        |        |         |             |        |            |

*其中：*

*Passed 用例执行成功*

*Failed 用例全部或部分执行结果未通过或者测试执行过程中遇到其他与本用例无关的失效事件*

*Blocked由于产品本身的问题导致用例不可执行*

*Unavailable由于软件本身以外，如环境、工具、物料、时间、人力资源等因素导致用例未执行*

| 异常用例情况       | 影响分析                     | 规避措施                               | 后续计划 |
| ------------------ | ---------------------------- | -------------------------------------- | -------- |
| 如：Failed用例10个 | 描述异常用例对版本测试的影响 | 若是最后一轮测试，要给出相应的规避措施 | xxx      |

# 7 附件

##  7.1 附件1：遗留问题列表

| 序号 | 问题单号 | 问题描述 | 分类 | 问题级别 | 问题分析与影响 | 规避措施                           |
| ---- | -------- | -------- | ---- | -------- | -------------- | ---------------------------------- |
| 1    | XX       | XX       | XX   | XX       | XX             | 恢复手段：集群在core仍可以恢复正常 |

##  7.2 附件2：特性相关PR

*提供本需求相关的代码pr及资料pr*