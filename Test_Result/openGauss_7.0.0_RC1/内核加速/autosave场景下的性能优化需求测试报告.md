![avatar](../../../images/openGauss.png)

版权所有 © 2025 openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订版本 | 修改描述                                     | 作者    |
| --------- | -------- | -------------------------------------------- | ------- |
| 2025.2.12 | 1.0      | autosave场景下的性能优化需求测试报告初稿完成 | liutong |

[TOC]

关键词：TPCC、autosave、性能

摘要：

本文对openGauss 7.0.0-RC1版本autosave场景下的性能优化需求测试情况进行详细说明，并给出最终测试结论。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|        |          |          |

# 1     概述

本特性通过新增参数num_slru_buffers，可以使jdbc参数设置autosave=true场景下的性能值显著提升，如果针对该参数进行调优设置，那么性能与特性合入前相比提升10倍以上，目前可以达到正常性能场景的30%，可以满足用户需求。

# 2     特性测试信息

## 2.1 测试版本信息

###   2.1.1 被测版本

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                 | 测试起始时间 | 测试结束时间 |
| ------------------------ | ------------ | ------------ |
| openGauss 7.0.0-RC1 B013 | 2025-1-23    | 2025-2-6     |
| openGauss 7.0.0-RC1 B014 | 2025-2-7     | 2025-2-12    |

## 2.2 测试环境描述

###  2.2.1 环境硬件信息

硬件环境信息：

| 硬件型号                                                     | 硬件配置信息                                                 | 备注 |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| ARM+openEuler 2P<br />TaiShan 200 (Model 2280 7260)          | CPU：Kunpeng-920 2p 128核<br />内存：1T<br />硬盘：NVME 3.7T * 4<br />OS：openEuler release 20.03 (LTS)<br />文件系统：XFS<br />网卡：4*25GE Hi1822 |      |
| ARM+openEuler 2P<br />TaiShan 200 (Model 2280 7260)          | CPU：Kunpeng-920 2p 128核<br />内存：1T<br />硬盘：NVME 3.7T * 4<br />OS：openEuler release 22.03 (LTS)<br />文件系统：XFS<br />网卡：4*25GE Hi1822 |      |
| 加压端：<br />ARM+openEuler 2P<br />TaiShan 200 (Model 2280 7260) | CPU：Kunpeng-920 2p 128核<br />内存：256G<br />OS：openEuler release 20.03 (LTS)<br />网卡：4*25GE Hi1822 **(与数据库端在同一个交换机)** |      |

### 2.2.2 虚拟化平台

不涉及

### 2.2.3 OS版本

| 操作系统 | OS版本 | 版本说明 |
| -------- | ------ | -------- |

| 操作系统  | OS版本          | 版本说明                  |
| --------- | --------------- | ------------------------- |
| OpenEuler | 20.03 (LTS)     | openEuler 20.03 (LTS)     |
| OpenEuler | 22.03 (LTS-SP4) | openEuler 22.03 (LTS-SP4) |

# 3     测试结论概述

## 3.1   测试整体结论

需求共计执行4个用例，主要覆盖了新参数num_slru_buffers的配置及调优后的性能测试场景，共发现1个问题单，已经验收通过，整体质量良好。

| 测试活动                                                 | 活动评价                                                     |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| 参数配置测试                                             | 使用gs_guc set、alter system set和修改postgresql.conf三种方式对新参数num_slru_buffers进行设置，参数均可以配置成功，正常生效。从旧版本升级至7.0.0-RC1后，也可以修改该参数。参数有明确的取值范围，值设置错误时数据库启动失败并报错，设置正确则参数正常生效，数据库可以正常启动，符合预期。 |
| jdbc参数设置autosave=false场景下特性合入对性能的影响测试 | 使用500仓200并发、用户参数进行tpcc性能测试，特性合入前2p单机场景为56.89w，合入后为58.61w，特性合入前2p主备场景为50.12w，合入后为50.69w，可以认为该特性不会导致性能明显下降，而其他极限性能场景（比如1000仓696并发2p单机、1000仓345并发2p1主1备，1000仓812并发4p单机）在特性合入前后均未出现明显下降，符合预期。 |
| jdbc参数设置autosave=true场景下特性合入对性能的影响测试  | 使用500仓200并发、用户参数进行tpcc性能测试，在jdbc参数设置autosave=true的场景下，特性合入前2p单机场景为1.16w，合入后num_slru_buffers使用默认值，性能为2.73w，特性合入前2p主备场景为8321.22，合入后num_slru_buffers使用默认值，性能为1.62w，可以认为合入后，autosave=true场景相比特性合入前有显著提升，符合预期。 |
| jdbc参数设置autosave=true场景下最优性能测试              | 使用500仓200并发、用户参数进行tpcc性能测试，在jdbc参数设置autosave=true的场景下，设置参数num_slru_buffers='mxact_offset=256,mxact_member=1024'，此时可以认为是最优性能，2p单机性能可以达到21.20w，为特性合入前num_slru_buffers使用默认值场景的10倍以上，为特性合入前2p单机场景的36.1%（超过30%），2p主备可以达到20.62w，为特性合入前num_slru_buffers使用默认值场景的10倍以上，为特性合入前2p主备场景的40.6%（超过30%），符合预期。 |

### 

## 3.2   约束说明

（1）本报告中的各场景测试结果中的处理时间，指的是openGauss的处理时间，不包含其他第三方业务的处理时间；

（2）本次性能测试是在实验室网络环境下，搭建测试环境并进行的性能测试，网络条件较稳定，不考虑现网与实验室的网络条件差异；

（3）本报告中，使用benchmarkSQL工具模拟压力场景，代表的仅是已知业务模型，没有特殊业务场景，不能代表在现网复杂场景下的实际处理能力；

（4）本次测试是在固定的网络、物料、软件版本等配套的前提下进行的，如果实际环境与本次测试存在不同，请自行评估性能差异，本次测试环境具体情况，请参考第二章节。

## 3.3 关键风险和规避措施

无

# 4 版本详细测试结论

## 4.1 特性测试结论

###   4.1.1 新需求质量评价

| 特性                     | 特性价值评估                                                 | 应用说明及关键约束假设依赖 | 关键遗留事项如缺陷等 | 测试整体覆盖情况                                           | 特性质量评估               | 主要风险 |
| ------------------------ | ------------------------------------------------------------ | -------------------------- | -------------------- | ---------------------------------------------------------- | -------------------------- | -------- |
| autosave场景下的性能优化 | 该特性主要对autosave=true场景下的性能进行优化，用户可以在使用autosave=true的场景下感受到大幅度的性能提升。 | 见3.2                      | 无                   | 覆盖了新参数num_slru_buffers的配置及调优后的性能测试等场景 | <font color=green>▮</font> | 无       |

*特性质量评估说明*：

<font color=red><font color=red>●</font></font>： *表示特性不稳定，风险高*

<font color=yellow><font color=yellow>▲</font></font>： *表示特性基本可用，遗留少量问题*

<font color=green>▮</font>： *表示特性质量良好*

## 4.2 产品质量属性目标(DFX)测试结论

###  4.2.1 性能测试结论

不涉及

###  4.2.2 可靠性测试结论

不涉及

###  4.2.3 安全&隐私保护测试结论

不涉及

### 4.2.4 可服务性测试结论

不涉及

### 4.2.5 生命周期管理测试结论

不涉及

### 4.2.6 韧性测试结论

不涉及

###  4.2.7 兼容性测试结论

不涉及

###  4.2.8 升级测试结论

不涉及

## 4.3 资料测试结论

| 序号 | 测试章节                                                     | 测试结论     |
| ---- | ------------------------------------------------------------ | ------------ |
| 1    | https://docs.opengauss.org/zh/docs/latest/docs/DatabaseReference/%E5%86%85%E5%AD%98_GUC%E5%8F%82%E6%95%B0.html | 整体质量良好 |

# 5 测试对象质量评估

##  5.1 覆盖率分析

本次测试主要覆盖了新参数num_slru_buffers的参数配置测试、调优后的性能测试、资料测试等模块。

##  5.2 缺陷统计和分析

###   5.2.1 缺陷统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 0    | 0    | 1      |
| 百分比 | 100%     | 0%   | 0%   | 0%   | 100%   |

###   5.2.2 缺陷列表

| 序号 | issue号                                                      | 问题级别 | 问题简述                                         | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------ | -------- |
| 1    | https://gitee.com/opengauss/openGauss-server/issues/IBLFZF?from=project-issue | 不重要   | 参数num_slru_buffers不支持通过gs_guc set方式设置 | 已验收   |

# 6 测试过程评估

##  6.1 测试策略回顾

| 编号 | 特性         | 验证策略                                                     | 是否按照测试策略执行 |
| ---- | ------------ | ------------------------------------------------------------ | -------------------- |
| 1    | 参数配置测试 | 通过几种不同的修改方式对参数进行修改，验证修改是否成功       | YES                  |
| 2    | 性能测试     | 对参数添加前后以及参数调优之后的场景进行tpcc性能测试，验证参数的添加与修改对性能的提升真实有效 | YES                  |
| 3    | 资料测试     | 整体质量良好，发现问题均已解决，客户可以通过资料正常使用参数num_slru_buffers，参数已注明用途和默认值 | YES                  |

##  6.2 测试设计评估

| 编号 | 测试点修改说明 | 修改原因 | 是否影响测试质量 |
| ---- | -------------- | -------- | ---------------- |
| na   |                |          |                  |

##  6.3 测试执行评估

###  6.3.1 测试执行统计数据

| 版本名称                 | 工作量投入(人天) | 测试用例数 | 用例执行数 | 发现缺陷数 | 代码量（KLOC） | 缺陷密度 |
| ------------------------ | ---------------- | ---------- | ---------- | ---------- | -------------- | -------- |
| openGauss 7.0.0-RC1 B013 | 2                | 4          | 4          | 1          | 1.178          | 0.848    |
| openGauss 7.0.0-RC1 B014 | 2                | 4          | 4          | 1          | 1.178          | 0.848    |

备注：

autosave场景下的性能优化需求测试需求缺陷密度：1/1.178=0.848(个/kloc)，开发质量良好。

###  6.3.2 测试用例执行结果统计数据

|        | 计划测试用例数 | 实际测试的用例数 | Passed | Failed | Blocked | Unavailable | 执行率 | 执行通过率 |
| ------ | -------------- | ---------------- | ------ | ------ | ------- | ----------- | ------ | ---------- |
| 第一轮 | 4              | 4                | 3      | 1      | 0       | 0           | 100%   | 75%        |
| 第二轮 | 4              | 4                | 4      | 0      | 0       | 0           | 100%   | 100%       |

# 7 附件

##  7.1 附件1：遗留问题列表

无

##  7.2 附件2：特性相关PR

需求链接：

https://e.gitee.com/opengaussorg/issues/table?issue=IB0IFL

代码合入链接：

https://gitee.com/opengauss/openGauss-server/pulls/7033

测试用例：

https://devcloud.cn-east-3.huaweicloud.com/cloudtestportal/project/03669bfd256c444bbfda6d7fb8b83bb2/testcase?branch_id=vb100000vvqelovg

资料:

https://docs.opengauss.org/zh/docs/latest/docs/DatabaseReference/%E5%86%85%E5%AD%98_GUC%E5%8F%82%E6%95%B0.html

https://docs.opengauss.org/zh/docs/latest/docs/PerformanceTuningGuide/%E6%A1%88%E4%BE%8B-%E5%AD%90%E4%BA%8B%E5%8A%A1TPCC%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98.html





 

 
