

![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述             | 作者      |
| ---------- | ----------- | -------------------- | --------- |
| 2022-12-26 | 1.0         | 特性测试报告初稿完成 | leishuai6 |
| 2022-12-28 | 1.1         | 修改检视意见         | leishuai6 |

关键词：兼容B库、字符集、字符序、version_comment等参数

摘要：本文档介绍openGauss在兼容B库中，兼容M\*的部分语法，包含2个特性，第一：兼容M\*的version_comment等22个参数；第二：支持查系统支持的字符集和字符序，对两个特性进行测试，并给出最终测试结论。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

openGauss在兼容B库中，支持使用show 参数名的方法查看version_comment等22个参数默认值，也可以在系统表pg_settings中查看参数信息。支持通过show character set查看系统支持的字符集，通过show collation查看系统支持的字符序。

# 2     特性测试信息

| 版本名称                      | 测试起始时间 | 测试结束时间 |
| ----------------------------- | ------------ | ------------ |
| openGauss 3.1.0 build 1f17a97 | 2022-11-02   | 2022-11-04   |
| openGauss 3.1.0 build 2b9ae9a | 2022-11-19   | 2022-11-21   |
| Dolphin 1.0                   | 2022-11-02   | 2022-11-21   |

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | CPU:  Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br>内存：32GB<br>硬盘：100G<br>OS：Centos Linux release 7.7.1908(Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

基于插件dolphin兼容M\*的部分语法测试，含如下两个特性

- 兼容M\*的version_comment等22个参数
- 支持查系统支持的字符集和字符序

其中兼容M*的version_comment等22个参数进行测试，共计执行23条用例，主要覆盖了功能测试和资料测试。功能测试覆盖通过show 参数名或查询pg_settings系统表的方法查询，显示结果是否正确，是否可以修改参数的值，修改后的提示信息是否正确，不同用户执行语法返回结果是否正确。资料测试覆盖校验资料的描述是否正确，示例的执行结果是否成功。累计发现缺陷单3个，缺陷已解决，回归通过，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                               |
| -------- | ------------------------------------------------------ |
| 功能测试 | 通过show 参数名方法查询，返回结果正确，通过            |
| 功能测试 | 查询pg_settings系统表，参数信息正确，通过              |
| 功能测试 | 是否可以修改参数的值，且修改参数的值返回结果正确，通过 |
| 功能测试 | 不同用户执行语法返回结果正确，通过                     |
| 资料测试 | 资料描述完整准确，示例执行结果正确                     |

支持查系统支持的字符集和字符序，共计执行26条用例，主要覆盖了功能测试和资料测试。功能测试覆盖通过show 参数名或查询系统表的方法查询，显示结果是否正确，结合like/where查询返回结果是否正确，不同用户执行语法返回结果是否正确。资料测试覆盖校验资料的描述是否正确，示例的执行结果是否成功。累计发现缺陷单2个，1个非问题取消，1个缺陷已解决，回归通过，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                                 |
| -------- | -------------------------------------------------------- |
| 功能测试 | 通过show charset、show collation查询，返回结果正确，通过 |
| 功能测试 | 查询系统表，参数信息正确，通过                           |
| 功能测试 | 结合like/where查询返回结果是否正确，通过                 |
| 功能测试 | 不同用户执行语法返回结果正确，通过                       |
| 资料测试 | 资料描述完整准确，示例执行结果正确                       |

## 3.2   约束说明

- 特性1 兼容M*的version_comment等22个参数

1. openGauss需使用兼容B库且含dolphin插件
2. 兼容M*5.7版本
3. 除sql_mode、lower_case_table_names、transaction_isolation三个当前版本已支持的参数外，其余参数只读，无法修改，且不涉及参数所指具体功能。

- 特性2 支持查系统支持的字符集和字符序

1. openGauss需使用兼容B库且含dolphin插件
2. 兼容M*5.7版本
3. 使用show cahracter set语法时，Default Collation结果集为空。
4. show collation语法中，Sortlen字段显示为0。
5. openGauss中的排序集在不同的操作系统中，返回字段的ID值不一定相同，在相同的操作系统中，返回的ID依赖插入顺序。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

- 特性1 兼容M*的version_comment等22个参数

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 | 备注 |
| ------ | -------- | ---- | ---- | ---- | ------ | ---- |
| 数目   | 3        | 0    | 1    | 2    | 0      |      |
| 百分比 | 100%     | 0%   | 33%  | 67%  | 0%     |      |

- 特性2 支持查系统支持的字符集和字符序

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 | 备注 |
| ------ | -------- | ---- | ---- | ---- | ------ | ---- |
| 数目   | 2        | 0    | 0    | 2    | 0      |      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |      |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                       | 状态   |
| ---- | ------------------------------------------------------------ | ---- | ---------------------------------------------- | ------ |
| 1    | [I620C2](https://gitee.com/opengauss/Plugin/issues/I620C2?from=project-issue) | 主要 | 修改适配M*数据库参数的值时，数据库stop         | 已验收 |
| 2    | [I6211L](https://gitee.com/opengauss/Plugin/issues/I6211L?from=project-issue) | 次要 | system_time_zone参数的默认值错误               | 已验收 |
| 3    | [I62AB2](https://gitee.com/opengauss/openGauss-server/issues/I62AB2?from=project-issue) | 次要 | lower_case_table_names参数在资料中没有说明     | 已验收 |
| 4    | [I5Z488](https://gitee.com/opengauss/Plugin/issues/I5Z488?from=project-issue) | 次要 | show charset语法返回结果错误                   | 已验收 |
| 5    | [I5Z9KD](https://gitee.com/opengauss/Plugin/issues/I5Z9KD?from=project-issue) | 次要 | 创建数据库时，指定show charset返回的字符集报错 | 已取消 |

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 通过show 参数名及查询系统表的方法查询参数返回值测试

| 测试步骤                                                     | 测试结果                                               |
| ------------------------------------------------------------ | ------------------------------------------------------ |
| 1.show 参数名，查看返回结果是否正确<br />2.通过select * from pg_setting where name = 参数名的方法查看返回结果是否正确 | 共执行2条用例<br />共发现1个bug，1条现已修复且验收通过 |

### 4.1.2 参数的值是否可以修改

| 测试步骤                                              | 测试结果                                                |
| ----------------------------------------------------- | ------------------------------------------------------- |
| 1. 修改参数的值为有效值或无效值，查看返回结果是否正确 | 共执行20条用例<br />共发现1个bug，1条现已修复且验收通过 |

### 4.1.3 不同的用户执行语法返回值的测试

| 测试步骤                               | 测试结果                        |
| -------------------------------------- | ------------------------------- |
| 1.使用不同的用户执行特性1及特性2的语法 | 共执行3条用例，测试结果符合预期 |

### 4.1.4通过show charset、show collation语法及系统表查询返回值的测试

| 测试步骤                                                     | 测试结果                                               |
| ------------------------------------------------------------ | ------------------------------------------------------ |
| 1.show 参数名，查看返回结果是否正确<br />2.通过select * from show_character_ser()查看系统支持的字符集<br />3.通过select * from show_collation()查看系统支持的字符序 | 共执行4条用例<br />共发现1个bug，1条现已修复且验收通过 |

### 4.1.5 show charset/show collation结合like/where查询返回值的测试

| 测试步骤                                               | 测试结果                         |
| ------------------------------------------------------ | -------------------------------- |
| 1. show charset/show collation结合like/where查询返回值 | 共执行20条用例测，试结果符合预期 |

#### 4.1.6 资料测试

| 测试步骤                       | 测试结果                            |
| ------------------------------ | ----------------------------------- |
| 1. 使用方法描述<br>2. 示例测试 | 共发现1个bug，1条现已修复且验收通过 |

## 4.2   测试执行统计数据

##### 特性1 兼容M*的version_comment等22个参数

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 3.1.0 build 1f17a97  | 23         | Passed：1  Failed：22 | 3            |
| openGauss 3.1.0 build 0e2086be | 23         | Passed：23  Failed：0 | 0            |

数据项说明：

- openGauss 3.1.0 build 1f17a97版本测试时发现3个问题单，其中1个为资料问题单，2个为功能问题单。
- openGauss 3.1.0 build 0e2086be版本回归3个问题单，验收通过。
- 缺陷密度为 2(缺陷个数)/0.543k(代码行数)=3.6(个/kloc)。

##### 特性2 支持查系统支持的字符集和字符序

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 3.1.0 build 2b9ae9a  | 26         | Passed：23  Failed：3 | 1            |
| openGauss 3.1.0 build c00e57d2 | 26         | Passed：26  Failed：0 | 0            |

数据项说明：

- openGauss 3.1.0 build 2b9ae9a版本测试时发现1个问题。
- openGauss 3.1.0 build c00e57d2版本回归1个问题单，验收通过。
- 缺陷密度为 1(缺陷个数)/0.429k(代码行数)=2.3(个/kloc)。

## 4.3   后续测试建议

无

# 5     附件

##  5.1 show version_comment语法使用

```
test=# show version_comment;
        version_comment
--------------------------------
 openGauss Server(MulanPSL-2.0)
(1 row)
```

## 5.2 show collation语法使用

```
test=#  show collation;
       collation       | charset |  id   | default | compiled | sortlen
-----------------------+---------+-------+---------+----------+---------
 C.utf8                | utf8    | 13454 |         | Yes      |
 aa_DJ                 | utf8    | 13455 |         | Yes      |
 aa_DJ                 | latin1  | 13456 |         | Yes      |
 aa_DJ.iso88591        | latin1  | 13457 |         | Yes      |
 aa_DJ.utf8            | utf8    | 13458 |         | Yes      |
 aa_ER                 | utf8    | 13459 |         | Yes      |
 aa_ER.utf8            | utf8    | 13460 |         | Yes      |
 aa_ER.utf8@saaho      | utf8    | 13461 |         | Yes      |
 aa_ER@saaho           | utf8    | 13462 |         | Yes      |
 aa_ET                 | utf8    | 13463 |         | Yes      |
 aa_ET.utf8            | utf8    | 13464 |         | Yes      |
 af_ZA                 | utf8    | 13465 |         | Yes      |
 af_ZA                 | latin1  | 13466 |         | Yes      |
 --More--
```