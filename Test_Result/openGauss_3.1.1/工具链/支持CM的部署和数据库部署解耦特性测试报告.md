

![avatar](../../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。
修订记录

| 日期      | 修订   版本 | 修改描述             | 作者    |
| :-------- | ----------- | -------------------- | ------- |
| 2022-12-29 | 1.0         | 特性测试报告初稿完成 | qiuying |
|            |             |                      |         |

 关键词： 

CM、部署、解耦

摘要：

本文档主要介绍通过CM工具实现CM的部署和解耦，且不会影响原有集群，并给出最终测试结论。 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|CM     | Cluster Manager         |  统一数据库管理工具        |

# 1     特性概述

使用cm_install工具在未部署CM的openGauss数据库集群上部署CM，使用cm_uninstall在已部署CM的openGauss集群上卸载掉CM，且不会影响DN集群。

# 2     特性测试信息

| 版本名称             | 测试起始时间 | 测试结束时间 |
| -------------------- | ------------ | ------------ |
| openGauss 3.1.1 B002 | 2022-10-27   | 2022-11-20   |
| openGauss 3.1.1 B007 | 2022-11-23   | 2022-11-28   |
| openGauss 3.1.1 B009 | 2022-12-01   | 2022-12-03   |

| 环境信息      | 配置信息                                                 | 备注 |
| ------------- | ------------------------------------------------------------ | ---- |
| 虚拟机 | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300G<br/>OS：openEuler release 20.03 (LTS-SP1) |      |

# 3     测试结论概述

## 3.1   测试整体结论

CM部署和数据库部署解耦，共计执行75条用例，主要覆盖了功能测试、可靠性和资料测试。功能测试覆盖在不同的执行场景，使用不同的参数实现CM的部署和数据库部署解耦。可靠性测试覆盖在CM部署后CM的仲裁能力是否正常。资料测试覆盖校验资料的描述及示例的执行结果是否成功。累计发现缺陷单10个，已全部解决且回归通过，整体质量良好。

| 测试活动   | 活动评价                                                     |
| ---------- | :----------------------------------------------------------- |
| 功能测试   | 使用不同或合理的参数部署和解耦CM，执行正常打印合理且有明确的日志信息 |
| 功能测试   | 使用不同的用户和主备节点执行CM的部署和数据库解耦，执行结果正常 |
| 功能测试   | CM部署和解耦交叉反复测试，执行结果正常                       |
| 可靠性测试 | CM部署后双主场景仲裁能力正常                                 |
| 资料测试   | 资料对于新增加的功能描述准确，示例的执行结果正确，整体质量良好 |

## 3.2   约束说明

- 数据库可适配安装CM

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 10    | 0    | 2 | 8   | 0     |
| 百分比 |  100%        | 0%   | 20% | 80% | 0%   |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I5YR41](https://e.gitee.com/opengaussorg/issues/list?issue=I5YR41) | 次要     | 使用cm_uninstall卸载cm,相关cm文件未清理干净 | 已验收   |
| 2    | [I5YRDM](https://e.gitee.com/opengaussorg/issues/list?issue=I5YRDM) | 次要     | cm的安装卸载指令必须到指定路径，默认无执行权限，执行完安装后，安装和卸载权限被取消 | 已验收   |
| 3    | [I5YRK6](https://e.gitee.com/opengaussorg/issues/list?issue=I5YRK6) | 主要    | 数据库主机term值为0时，双主场景不能正常仲裁，build执行失败 | 已验收   |
| 4    | [I5YRPX](https://e.gitee.com/opengaussorg/issues/list?issue=I5YRPX) | 次要     | 执行cm_install时，指定参数路径为相对路径，执行成功/提示超时失败 | 已验收   |
| 5    | [I5YS26](https://e.gitee.com/opengaussorg/issues/list?issue=I5YS26) | 次要     | cm_uninstall帮助信息显示有误，参数指定错误提示不合理 | 已验收   |
| 6    | [I5YS5B](https://e.gitee.com/opengaussorg/issues/list?issue=I5YS5B) | 次要     | cm 卸载时使用带cm的xml文件，卸载成功,gs_om查询状态提示cm_ctl命令不可用 | 已验收   |
| 7    | [I5YSUH](https://e.gitee.com/opengaussorg/issues/list?issue=I5YSUH) | 次要   | 执行cm_install时，指定参数-X异常时，提示不合理   | 已验收 |
| 8    | [I5ZAY9](https://e.gitee.com/opengaussorg/issues/list?issue=I5ZAY9) | 次要   | 数据库状态正常时安装cm，安装提示不存在主节点，不需要刷新动态文件 | 已验收 |
| 9 | [I5ZB2D](https://e.gitee.com/opengaussorg/issues/list?issue=I5ZB2D) | 主要 | 数据库停止状态下，卸载cm之后，数据库不能正常启动 | 已验收 |
| 10 | [I5ZB6T](https://e.gitee.com/opengaussorg/issues/list?issue=I5ZB6T) | 次要 | 破坏用户互信后，执行cm的卸载，报错不合理 | 已验收 |

# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 指定不同参数测试

| 测试步骤：                                                   | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1. 配置xml文件中各项参数<br/>2. 指定不同的参数执行部署和解耦 | 执行45条用例，发现9个bug，现已修复且验收通过 |

### 4.1.2 不同用户和节点测试

| 测试步骤：                                                   | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1. 在主节点，备节点，级联备节点执行部署和解耦<br/>2.使用数据库用户和root用户执行部署和解耦<br/>3.在不同的集群状态下执行部署和解耦<br/>4.查看集群状态正常 | 执行22条用例，发现1个bug，现已修复且验收通过 |

### 4.1.3 部署和解耦组合测试

| 测试步骤：                                            | 测试结果                          |
| ----------------------------------------------------- | --------------------------------- |
| 1. 部署或解耦失败后，再次执行<br/>2. 查看集群状态正常 | 执行5条用例，未发现问题，验收通过 |

### 4.1.4 故障场景测试

| 测试步骤：                                      | 测试结果                          |
| ----------------------------------------------- | --------------------------------- |
| 1. cm部署后注入故障测试<br/>2. 查看集群状态正常 | 执行3条用例，未发现问题，验收通过 |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果            | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------- | ------------ |
| openGauss 3.1.1 B002 | 75        | Passed：75<br>Failed：65 | 10          |
| openGauss 3.1.1 B007 | 75        | Passed：34<br>Failed：41 | 0          |
| openGauss 3.1.1 B009 | 75        | Passed：75<br>Failed：0 | 0           |

*数据项说明：*

* 累计发现缺陷单10个，现已解决且回归通过
* 失败用例已在后续问题修复后，回归issue执行通过
* 缺陷密度为10(缺陷个数)/2.4k(代码行数)=4.2(个/kloc)。

## 4.3   后续测试建议

无

# 5     附件

无
