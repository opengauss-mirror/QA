

![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述     | 作者        |
| :--------- | ----------- | ------------ | ----------- |
| 2022-11-28 | 1.0         | 特性测试报告 | houshaolong |

 关键词： 

DataStudio、存储过程、覆盖率

 摘要：

本工具实现了DataStudio适配dbe_pldebugger存储过程的覆盖率工具，满足DataStudio对存储过程覆盖率统计分析的需求。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

基于DataStudio开源项目不能适配版本openGauss3.0.0及以上版本调试组件dbe_pldebugger，该项目适配openGauss3.0.0调试组件dbe_pldebugger，增加DataStudio对openGauss存储过程的覆盖率工具，并实现DataStudio对存储过程覆盖率统计分析的需求。

# 2     特性测试信息

被测对象的版本信息：

| 版本名称          | 测试起始时间 | 测试结束时间 |
| ----------------- | :----------- | ------------ |
| Data Studio 3.1.0 | 2022-10-27   | 2022-11-8    |
| Data Studio 3.1.0 | 2022-11-9    | 2022-11-15   |
| Data Studio 3.1.0 | 2022-11-16   | 2022-11-23   |
| Data Studio 3.1.0 | 2022-11-24   | 2022-11-28   |

硬件环境信息：

| 硬件型号                 | 硬件配置信息                                                 | 备注                           |
| ------------------------ | ------------------------------------------------------------ | ------------------------------ |
| TaiShan 200 (Model 2280) | Architecture：aarch64<br />CPU：kunpeng-920 7260<br />内存：768GB<br />硬盘：3.0TB<br />OS：openEuler release 20.03 (LTS-SP1) | openGauss 3.0.0 build cad66d01 |

| Windows信息       | 硬件配置信息                                                 | 备注 |
| ----------------- | ------------------------------------------------------------ | ---- |
| Windows 10 专业版 | 处理器：intel(R) Xeon(R) cpu E5-2690 v4 @2.6GHz<br />内存：298GB<br />已安装的内存：16.0GB |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss存储过程的覆盖率工具，实现DataStudio对存储过程覆盖率统计分析的需求，共执行用例36个，提交问题单13个，无遗留风险，整体质量良好。

| 测试活动     | 活动评价                                                     |
| ------------ | ------------------------------------------------------------ |
| 功能测试     | 右键存储过/函数名，单击启动调试，调试成功，覆盖率报告合理准确，通过 |
| 功能测试     | 右键存储过/函数名，按快捷键F12启动调试，调试成功，覆盖率报告合理准确，通过 |
| 功能测试     | 通过步进进行调试，调试成功，覆盖率报告合理准确，通过         |
| 功能测试     | 存储过程/函数包含建表语句，调试成功，覆盖率报告合理准确，通过 |
| 功能测试     | 存储过程包含控制语句，调试成功，覆盖率报告合理准确，通过     |
| 易操作性测试 | 多次点击各操作按钮，按键功能正常，快捷键生效，按键命名合理无歧义 |
| 兼容性测试   | 对导出的html格式的历史覆盖率，分别选择用谷歌浏览器、IE浏览器、Edge、火狐浏览器等打开，观察格式是否准确 |
| 资料测试     | 资料描述准确，示例完整，可正确操作，格式正确，测试通过       |

## 3.2   约束说明

1、Java/Jdk需要版本为11及其以上版本。

2、建立远程连接的数据库需配置白名单，且连接的用户不能为初始用户。

3、数据库需要使用3.0.0及其以上版本

## 3.3   遗留问题分析

### 3.3.1  遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2  问题统计

|        | 问题总数 | 严重 | 主要  | 次要  | 不重要 |
| ------ | -------- | ---- | ----- | ----- | ------ |
| 数目   | 13       | 0    | 2     | 10    | 1      |
| 百分比 | 100%     | 0%   | 15.4% | 69.2% | 7.7%   |

### 3.3.3  问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I5YX46](https://gitee.com/opengauss/DataStudio/issues/I5YX46?from=project-issue) | 主要     | 当函数返回值有多个时，调试结果只显示第一条返回值             | 已验收   |
| 2    | [I61BL4](https://gitee.com/opengauss/DataStudio/issues/I61BL4?from=project-issue) | 主要     | 调试过程中，如果关掉sql终端函数，不显示调试未结束提示，导致后续函数无法调试 | 已验收   |
| 3    | [I5YWXB](https://gitee.com/opengauss/DataStudio/issues/I5YWXB?from=project-issue) | 次要     | DS历史覆盖率按键图标和对话框图标不一致，且历史覆盖率报告未显示入参 | 已验收   |
| 4    | [I5YX12](https://gitee.com/opengauss/DataStudio/issues/I5YX12?from=project-issue) | 次要     | DS覆盖率报告导出时命名未显示函数名，且导出覆盖率图标与其他功能图标相同 | 已验收   |
| 5    | [I5YX2X](https://gitee.com/opengauss/DataStudio/issues/I5YX2X?from=project-issue) | 次要     | 覆盖率统计时会把代码里面的空行也统计进去                     | 已验收   |
| 6    | [I5YX4Z](https://gitee.com/opengauss/DataStudio/issues/I5YX4Z?from=project-issue) | 次要     | 函数的标记行/取消标记行(覆盖率)功能需要优化                  | 已验收   |
| 7    | [I5YX6A](https://gitee.com/opengauss/DataStudio/issues/I5YX6A?from=project-issue) | 次要     | DS英文模式下，remark line /Unremark Line(coverage) 格式有误  | 已验收   |
| 8    | [I5YX6S](https://gitee.com/opengauss/DataStudio/issues/I5YX6S?from=project-issue) | 次要     | DS中存储过程覆盖率的相关资料未添加到用户手册                 | 已验收   |
| 9    | [I5ZVBM](https://gitee.com/opengauss/DataStudio/issues/I5ZVBM?from=project-issue) | 次要     | 对存储过程进行调试时，未执行的代码首行没有红点               | 已验收   |
| 10   | [I61B6L](https://gitee.com/opengauss/DataStudio/issues/I61B6L?from=project-issue) | 次要     | 调试时，调用堆栈中的函数信息需显示为函数名                   | 已验收   |
| 11   | [I61P8L](https://gitee.com/opengauss/DataStudio/issues/I61P8L?from=project-issue) | 次要     | 调试函数，红绿点标记有误                                     | 已验收   |
| 12   | [I60IP7](https://gitee.com/opengauss/DataStudio/issues/I60IP7?from=project-issue) | 次要     | DS用户手册关于覆盖率统计章节描述不规范                       | 已验收   |
| 13   | [I61O9J](https://gitee.com/opengauss/DataStudio/issues/I61O9J?from=project-issue) | 不重要   | 函数无入参时，调试结束，返回debug result结果不合理           | 已验收   |

# 4     测试执行

## 4.1  测试执行步骤

### 4.1.1   右键存储过/函数名，单击启动调试，并观察覆盖率报告是否合理准确

| 测试步骤：                                                   | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建存储过程/函数<br/>2.右键存储过程/函数名，单击启动调试<br/>3.单击继续<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行条6用例，发现bug3个，验收通过 |

### 4.1.2   右键存储过/函数名，按快捷键F12启动调试，并观察覆盖率报告是否合理准确

| 测试步骤：                                                   | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建存储过程/函数<br/>2.右键存储过程/函数名，单击启动调试<br/>3.单击继续<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行6条用例，发现bug1个，验收通过 |

### 4.1.3    双击存储过/函数名，单击启动调试按钮，并观察覆盖率报告是否合理准确

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建存储过程/函数<br/>2.右键存储过程/函数名，单击启动调试<br/>3.单击继续<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行6条用例，发现bug3个，验收通过 |

### 4.1.4  通过步进进行调试，并观察覆盖率报告是否合理准确

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建存储过程/函数<br/>2.右键存储过程/函数名，单击启动调试<br/>3.单击步进直按钮至调试结束<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行3条用例，发现bug1个，验收通过 |

### 4.1.5  存储过程/函数包含建表语句，进行调试，并观察覆盖率报告是否合理准确

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建包含建表语句的存储过程/函数<br/>2.双击存储过程/函数，单击启动调试<br/>3.单击继续，调试结束<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行2条用例，发现bug1个，验收通过 |

### 4.1.6  存储过程包含控制语句时进行调试，并观察覆盖率报告是否合理准确

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建包含控制语句的存储过程/函数<br/>2.右键存储过程，单击启动调试<br/>3.单击步进直按钮至调试结束<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行3条用例，发现bug1个，验收通过 |

### 4.1.7  存储过程/函数包含空行时进行调试，并观察覆盖率报告是否合理准确

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 1.创建包含空行的存储过程/函数<br/>2.右键存储过程，单击启动调试<br/>3.单击步进直按钮至调试结束<br/>4.检查调试结果、覆盖率结果<br/>5.检查导出后覆盖率格式是否合理，命名是否合理准确 | 执行条3用例，发现bug1个，验收通过 |

### 4.1.8  易操作性测试

| 测试步骤                                                     | 测试结果                          |
| ------------------------------------------------------------ | --------------------------------- |
| 多次点击各操作按钮，按键功能正常，快捷键生效，按键命名合理无歧义 | 执行1条用例，发现bug1个，验收通过 |

### 4.1.9  兼容性测试

| 测试步骤                                                     | 测试结果                         |
| ------------------------------------------------------------ | -------------------------------- |
| 对导出的html格式的历史覆盖率，分别选择用谷歌浏览器、IE浏览器、Edge、火狐浏览器等打开，观察格式是否准确 | 执行4条用例，未发现bug，验收通过 |

### 4.1.10  资料测试

| 测试步骤                                               | 测试结果                          |
| ------------------------------------------------------ | --------------------------------- |
| 资料描述准确，示例完整，可正确操作，格式正确，测试通过 | 执行1条用例，发现bug1个，验收通过 |

### 4.1.11  后续测试建议

1.考虑复杂场景的存储过程/函数进行调试

## 4.2   测试执行统计数据

| 版本名称          | 测试用例数 | 用例执行结果                | 发现问题单数 |
| ----------------- | ---------- | --------------------------- | ------------ |
| Data Studio 3.1.0 | 20         | Passed：13  <br />Failed：7 | 7            |
| Data Studio 3.1.0 | 25         | Passed：22  <br />Failed：3 | 3            |
| Data Studio 3.1.0 | 36         | Passed：33  <br />Failed：3 | 3            |
| Data Studio 3.1.0 | 36         | Passed：36<br />Failed：0   | 0            |

*数据项说明：*

* 累计发现缺陷单13个，其中13个缺陷均已解决且回归通过
* 失败用例已在后续问题修复后，回归issue执行通过
* 缺陷密度：13(缺陷个数)/5.531kloc(代码行数)=2.35(个/kloc)

# 5     附件
## 5.1   调试过程示例及覆盖率报告示例
调试前：首行会以红点标记未执行行状况

![输入图片说明](images/%E8%B0%83%E8%AF%95%E5%89%8D.png)

调试中：绿点标记执行行状况

![输入图片说明](images/%E8%B0%83%E8%AF%95%E4%B8%AD.png)

调试结束：执行行首行均为绿点

![输入图片说明](images/%E8%B0%83%E8%AF%95%E7%BB%93%E6%9D%9F.png)

覆盖率报告：

![输入图片说明](images/%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A.png)