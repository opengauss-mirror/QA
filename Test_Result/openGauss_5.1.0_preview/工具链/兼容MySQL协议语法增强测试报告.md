![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订版本 | 修改描述             | 作者  |
| :--------- | -------- | -------------------- | ----- |
| 2023-09-2  | 1.0      | 特性测试报告初稿完成 | xiaqi |
| 2023-09-14 | 1.1      | 修改特性测试报告     | xiaqi |

关键词： 

M*、dolphin插件、协议、`JDBC`

摘要：

本文档主要基于dolphin插件兼容M*协议增强的语法特性进行测试并给出最终测试结论。即分别使用M\*客户端和`JDBC`连接openGauss的兼容B库，使得B库兼容语法可以通过M\*客户端和`JDBC`连接的两种方式执行并获取返回结果。

# 1	特性概述

基于dolphin插件，实现openGauss对M*协议的语法特性兼容。

- 第一，使用M\*客户端连接openGauss兼容B库，并执行相关SQL语句；


- 第二，使用M\*`JDBC`连接openGauss兼容B库，并执行相关SQL语句；


# 2	特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.0 build 46d51516 | 2023-8-18    | 2023-08-24   |
| openGauss 5.1.0 build 24d9203f | 2023-09-13   | 2023-09-14   |

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300G<br/>OS：openEuler release 20.03 (LTS-SP1) |      |

# 3	测试结论概述

## 3.1 测试整体结论

基于dolphin插件兼容M*协议增强的语法特性测试，共计执行60条用例，主要覆盖了功能测试和资料测试。功能测试覆盖以下7点：

1. M\*客户端`TCP/IP`连接测试及创建用户连接测试；
2. `CREATE/DROP DATABASE/SCHEMA`测试；
3. `CREATE TABLE`结合约束及表类型和分区表测试；
4. `ALTER TABLE`结合列操作及分区操作测试；
5. mysql系统参数的功能验证；
6. 协议插件⾃启动功能测试；
7. insert自增列返回查询验证；
8. 多种数据类型建表测试；
9. mysql系统参数适配测试；
10. unix domain socket⽀持；
11. exec_simple_query函数 替换SPI_EXECUTE函数；
12. vacuum执行验证；
13. optimize执行验证；

累计发现缺陷单1个，所有缺陷已解决，回归通过，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | :----------------------------------------------------------- |
| 功能测试 | M\*客户端`TCP/IP`连接测试及创建用户连接测试，执行结果符合预期，通过 |
| 功能测试 | `CREATE/DROP DATABASE/SCHEMA`测试，执行结果符合预期，通过    |
| 功能测试 | `CREATE TABLE`结合约束及表类型和分区表测试，执行结果符合预期，通过 |
| 功能测试 | `ALTER TABLE`结合列操作及分区操作测试，执行结果符合预期，通过 |
| 功能测试 | mysql系统参数的功能测试，执行结果符合预期，通过              |
| 功能测试 | 协议插件⾃启动功能测试，执行结果符合预期，通过               |
| 功能测试 | insert自增列返回查询验证，执行结果符合预期，通过             |
| 功能测试 | exec_simple_query函数 替换SPI_EXECUTE函数测试，执行结果符合预期，通过 |
| 功能测试 | unix domain socket支持路径切换测试，执行结果符合预期，通过   |

## 3.2	约束说明

- M*客户端需使用5.7.x版本，低于5.7.x的小版本兼容待后续迭代优化；
- openGauss需使用兼容B库；
- M\*`JDBC`需使用5.1.47版本；
- 使用M\*客户端连接B库前需先使用`gsql`客户端连接一次B库，才能加载`DOLPHIN`动态库，拉起指定端口，否则会连接失败；
- 使用unix domain socket 连接B库，需搭建的数据库和mysql部署在同一台服务器；

## 3.3    遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 |
| -------- | -------- |
| NA       |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 0    | 1    | 0      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                    | 问题级别 | 问题简述                                        | 问题状态 |
| ---- | ---------------------------------------------------------- | -------- | ----------------------------------------------- | -------- |
| 2    | [I7X75N](https://gitee.com/opengauss/Plugin/issues/I7X75N) | 次要     | 使用mysql客户端连接B库，tinyint数据类型插入失败 | 已验收   |

# 4    测试执行

## 4.1 测试执行步骤

###  4.1.1 M\*客户端`TCP/IP`连接测试及创建用户连接测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1.指定正确的`-h -P`参数测试连接<br/>2.指定错误的`-h`参数测试连接<br/>3.指定错误的`-P`参数测试连接<br/>4.新建用户并指定新用户连接B库 | 执行2条用例<br/>未发现bug<br/>执行通过 |

### 4.1.2 `CREATE/DROP DATABASE/SCHEMA`测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1.`CREATE DATABASE`<br/>2.`CREATE SCHEMA`<br/>3.`DROP DATABASE`<br/>4.`DROP SCHEMA` | 执行1条用例<br/>未发现bug<br/>执行通过 |

### 4.1.3 `CREATE TABLE`结合约束、存储引擎、`COMMENT`及表类型和分区表测试

| 测试步骤                                                     | 测试结果                                |
| ------------------------------------------------------------ | --------------------------------------- |
| 1.`CREATE TABLE`结合`PRIMARY KEY/FOREIGN KEY/UNIQUE/NOT NULL`约束<br/>2.`CREATE TABLE`结合`COMMENT`<br/>3.`CREATE TABLE`结合存储引擎<br/>4.`CREATE TABLE`结合字符集和排序规则<br/>5.创建`USTORE/UNLOGGED/SEGMENT`表<br/>6.创建一级分区表和二级分区表 | 执行10条用例<br/>未发现bug<br/>执行通过 |

### 4.1.4 `ALTER TABLE`结合列操作及分区操作测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1.`ALTER TABLE ADD/DROP/MODIFY`修改列<br/>2.`ALTER TABLE REBUILD/REMOVE/CHECK/REPAIR/OPTIMIZE`分区操作 | 执行2条用例<br/>未发现bug<br/>执行通过 |

### 4.1.5 mysql系统包含参数的功能验证

| 测试步骤                                                     | 测试结果                                |
| ------------------------------------------------------------ | --------------------------------------- |
| 1.`SELECT@@session.auto_increment_increment AS auto_increment_increment`<br/> | 执行20条用例<br/>未发现bug<br/>执行通过 |

### 4.1.6 协议插件⾃启动功能测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1.`gs_om  -t restart`<br/>2.netstat -anp grep 3307 查询插件进程 <br/> | 执行2条用例<br/>未发现bug<br/>执行通过 |

### 4.1.7 insert自增列返回查询验证

| 测试步骤                                                     | 测试结果                                           |
| ------------------------------------------------------------ | -------------------------------------------------- |
| 1.`CREATE TABLE auto_increment primary key`<br/>2.`SELECT * FROM TABLE`并查询不同数据类型自增 | 执行10条用例<br/>发现1条bug<br/>现已解决且回归通过 |

### 4.1.8 exec_simple_query函数测试

| 测试步骤                           | 测试结果                                   |
| ---------------------------------- | ------------------------------------------ |
| 1.`VACUUM`<br/> 2.`OPTIMIZE TABLE` | 执行2条用例<br/>未发现发现bug<br/>执行通过 |

### 4.1.9 unix domain socket路径测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1.`gs_guc reload -D dn1 -c unix_socket_directory`<br/>2.`./mysql -S  .s.PGSQL.3307 ` 客户端登录opengass | 执行8条用例<br/>未发现bug<br/>执行通过 |

### 4.1.10 资料测试

| 测试步骤                             | 测试结果 |
| ------------------------------------ | -------- |
| 1.资料描述是否准确、示例能否正确执行 | 不涉及   |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果            | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------- | ------------ |
| openGauss 5.1.0 build 46d51516 | 58         | Passed：57<br>Failed：1 | 1            |
| openGauss 5.1.0 build 24d9203f | 58         | Passed：58<br>Failed：0 | 0            |

数据项说明：

* 缺陷密度：1(缺陷个数)/0.515kloc(代码行数)=1.94(个/kloc)

## 4.3  后续测试建议

-  验证高于5.7.x版本的M\*客户端连接openGauss兼容B库的执行结果



