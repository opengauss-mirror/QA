![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述         | 作者     |
| ---------- | ----------- | ---------------- | -------- |
| 2023-06-28 | 1.0         | 特性测试报告初稿 | lihongji |

关键词： chameleon、M*、openGauss、csv文件

摘要：全量迁移chameleon工具的增强特性，支持直接读取csv文件用于数据迁移，因省去了在源库MySQL执行select查询语句获取源库的表数据生成csv文件，所以减少了数据迁移的耗时。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

​        该特性来源于外部客户，客户场景中应用会下发表的csv文件。期望该特性可支持直接通过读取csv文件用于数据迁移。相比原有的实现方案，该特性可省去从源库查询表数据并生成csv文件的步骤，可减少迁移耗时，提升迁移性能。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.0 build 68d1772f | 2023-06-12   | 2023-06-19   |
| chameleon 5.0.0                | 2023-06-12   | 2023-06-19   |
| M* 5.7                         | 2023-06-12   | 2023-06-19   |

描述特性测试的硬件环境信息

| 硬件型号                 | 硬件配置信息                                                 | 备注      |
| ------------------------ | ------------------------------------------------------------ | --------- |
| TaiShan 200 (Model 2280) | Architecture：aarch64<br />CPU：kunpeng-920 2600MHz <br />内存：765GB<br />硬盘：3.0TB<br />OS：openEuler release 20.03 (LTS) | M*        |
| TaiShan 200 (Model 2280) | Architecture：aarch64<br />CPU：kunpeng-920 2600MHz <br />内存：765GB<br />硬盘：7.3TB<br />OS：openEuler release 20.03 (LTS) | chameleon |
| TaiShan 200 (Model 2280) | CPU:  Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz<br>内存：31GB<br>硬盘：724G<br>OS：CentOS Linux release 7.6.1908 (Core)<br> | openGauss |

# 3     测试结论概述

## 3.1   测试整体结论

​        全量迁移工具支持读取csv文件用于迁移，共计执行27条用例，主要覆盖了功能测试、性能测试、资料测试。功能测试验证了参数的有效性，能够通过配置迁移csv文件；性能测试验证，通过csv文件迁移速率高于原始迁移速率（10张表5000w数据测试数据）。资料测试中描述恰当，示例正确无误。共计发现1个问题，无遗留风险，需求整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 通过参数配置可迁移对应的csv文件。通过                        |
| 性能测试 | 10张表，每张表5000w的数据量下通过读取csv文件用于迁移的速率高于原始迁移速率，通过 |
| 资料测试 | 使用方法描述准确，示例正确无误，通过                         |
## 3.2   约束说明

2. M*使用5.7版本，openGauss为兼容B库；

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | :------: | :--: | :--: | :--: | :----: |
| 数目   |    1     |  0   |  0   |  1   |   0    |
| 百分比 |   100%   |  0%  |  0%  | 100% |   0%   |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                                     | 状态   |
| ---- | ------------------------------------------------------------ | ---- | ------------------------------------------------------------ | ------ |
| 1    | [I7DQRP](https://gitee.com/opengauss/openGauss-tools-chameleon/issues/I7DQRP?from=project-issue) | 次要 | 全量迁移工具支持读取csv文件用于数据迁移，当csv文件异常（如：列字段名称不正确。csv文件列名不存在，contain_columns配置为Yes），程序报错后未自动终止进程，一直打印错误直到读完csv文件 | 已完成 |



# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 功能测试

| 测试步骤：                                                   | 测试结果                           |
| ------------------------------------------------------------ | ---------------------------------- |
| 1. 在yml文件中配置csv_dir、contain_columns、column_split参数<br />2. 在M*中导出csv文件放至指定目录，启动chameleon工具<br />3.通过读取csv文件迁移数据 | 共执行23条用例，<br />共发现1个bug |

### 4.1.2 性能测试

| 测试步骤：                                                   | 测试结果                     |
| ------------------------------------------------------------ | ---------------------------- |
| 1. 10张表，每张表5000万数据，分别通过初始方法与csv文件读取<br/>方法进行性能测试(表含主键与不含主键)<br/>2. 通过读取csv文件的迁移速率大于初始方法即从MySQL库中查询的迁移速率<br | 共执行4条用例<br />未发现bug |

### 4.1.3 资料测试

| 测试步骤：                     | 测试结果  |
| ------------------------------ | --------- |
| 1. 使用方法描述<br>2. 示例测试 | 未发现bug |

## 4.2   测试执行统计数据

|            版本名称            | 测试用例数 |     用例执行结果     | 发现问题单数 |
| :----------------------------: | :--------: | :------------------: | :----------: |
| openGauss 5.1.0 build 68d1772f |     27     | Passed：26 Failed：1 |      1       |

数据说明

2. 缺陷密度为1(缺陷个数)/0.399k(代码行数)=2.5(个/kloc)

## 4.3   后续测试建议

无

# 5     附件

```sql
# 在MySQL端将表数据导出至csv文件：
select * from tableName
 into outfile '/*****/fileName.csv'
 fields enclosed by '"' terminated by ',' escaped by '"'
 lines terminated by '\r\n';
```