![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订版本 | 修改描述             | 作者    |
| --------- | -------- | -------------------- | ------- |
| 2023.9.25 | 1.0      | 性能测试报告初稿完成 | liutong |

 关键词：性能测试、openGauss 5.1.0、tpmC、RTO、迁移工具



摘要：

 本文对openGauss 5.1.0版本性能测试情况进行详细说明，并给出最终测试结论。



缩略语清单：

| 缩略语 | 英文全名                                   | 中文解释                                                     |
| ------ | ------------------------------------------ | ------------------------------------------------------------ |
| TPC    | Transaction Processing Performance Council | 事务处理性能委员会                                           |
| TPC-C  | Trade Promotion Coordination Committee     | 在线事务处理（OLTP）的基准程序                               |
| tpmC   | transaction per minute                     | TPC-C的吞吐量，按有效TPC-C配置期间每分钟处理的平均交易次数测试 |
| RTO    | Recovery Time Objective                    | 恢复时间目标，主要指所能容忍的业务停止服务的最长时间，也就是从灾难发生到业务系统恢复服务功能所需要的最短时间周期 |
| tps    | transaction per second                     | 每秒钟系统能够处理的交易或事务的数量                         |

# 1     特性概述

本节描述特性提供的基本能力。

tpmC：高性能特性指标，总用例数5个。包括2P ARM环境下单节点1H、2P ARM环境下单节点8H、2P ARM环境下一主一备1H、2P ARM环境下一主一备8H、4P ARM环境下单节点1H。

RTO：高可用特性，总用例数2个。使用benchmarksql工具对主备节点进行加压，在2P环境下进行空负载、CPU占比在50%压力下进行failover操作，对业务恢复时间特性进行测试。

tps|MB/s：mysql迁移openGauss性能指标，总用例数5个。包括使用工具进行全量迁移、增量迁移、反向迁移的速度、全量数据校验速度、以及资源池化场景。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称             | 测试起始时间 | 测试结束时间 |
| -------------------- | ------------ | ------------ |
| openGauss 5.1.0 RC16 | 2023-8-24    | 2023-8-31    |
| openGauss 5.1.0 RC18 | 2023-9-7     | 2023-9-13    |
| openGauss 5.1.0 RC19 | 2023-9-14    | 2023-9-25    |

硬件环境信息：

| 硬件型号                                                     | 硬件配置信息                                                 | 备注 |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| ARM+openEuler 2P<br />TaiShan 200 (Model 2280 7260)          | CPU：Kunpeng-920 2p 128核<br />内存：768G<br />硬盘：NVME 3.7T * 4<br />OS：openEuler release 20.03 (LTS)<br />文件系统：XFS<br />网卡：4*25GE Hi1822<br />资源池化使用的磁阵：OceanStor Dorado 18000 V6 6.0.1(3.8T NvmeSSD * 36) |      |
| ARM+openEuler 4P<br />TaiShan 200 (Model 2480 7260)          | CPU：Kunpeng-920 4p 256核<br />内存：1T<br />硬盘：NVME 3T * 4<br />OS：openEuler release 20.03 (LTS)<br />文件系统：XFS<br />网卡：4*25GE Hi1822<br />资源池化使用的磁阵：OceanStor Dorado 18000 V6 6.0.1(3.8T NvmeSSD * 36) |      |
| 加压端：<br />ARM+openEuler 2P<br />TaiShan 200 (Model 2280 7260) | CPU：Kunpeng-920 2p 128核<br />内存：256G<br />OS：openEuler release 20.03 (LTS)<br />网卡：4*25GE Hi1822 **(与数据库端在同一个交换机)** |      |

OS版本说明如下：

| 操作系统  | OS版本      | 版本说明                                                     |
| --------- | ----------- | ------------------------------------------------------------ |
| OpenEuler | 20.03 (LTS) | openEuler 20.03 (LTS)，aarch版本ISO:<br />SHA256:419592be9cba55a2b800e761d865550f28133875920e7bb9c2d5cdaad90a9cbf |

# 3     测试结论概述

## 3.1   测试整体结论

性能特性共计执行12个用例，主要覆盖了传统主备的TPC-C测试及RTO测试、资源池化的sysbench性能测试及RTO测试、迁移工具的sysbench性能测试，遗留0个问题，整体质量良好，性能多轮测试稳定。

### 3.1.1 传统主备的TPC-C测试及RTO测试

| 测试活动                                      | 活动评价                                                     |
| --------------------------------------------- | ------------------------------------------------------------ |
| 2P(Taishan 200 2280 7260 ARM)环境下单节点1H   | 性能测试tpmC指标验收，使用benchmarksql工具，生成1000仓库的测试数据，在696并发下进行1H的单节点压力测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />基于TaiShan 200 (Model 2280 7260)测试，单节点1H，tpmC158.3w，达到标准150w。 |
| 2P(Taishan 200 2280 7260 ARM)环境下单节点8H   | 性能测试tpmC指标验收，使用benchmarksql工具，生成1000仓库的测试数据，在696并发下进行8H的单节点压力测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />基于TaiShan 200 (Model 2280 7260)测试，单节点8H，tpmC151.6w，达到标准145w。 |
| 2P(Taishan 200 2280 7260 ARM)环境下一主一备1H | 性能测试tpmC指标验收，使用benchmarksql工具，生成1000仓库的测试数据，在696并发下进行1H的一主一备压力测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />基于TaiShan 200 (Model 2280 7260)测试，单节点1H，tpmC124.4w，达到标准120w。 |
| 2P(Taishan 200 2280 7260 ARM)环境下一主一备8H | 性能测试tpmC指标验收，使用benchmarksql工具，生成1000仓库的测试数据，在696并发下进行8H的一主一备压力测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />基于TaiShan 200 (Model 2280 7260)测试，单节点8H，tpmC123.8w，达到标准110w。 |
| 4P(TaiShan 200 2480 7260 ARM)环境下单节点1H   | 性能测试tpmC指标验收，使用benchmarksql工具，生成1000仓库的测试数据，在812并发下进行1H的单节点压力测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />基于TaiShan 200 (Model 2480)，单节点1H，tpmC 233.2W，达到标准230w。 |
| RTO高可用特性测试                             | 极限场景下业务恢复时间验收,使用benchmarksql工具，生成1000仓库的测试数据，在696并发下进行模拟数据库一主两备组网环境出现故障并恢复的测试，测试过程符合指标规定的要求。多轮测试下测试结果稳定。<br />极致RTO恢复时间平均为8s，达到标准<10s。 |

### 3.1.2 资源池化的sysbench性能测试及RTO测试

| 测试活动                  | 活动评价                                                     |
| ------------------------- | ------------------------------------------------------------ |
| 资源池化sysbench特性测试  | sysbench(tps)验收，利用sysbench工具在数据库使用指定的数据模型生成数据并进行压测，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />主机读写备机空载场景下，主机使用oltp_read_write，tps3.5w。主机读写备机只读场景下，主机使用oltp_read_write，备机使用oltp_read_only，主机tps2.4w，备机tps3.8w。 |
| 资源池化RTO高可用特性测试 | 极限场景下业务恢复时间验收,使用benchmarksql工具，生成1000仓库的测试数据，模拟资源池化数据库一主一备组网环境出现故障并恢复的测试，测试过程符合指标规定的要求，多轮测试下测试结果稳定。<br />故障前25wtpmC，30并发场景下，RTO恢复时间为8s，达到标准<10s。故障前50wtpmC，100并发场景下，RTO恢复时间为29s，达到标准<30s。 |

### 3.1.3 迁移工具的sysbench性能测试

| 测试活动                                             | 活动评价                                                     |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| M*向openGauss数据库全量迁移                          | 迁移速度(MB/s)验收，利用sysbench工具在源端生成数据并使用chamelon工具向目标端进行数据迁移，保证数据一致性的前提下测试迁移速度，测试过程符合指标规定的要求，测试结果达标300MB/s。多轮测试下测试结果稳定。<br />源端存在10张表，单表数据量3000万，线程数20场景下，M*向openGauss全量迁移速度为325MB/s。 |
| M*向openGauss数据库增量迁移                          | 迁移性能tps指标验收，利用sysbench工具在源端生成数据并使用chamelon工具同步源端/目标端数据，使用debezium工具开启在线迁移，利用sysbench工具在源端进行数据压力测试，测试结果达标3w tps。多轮测试下测试结果稳定。<br />源端存在10张表，单表数据量10万，线程数50，混合IUD场景下，M向openGauss增量迁移速度为 30763 tps。 |
| openGauss向M*数据库反向迁移                          | 迁移性能tps指标验收，利用sysbench工具分别在源端/目标端生成相同数据，使用debezium工具开启反向迁移，再次利用sysbench工具在源端进行数据压力测试，测试结果达标1w tps。多轮测试下测试结果稳定。<br />源端存在50张表，单表数据量10万，线程数50，混合IUD场景下，openGauss向M*反向迁移速度为 20837 tps。 |
| M*向openGauss数据库全量数据迁移，datachecker进行校验 | 迁移过程数据校验速度(MB/s)验收，更改sysbench的lua脚本，使用自定义表结构对M*数据库预置50张表每张表1000w条数据，通过chameleon全量迁移工具将数据迁移至openGauss，利用gs_datachecker工具对迁移数据的一致性进行测试，多轮测试下测试结果稳定，校验结果准确。<br />50张表，单表数据量1000万场景下，总size/time为518MB/s，达到标准150M/s，总条数/time为26w条/s，达到标准25w条/s。<br /> |

## 3.2   约束说明

（1）本报告中的各场景测试结果中的处理时间，指的是openGauss的处理时间，不包含其他第三方业务的处理时间；

（2）本次性能测试是在实验室网络环境下，搭建测试环境并进行的性能测试，网络条件较稳定，不考虑现网与实验室的网络条件差异；

（3）本报告中，使用benchmarkSQL工具、sysbench工具模拟压力场景，代表的仅是已知业务模型，没有特殊业务场景，不能代表在现网复杂场景下的实际处理能力；

（4）本次测试是在固定的网络、物料、软件版本等配套的前提下进行的，如果实际环境与本次测试存在不同，请自行评估性能差异，本次测试环境具体情况，请参考第二章节。

## 3.3   问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
|          |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 1    | 0    | 3    | 0      |
| 百分比 | 100%     | 25%  | 0%   | 75%  | 0%     |

### 3.3.3 问题单汇总

| 序号 | issue号 | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------- | -------- | ------------------------------------------------------------ | -------- |
| 1    | I7Z283  | 次要     | 【测试类型：性能】【测试版本：5.1.0】 增量迁移，迁移性能达不到3wtps | 已验收   |
| 2    | I7Z4PF  | 次要     | 【测试类型：性能】【测试版本：5.1.0】 全量迁移，迁移性能达不到300Mb/s | 已验收   |
| 3    | I7Z4DG  | 次要     | 【测试类型：性能】【测试版本：5.1.0】 2p主备场景性能不达标   | 已验收   |
| 4    | I7VMEK  | 严重     | 【测试类型：性能】【测试版本：5.1.0】8.24TPCC性能不达标      | 已验收   |

# 4     测试执行

## 4.1   测试结果

### 4.1.1 7260 2P ARM环境下单节点1H

| 测试步骤                                                     | 测试结果                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 1、部署数据库；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极限场景参数；<br/>4、以696并发数启动benchmarksql工具对数据库进行1H压力测试；<br/>5、观察输出结果、性能波动情况、资源占用情况。 | 单节点在极限场景配置下tpmC为150W+：tpmC = 1583598.08 |

### 4.1.2 7260 2P ARM环境下单节点8H

| 测试步骤                                                     | 测试结果                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 1、部署数据库；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极限场景参数；<br/>4、以696并发数启动benchmarksql工具对数据库进行8H压力测试；<br/>5、观察输出结果、性能波动情况、资源占用情况。 | 单节点在极限场景配置下tpmC为145W+：tpmC = 1516723.39 |

### 4.1.3 7260 2P ARM环境下一主一备1H

| 测试步骤                                                     | 测试结果                                               |
| ------------------------------------------------------------ | ------------------------------------------------------ |
| 1、部署数据库；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极限场景参数；<br/>4、以696并发数启动benchmarksql工具对数据库进行1H压力测试；<br/>5、观察输出结果、性能波动情况、资源占用情况。 | 一主一备在极限场景配置下tpmC为120W+：tpmC = 1243923.06 |

### 4.1.4 7260 2P ARM环境下一主一备8H

| 测试步骤                                                     | 测试结果                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 1、部署数据库；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极限场景参数；<br/>4、以696并发数启动benchmarksql工具对数据库进行8H压力测试；<br/>5、观察输出结果、性能波动情况、资源占用情况。 | 单节点在极限场景配置下tpmC为110W+：tpmC = 1238468.86 |

### 4.1.5 7260 4P ARM环境下单节点1H

| 测试步骤                                                     | 测试结果                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 1、部署数据库；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极限场景参数；<br/>4、以812并发数启动benchmarksql工具对数据库进行1H压力测试；<br/>5、观察输出结果、性能波动情况、资源占用情况。 | 单节点在极限场景配置下tpmC为230W+：tpmC = 2331736.43 |

### 4.1.6 RTO高可用特性测试

| 测试步骤                                                     | 测试结果              |
| ------------------------------------------------------------ | --------------------- |
| 1、部署一主两备（同步）数据库，启动集群；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置极致RTO开关参数，recovery_parse_workers=4,recovery_redo_workers=4,hot_standby=off；<br/>4、以1000并发数启动benchmarksql工具对数据库进行压力测试；<br/>5、在tpmC性能达到80W左右时，kill主节点，在备节点进行failover操作，将备节点升为主节点；<br/>6、重复执行第二步到第五步，进行3次测试，统计failover切换过程输出的时间差，取平均值 | 极致RTO恢复时间为：8s |

### 4.1.7 资源池化sysbench性能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、部署一主一备数据库，启动集群；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、在压测机上使用sysbench向主机数据库中预置数据；<br/>4、在压测机上使用sysbench向主机数据库中以oltp_read_write模式压测数据<br/>5、读取sysbench执行结果，计算tps<br/>6、在压测机上使用sysbench同时向主机以oltp_read_write模式，备机以oltp_read_only模式压测数据<br/>7、读取sysbench执行结果，计算tps | 主机读写备机空载场景下，主机使用oltp_read_write，35056tps。<br/>主机读写备机只读场景下，主机使用oltp_read_write，备机使用oltp_read_only，主机23979tps，备机38662tps。 |

### 4.1.8 资源池化RTO高可用特性测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、部署一主一备数据库，启动集群；<br/>2、连接benchmarksql工具生成1000仓测试数据；<br/>3、配置按需回放和极致RTO参数，ss_enable_ondemand_recovery = on，ss_ondemand_recovery_mem_size = 25GB，recovery_parse_workers = 4，recovery_redo_workers = 4，hot_standby = off；<br/>4、以30并发数启动benchmarksql工具对数据库进行压力测试；<br/>5、在tpmC性能达到25W左右时，kill主节点，在备节点进行failover操作，将备节点升为主节点；<br/>6、重复执行第二步到第五步，进行3次测试，统计failover切换过程输出的时间差，取平均值<br/>7、调整并发数为100，在tpmC性能达到50W左右时，kill主节点，统计failover切换过程输出的时间差，取平均值 | 故障前25wtpmC，30并发场景下，RTO恢复时间为8s，达到标准<10s。故障前50wtpmC，100并发场景下，RTO恢复时间为29s，达到标准<30s。 |

### 4.1.9 M*向openGauss数据库全量迁移

| 测试步骤                                                     | 测试结果                                                   |
| ------------------------------------------------------------ | ---------------------------------------------------------- |
| 1、利用sysbench工具在源端生成10张表，单表数据量3000万；<br/>2、下载并配置chamelon；<br/>3、使用chamelon工具进行全量数据迁移，计算迁移过程时长 ；<br/>4、查看目标端迁移以后表的数据量；<br/>5、计算迁移速度：迁移速度=总数据量/迁移耗时<br />6、重复执行第一步到第五步，进行3次测试，计算迁移速度的平均值 | chamelon读写线程数20，M*向openGauss全量迁移速度为325MB/s。 |

### 4.1.10 M*向openGauss数据库增量迁移

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、利用sysbench工具在源端生成数据；<br/>2、下载并配置chamelon；<br/>3、使用chamelon工具进行离线迁移；<br/>4、使用debezium工具开启在线迁移；<br />5、sysbench继续在源端压测数据（混合IUD模型）；<br />6、查看目标端迁移以后表的数据量，记录迁移时长；<br/>7、计算迁移速度：迁移速度=总迁移事务/迁移耗时<br />8、重复执行第三步到第七步，进行3次测试，计算迁移速度的平均值 | 源端10张表，单表数据量10万，线程数50场景下，增量迁移速度为30763 tps。 |

### 4.1.11 openGauss向M*数据库反向迁移

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、利用sysbench工具在源端生成数据；<br/>2、下载并配置chamelon；<br/>3、使用debezium工具开启反向迁移；<br />5、sysbench在源端压测数据（insert、混合IUD模型）<br />6、查看目标端迁移以后表的数据量，记录迁移时长；<br/>7、计算迁移速度：迁移速度=总迁移事务/迁移耗时<br />8、重复执行第三步到第七步，进行3次测试，计算迁移速度的平均值 | 源端50张表，单表数据量10万，线程数50，混合IUD场景下，openGauss向M*反向迁移速度为20837 tps。 |

### 4.1.12 M*向openGauss数据库全量数据迁移，datachecker进行校验

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、利用sysbench工具在源端生成一定数据；<br/>2、下载并配置chamelon、debezium；<br/>3、查看目标端迁移以后表的数据量；<br/>4、启动M*/openGauss抽取服务及数据校验服务，获取校验时长<br />5、计算校验速度：校验速度=迁移数据量/校验耗时<br />6、检查校验结果文件的准确性<br />7、重复执行第一步到第六步，进行3次测试，计算校验速度的平均值 | 50张表，单表数据量1000万场景下，总size/time为518MB/s，总条数/time为26w条/s。 |

## 4.2   测试执行统计数据

| 版本名称             | 测试用例数 | 用例执行结果            | 发现问题单数 |
| -------------------- | ---------- | ----------------------- | ------------ |
| openGauss 5.1.0 RC16 | 12         | Passed:11<br />Failed:1 | 1            |
| openGauss 5.1.0 RC18 | 12         | Passed:9<br />Failed:3  | 3            |
| openGauss 5.1.0 RC19 | 12         | Passed:12<br />Failed:0 | 0            |

## 4.3   后续测试建议

无

# 5     附件

*无*

 



 

 
