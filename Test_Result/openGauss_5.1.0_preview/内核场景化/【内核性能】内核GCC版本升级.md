![avatar]( ../../../images/openGauss.png )

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期     | 修订   版本 | 修改描述     | 作者       |
| -------- | ----------- | ------------ | ---------- |
| 2023-7-7 | 1.0         | 特性测试初稿 | lichunlong |

 关键词：gcc ，autfdo

 

摘要：本文对实现编译工具gcc升级到10.3，并针对在openEuler上TPCC性能提升的测试。

 

缩略语清单：

| 缩略语 | 英文全名                                                     | 中文解释                |
| ------ | ------------------------------------------------------------ | ----------------------- |
| gcc    | [GNU](https://baike.baidu.com/item/GNU/671972?fromModule=lemma_inlink) Compiler Collection | GNU开发的编程语言编译器 |

# 1     特性概述

 CentOS+X86升级GCC版本到GCC10.3，openEuler+ARM/X86升级GCC版本到GCC for openEuler 2.3.3(对应GCC 10.3)，采用反馈优化，提高I-Cache命中率，openEuler上TPCC性能预计提升6% 。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.0 build a74b7333 | 2023-6-19    | 2023-6-25    |
| openGauss 5.1.0 build ad27d72a | 2023-6-30    | 2023-6-30    |
| openGauss 5.1.0 build 2819e518 | 2023-7-7     | 2023-7-7     |

描述特性测试的硬件环境信息

| 环境信息       | 配置信息                                                     | 备注 |
| -------------- | ------------------------------------------------------------ | ---- |
| ARM+openEuler  | CPU：Kunpeng 920 7260 2p 128核<br />内存：24*32GB<br />硬盘：NVME 3T * 4<br />OS：openEuler release 20.03 (LTS)<br />文件系统：XFS<br />网卡：10GE |      |
| x86+CentOS     | CPU：Intel(R) Xeon(R) CPU E5-2680 v4 56核<br />内存：24*32GB<br />OS：CentOS Linux release 7.9.2009 (Core)<br />文件系统：XFS<br />网卡：10GE |      |
| x86+ openEuler | CPU：Intel(R) Xeon(R) Gold 6266C CPU @ 2.60GHz<br/>内存：16GB<br/>硬盘：64GB<br/>OS：openEuler release 20.03(LTS-SP1)_x86_64 |      |

# 3     测试结论概述

## 3.1   测试整体结论

gcc版本升级测试过程中执行用例34个，主要涉及功能，性能及资料验证，共发现问题3个，现已回归通过；并且执行全量CI自动化用例、可靠性自动化以及长稳测试，无发现其他问题，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 使用新gcc编译及新包，及使用执行全量CI自动化用例、可靠性自动化以及长稳测试，测试通过。 |
| 性能测试 | 在openEuler环境上使用autfdo工具，对1000warehouse进行压力测试，对比gcc7.3编译包数据，测试结果通过。 |
| 资料测试 | 关于使用新gcc的部分的资料验证，测试通过。                    |
| 长稳测试 | 使用gcc编译的包进行长稳测试，测试通过。                      |

## 3.2   约束说明

无

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 3        | 0    | 2    | 0    | 1      |
| 百分比 | 100      | 0    | 67   | 0    | 33     |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                      | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | --------------------------------------------- | -------- |
| 1    | [I7F1RX](https://gitee.com/opengauss/openGauss-OM/issues/I7F1RX) | 主要     | gcc升级为10.3版本，OM包编译失败               | 已验收   |
| 2    | [I7F4R6](https://gitee.com/opengauss/openGauss-server/issues/I7F4R6) | 主要     | 5.0.0升级到新版本gcc10.3编译的5.1.0版本包失败 | 已验收   |
| 3    | [I7F4DJ](https://gitee.com/opengauss/CM/issues/I7F4DJ?from=project-issue) | 不重要   | gcc版本升级到10.3，CM的README.md文档没        | 已验收   |



# 4     测试执行

## 4.1   功能测试

| 测试步骤                                                     | 测试结果                                          |
| ------------------------------------------------------------ | ------------------------------------------------- |
| 1.针对使用gcc编译、安装及升级进行测试，并执行自动化全量用例。 | 共执行用例32条<br />发现2个问题，现已全部测试通过 |

### 4.2 性能测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1.openEuler arm环境上，在使用autofdo工具对1000warehouse数据执行tpcc性能测试，并与gcc7.3编译的数据库1000warehouse数据性能进行对比，经对比性能提升6.4%。 | 共执行用例1条<br />未发现问题 |

tpcc测试数据如下：

| gcc版本 | tpmc（单位：万） |
| ------- | ---------------- |
| gcc10.3 | 169.4            |
| gcc10.3 | 168.4            |
| gcc10.3 | 166.2            |
| gcc7.3  | 159.5            |
| gcc7.3  | 156.2            |
| gcc7.3  | 157.6            |



### 4.3 长稳测试

| 测试步骤                              | 测试结果                      |
| ------------------------------------- | ----------------------------- |
| 1.使用新gcc编译的包执行7*24长稳测试。 | 共执行1条用例<br />未发现问题 |

4.4 资料测试

| 测试步骤                          |                             |
| --------------------------------- | --------------------------- |
| 1.关于使用新gcc的部分的资料验证。 | 发现1个问题，现已回归通过。 |

测试执行用例34个，缺陷为 2个，资料单1个，代码量为0.1kloc，缺陷密度 20个/kloc。

## 4.2   后续测试建议

后续测试需要关注点(可选)

# 5     附件

autofdo工具使用说明：https://gitee.com/opengauss/blog/blob/32d1a9f9b74ea95093860373f3abb34bd5efab95/content/zh/post/luozihao/A-FOT%E5%B7%A5%E5%85%B7%E8%87%AA%E5%8A%A8%E5%8F%8D%E9%A6%88%E4%BC%98%E5%8C%96.md

 



 

 
