![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期         | 修订   版本 | 修改描述 | 作者        |
|------------|---------| -------- |-----------|
| 2023-09-19 | 1.0     | 初稿完成 | xiayanhua |
| 2023-09-26 | 1.1     | bug验收  | xiayanhua |

关键词： 匿名块调试，存储过程嵌套调试

 

摘要：本文档主要验证匿名块调试以及存储过程嵌套调试特性表现是否正常，并给出测试结论。

 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

本需求主要涉及两部分改造：

（1）匿名块调试

原有内核仅支持存储过程调试，不支持匿名块调试，本特性新增匿名块调试模块

(2）存储过程嵌套调试
原有内核仅支持存储过程单层调试，不支持嵌套调试，本次新增在存储过程中，可调用多层函数进行嵌套调试

# 2     特性测试信息
测试软件环境

| 版本名称                                          | 测试起始时间   | 测试结束时间    |
|-----------------------------------------------|----------|-----------|
| openGauss 5.1.0 build 5762b67e                | 2023-8-29 | 2023-9-6  |
| openGauss 5.1.0 build 321133e2+datakit 5.0.0  | 2023-9-7 | 2023-9-15 |
| openGauss 5.1.0 build 4e532edf                | 2023-9-22 | 2023-9-25 |
| openGauss 5.1.0 build 4e532edf+ datakit 5.1.0 | 2023-9-26 | 2023-9-27 |

测试环境信息

| 环境信息                                          | 配置信息                                                                                                              | 备注        |
|-----------------------------------------------|----------|-----------|
| 虚拟机                                           | Intel(R) Xeon(R) Platinum 8378A CPU @ 3.00GHz<br />内存：32GB<br />硬盘：124GB<br />OS：CentoOS Linux release 7.9.2009 (Core) | 单机部署      |

# 3     测试结论概述

## 3.1   测试整体结论

共计执行93个用例，主要覆盖了命令行的匿名块调试和嵌套调试，以及web_ds端的匿名块调试和嵌套调试功能，发现issue12个，其中2个问题为非问题，已取消，文档问题汇总在一个问题单，提示信息语法错误汇总在一个问题单，其中有两个问题待修复，经开发解释这两个问题需要到国创那边修改，且这两个问题是之前原函数/过程调试就存在的缺陷，不是本需求新引入的问题，其余问题已验收通过，整体质量良好；

| 测试活动   | 活动评价                                                      |
| ---------- |-----------------------------------------------------------|
| 功能测试   | 命令行的匿名块调试和存储过程嵌套调试，发现问题5个，2个为非问题，一个为提示信息问题汇总<br />测试结论：通过 |
| 功能测试   | web_ds端的匿名块调试和存储过程嵌套调试,发现问题6个<br />测试结论：通过                |
| 资料测试   | 业务开发用户手册 5.8.3 调试函数/过程/匿名块部分文档review，文档建议汇总为一个问题单         |

## 3.2   约束说明

暂无

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
|I84KTS | 点击函数步入或者单步调试直至函数结束，橙点不消失 | 不重要 | 快速点击会不消失，慢点击是正常的 | 待国创修复 |
|I84KR0 | 进入子函数之后，点击函数退出，除“停止调试按钮”外，其他按钮无法点击，且橙点指向的行数和实际执行的行数不一致 | 主要 |  暂无| 待国创修复 |
备注:该问题开发解释说是国创那边需要修改，和本次匿名块调试和嵌套调试需求无直接关系，待后续修复由他们的测试验证

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要  | 次要    | 不重要 |
| ------ |------| ---- |-----|-------|-----|
| 数目   | 12   | 0    | 0   | 7     | 4   |
| 百分比 | 100% | 0%   | 0%  | 66.7% | 33% |

### 问题单汇总

| 序号  | issue号                                                      | 问题级别 | 问题简述                           | 问题状态 |
|-----| ------------------------------------------------------------ |------| ---------------------------------- |------|
| 1   | [I7YEA8](https://gitee.com/opengauss/openGauss-server/issues/I7YEA8) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [嵌套调试]嵌套函数中存在断点时，执行continue()，首先会进入嵌套函数可执行的第一行，而非直接到达断点处 | 已验收  |
| 2   | [I7XHIQ](https://gitee.com/opengauss/openGauss-server/issues/I7XHIQ) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [匿名块调试]执行dbe_pldebugger.finish() hang住不结束 | 已验收  |
| 3   | [I7ZGBA](https://gitee.com/opengauss/openGauss-workbench/issues/I7ZGBA) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit匿名块调试]打开多个断点，选中所有断点，点击禁用，后台提示WebSocketServer : method error | 已验收  |
| 4   | [I7ZGEF](https://gitee.com/opengauss/openGauss-workbench/issues/I7ZGEF) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit匿名块调试]点击单步执行至程序结束，弹窗提示socket is closed报错 | 已验收  |
| 5   | [I7ZH2A](https://gitee.com/opengauss/openGauss-workbench/issues/I7ZH2A) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit匿名块调试]第一次调试时打开断点执行完成，第二次调试时，界面上依然显示断点，但实际并无断点信息，因此单击断点处提示错误 | 已验收  |
| 6   | [I810EF](https://gitee.com/opengauss/openGauss-workbench/issues/I810EF) | 不重要  | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit匿名块调试]匿名块调试时，点击开始调试，实际指向的行数不是可执行的第一行，而是第二行 | 已验收  |
| 7   | [I8134R](https://gitee.com/opengauss/openGauss-workbench/issues/I8134R) | 不重要  | 【测试类型：工具功能】【测试版本：5.1.0】 [匿名块调试]提示信息语法错误| 已验收  |
| 8   | [I82M3P](https://gitee.com/opengauss/openGauss-workbench/issues/I82M3P) | 不重要  | 【测试类型：工具功能】【测试版本：5.1.0】 [文档review] 匿名块调试和嵌套调试相关文档| 已验收  |
| 9   | [I7YOS2](https://gitee.com/opengauss/openGauss-workbench/issues/I7YOS2) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [嵌套调试]嵌套函数中调用系统函数时，step会直接finish()| 已取消  |
| 10  | [I7YEJ3](https://gitee.com/opengauss/openGauss-workbench/issues/I7YEJ3) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [嵌套调试]嵌套函数中存在断点时，删除断点再添加断点，执行continue，会略过断点，直接结束| 已取消  |
| 11  | [I84KTS](https://gitee.com/opengauss/openGauss-workbench/issues/I84KTS) | 不重要  | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit 调试] 点击函数步入或者单步调试直至函数结束，橙点不消失| 待修复  |
| 12  | [I84KR0](https://gitee.com/opengauss/openGauss-workbench/issues/I84KR0) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】  [datakit 嵌套调试] 进入子函数之后，点击函数退出，除“停止调试"按钮”外，其他按钮无法点击，且橙点指向的行数和实际执行的行数不一致| 待修复  |

其中如下5个问题为原函数/过程调试就存在的缺陷，不是本需求新引入的问题
| 序号  | issue号                                                      | 问题级别 | 问题简述                           | 问题状态 |
|-----| ------------------------------------------------------------ |------| ---------------------------------- |------|
| 1   | [I7YEA8](https://gitee.com/opengauss/openGauss-server/issues/I7YEA8) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [嵌套调试]嵌套函数中存在断点时，执行continue()，首先会进入嵌套函数可执行的第一行，而非直接到达断点处 | 已验收  |
| 2   | [I7XHIQ](https://gitee.com/opengauss/openGauss-server/issues/I7XHIQ) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [匿名块调试]执行dbe_pldebugger.finish() hang住不结束 | 已验收  |
| 3   | [I7ZGEF](https://gitee.com/opengauss/openGauss-workbench/issues/I7ZGEF) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit匿名块调试]点击单步执行至程序结束，弹窗提示socket is closed报错 | 已验收  |
| 4   | [I84KTS](https://gitee.com/opengauss/openGauss-workbench/issues/I84KTS) | 不重要  | 【测试类型：工具功能】【测试版本：5.1.0】 [datakit 调试] 点击函数步入或者单步调试直至函数结束，橙点不消失| 待修复  |
| 5   | [I84KR0](https://gitee.com/opengauss/openGauss-workbench/issues/I84KR0) | 次要   | 【测试类型：工具功能】【测试版本：5.1.0】  [datakit 嵌套调试] 进入子函数之后，点击函数退出，除“停止调试按钮”外，其他按钮无法点击，且橙点指向的行数和实际执行的行数不一致| 待修复  |


# 4     测试执行

## 4.1   测试执行统计数据

| 版本名称                                          | 测试用例数 | 用例执行结果              | 发现问题单数 |
|-----------------------------------------------|-------|---------------------|--------|
| openGauss 5.1.0 build 5762b67e                | 51    | Passed：46  Failed：5 | 5      |
| openGauss 5.1.0 build 321133e2+datakit 5.0.0  | 42    | Passed：38  Failed：4 | 4      |
| openGauss 5.1.0 build  4e532edf               | 25    | Passed：25  Failed：0 | 0      |
| openGauss 5.1.0 build  4e532edf+datakit 5.1.0 | 30    | Passed：28  Failed：2 | 2      |

*数据项说明：*

- 首轮测试用例执行93个，不通过9个，缺陷问题单见汇总，另文档review的建议汇总在一个问题单，以及提示信息语法错误汇总在一个问题单；
- 最后一轮回归问题单执行55个用例，通过53个，失败2个；
- 1个资料单和2个非问题单不计入代码缺陷密度计算，代码缺陷密度为9(缺陷个数)/0.8k(代码行数)=11.25(个/kloc)

## 4.2   后续测试建议

测试用例编写时，有如下几点建议：
    1.用例编写时可以参考已有功能的测试结果：比如本次测试用例编制时，可以参考已有的存储过程调试功能的实际运行结果，进行对比，以帮助写出符合预期的用例
    2.匿名块和存储过程举例时，尽量在不同的行数使用不同的代码，避免所有行均使用i+1，调试时方便确认对应行数的信息。执行过程中，大部分用例已经做了简要修改
    3.diable breakpoints 传入参数为序号，而非行号，用例中进行相应修改
    4.有的用例执行完continue之后，已经结束，无需再abort()，用例中已进行修改

# 5     附件

无



 

 
