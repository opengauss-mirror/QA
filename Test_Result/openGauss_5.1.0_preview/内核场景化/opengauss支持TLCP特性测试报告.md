![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订版本 | 修改描述               | 作者  |
| ---------- | -------- | ---------------------- | ----- |
| 2023/09/20 | 1.0      | 特性报告初稿完成       | wangxiumin |


关键词：ssl、tlcp、tassl

摘要：本文档主要介绍测试openGauss对TLCP协议的支持，主要包含使用由国密算法生成的证书进行安全认证和安全通信，及其建立连接时握手成功或失败的场景，并给出最终测试结论。


缩略语清单：

| 缩略语    | 英文全名  | 中文解释          |
| --------- | --------- | ----------------- |
|ssl | Secure Socket Layer |安全套接层|
|tlcp | Transport layer cryptography protocol | 传输层密码协议(国密ssl) |

# 1     特性概述
该特性目的是使openGauss支持TLCP协议(国密ssl),使openGauss的客户端和服务器之间能够使用国密算法进行安全认证和安全通信。该特性使用时,需要在客户端和服务器同时开启tlcp开关并配置正确的加密套件值，相关证书和私钥需要为国密算法生成。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |   
| ------------------------------ | ------------ | ------------ |
| openGauss 5.1.0 build 9daa6dba | 2023-09-20   | 2023-09-20   |


| 环境信息 | 配置信息                                                     | 备注          |
| -------- | ------------------------------------------------------------ | ------------- |
| 虚拟机   | Intel Xeon Processor (Icelake) 8核<br>内存：32GB<br/>硬盘：300GB<br/>OS：CentOS Linux release 7.9.2009 (Core) | 安装openGauss |

# 3     测试结论概述

## 3.1   测试整体结论

共设计12个测试用例，主要包含使用由国密算法生成的证书进行安全认证和安全通信，及其建立连接时握手成功或失败的场景。共计发现0个问题，整体质量良好。


| 测试活动 | 活动评价                                           |
| -------- | -------------------------------------------------- |
| 功能测试 | 测试tlcp开关ssl_use_tlcp与加密套件ssl_ciphers的匹配情况     |
| 功能测试 | 在以上匹配的情况下，测试证书生成&签名算法、密码套件&tlcp开关、客户端配置PGSSLTLCP不同值下的握手情况     |


## 3.2   约束说明

- 本特性依赖tassl库，需在三方库中添加tassl以支持编译，且需要开启--with-tassl编译选项

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1  | 0    | 0  | 1 | 0    |
| 百分比 |   100%       | 0%   | 0%  | 100% | 0% |

### 3.3.3 问题单汇总

|序号| issue号                                                      | 级别 | 问题简述                                     | 状态   |
| ---- | ------------------------------------------------------------ | ---- | -------------------------------------------- | ------ |
| 1    | [I82OZX](https://gitee.com/opengauss/openGauss-third_party/issues/I82OZX) | 次要   | openguass-server 库中新增tassl支持，需要在三方库中增加tassl库来支持编译 | 已PR |



# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 测试tlcp开关ssl_use_tlcp与加密套件ssl_ciphers的匹配情况

数据库启动前，在ssl=on的情况下,分别配置ssl_use_tlcp与ssl_ciphers为如下组合，并启动数据库：
| 参数组合                                                     | 测试结果                                        |
| ------------------------------------------------------------ | ----------------------------------------------- |
| ssl_use_tlcp = on&ssl_ciphers=DHE-RSA-AES256-GCM-SHA384 | 无法启动数据库并报错参数不匹配 |
| ssl_use_tlcp =off&ssl_ciphers=DHE-RSA-AES256-GCM-SHA384 | 可正常启动数据库 |
| ssl_use_tlcp =on&ssl_ciphers=ECDHE-SM4-SM3 | 可正常启动数据库 |
| ssl_use_tlcp =off&ssl_ciphers=ECDHE-SM4-SM3 | 无法启动数据库并报错 |




### 4.1.2 在以上匹配的情况下，测试证书生成&签名算法、密码套件&tlcp开关、客户端配置PGSSLTLCP不同值下的握手情况


   | 证书生成算法 | ssl_ciphers               | ssl_use_tlcp | **PGSSLTLCP** | 结果                                                         |
   | ------------ | ------------------------- | ------------ | ------------- | ------------------------------------------------------------ |
   | rsa          | DHE-RSA-AES256-GCM-SHA384 | off          | 1             | 握手失败 |
   | rsa          | DHE-RSA-AES256-GCM-SHA384 | off          | 0             | 成功建立连接|
   | rsa          | ECDHE-SM4-SM3             | on           | 1             |握手失败 ||
   | rsa          | ECDHE-SM4-SM3             | on           | 0             | 握手失败 ||
   | sm2          | DHE-RSA-AES256-GCM-SHA384 | off          | 1             | 握手失败 | |
   | sm2          | DHE-RSA-AES256-GCM-SHA384 | off          | 0             | 握手失败 | |
   | sm2          | ECDHE-SM4-SM3             | on           | 1             | 成功建立连接|
   | sm2          | ECDHE-SM4-SM3             | on           | 0             | 握手失败 ||




## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果             | 发现问题单数 |
| ------------------------------ | ---------- | ------------------------ | ------------ |
|openGauss 5.1.0 build 9daa6dba | 12  | Passed：12<br>Failed：0<br />Unavaliable：0 | 0        |


*数据项说明：*

* 测试用例数 :12
* 发现问题单数 :0
## 4.3   后续测试建议

无

# **5     附件**

无

****

