

![avatar](../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述         | 作者     |
| ---------- | ----------- | ---------------- | -------- |
| 2023-02-18 | 1.0         | 特性测试报告初稿 | lihongji |

关键词： kafka、datachecker-check-0.0.1.jar、datachecker-extract-0.0.1.jar、M*、openGauss、行列级

摘要：数据校验工具由zookeeper、kafka、datachecker-check-0.0.1.jar、datachecker-extract-0.0.1.jar这几部分组成，本次测试针对该工具支持M*与openGauss行列级筛选，本文档主要介绍datachecker校验工具行列级筛选的测试结果。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

datachecker校验工具通过配置行列级筛选规则，可以校验特定的表、行范围与表字段

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 5.0.0 build 9d042874 | 2023-02-03   | 2023-02-18   |
| chameleon 3.1.1                | 2023-02-03   | 2023-02-18   |
| M* 5.7                         | 2023-02-03   | 2023-02-18   |
| kafka 2.13-2.8.11              | 2023-02-03   | 2023-02-18   |
| jdk 11.0.16                    | 2023-02-03   | 2023-02-18   |
| datachecker  master            | 2023-02-03   | 2023-02-18   |

描述特性测试的硬件环境信息

| 硬件型号 | 硬件配置信息                                                 | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | CPU:  Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz<br>内存：31GB<br>硬盘：724G<br>OS：CentOS Linux release 7.6.1908 (Core)<br> |      |

# 3     测试结论概述

## 3.1   测试整体结论

​        datachecker工具支持行级、列级和全量比较规则，共计执行35条用例，主要覆盖了功能测试、可靠性测试、资料测试。功能测试分别验证了表、行与列级规则测试，能够通过配置校验指定的数据；可靠性测试注入了网络延时、磁盘80%、cpu80%故障，不影响行列级筛选功能。资料测试中描述恰当，示例正确无误。共计发现4个问题，其中1个资料单，其余3个问题均转为资料单，无遗留风险，行级、列级和全量比较规则需求整体质量良好。

| 测试活动   | 活动评价                                                     |
| ---------- | ------------------------------------------------------------ |
| 功能测试   | 表、行与列级规则测试，能够通过配置校验指定的表、行、列。通过 |
| 可靠性测试 | 注入故障，表、行、列级筛选生效，通过                         |
| 资料测试   | 使用方法描述准确，示例正确无误，通过                         |
## 3.2   约束说明

1. 表、行级约束不支持增量校验
2. M*使用5.7版本，openGauss为兼容B库；

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | :------: | :--: | :--: | :--: | :----: |
| 数目   |    4     |  0   |  1   |  3   |   0    |
| 百分比 |   100%   |  0%  | 25%  | 75%  |   0%   |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                                     | 状态   |
| ---- | ------------------------------------------------------------ | ---- | ------------------------------------------------------------ | ------ |
| 1    | [I6C9ZB](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I6C9ZB?from=project-issue) | 主要 | 行级规则，当MySQL端数据与openGauss端数据逻辑错位时，实际存在的数据因逻辑位置关系导致校验不通过。会产生校验结果失败，提示数据丢失，但根据修复语句修复，数据实际存在的问题 | 待办的 |
| 2    | [I6EFUU](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I6EFUU?from=project-issue) | 次要 | 当update在MySQL修改的数据为主键时，会分别提示两条修复语句insert、delete。应提示一条update语句更简洁 | 已完成 |
| 3    | [I6E7W4](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I6E7W4?from=project-issue) | 次要 | 1.资料需要对结果文件内容的参数含义做说明以及结果文件名称组成做说明。2.资料的排版加序号 3.所有约束放一起 4. 增量不支持表、行规则过滤需添加约束 | 已完成 |
| 4    | [I5P71L](https://gitee.com/opengauss/openGauss-tools-datachecker-performance/issues/I5P71L?from=project-issue) | 次要 | 行级规则没有排他规则，如用户需要校验20~50行以外的数据，无法通过配置文件添加 | 已完成 |



# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 功能测试

| 测试步骤：                                                   | 测试结果                                          |
| ------------------------------------------------------------ | ------------------------------------------------- |
| 1. application.yml文件增加表、行、列级筛选配置<br />2. 启动校验服务<br />3.查看校验结果文件，按照配置文件校验了特定的数据 | 共执行30条用例，<br />共发现3个bug，3个转为资料单 |

#### 4.1.1.1 表级规则

| 测试步骤：                                          | 测试结果                     |
| --------------------------------------------------- | ---------------------------- |
| 1. 通过正则匹配表名，配置黑白名单<br>2.黑白名单生效 | 共执行7条用例<br />未发现bug |

#### 4.1.1.2 行级规则

| 测试步骤：                                            | 测试结果                                |
| ----------------------------------------------------- | --------------------------------------- |
| 1.通过正则匹配表名，配置行范围<br/>2.校验指定的行范围 | 共执行8条用例<br />共发现bug2个，转资料 |

#### 4.1.1.3 列级规则

| 测试步骤：                                                   | 测试结果                                  |
| ------------------------------------------------------------ | ----------------------------------------- |
| 1.配置表名<br/>2.配置列字段<br/>3.添加筛选属性include、exclude<br/>4.校验指定的列字段 | 共执行15条用例<br />共发现bug 1个，转资料 |

### 4.1.2 可靠性测试

| 测试步骤：                                                   | 测试结果                     |
| ------------------------------------------------------------ | ---------------------------- |
| 1. 添加行列级匹配规则<br>2. 注入cpu、磁盘等故障<br>3.查看校验结果 | 共执行5条用例<br />未发现bug |

### 4.1.3 资料测试

| 测试步骤：                     | 测试结果   |
| ------------------------------ | ---------- |
| 1. 使用方法描述<br>2. 示例测试 | 发现bug1个 |

## 4.2   测试执行统计数据

|            版本名称            | 测试用例数 |     用例执行结果     | 发现问题单数 |
| :----------------------------: | :--------: | :------------------: | :----------: |
| openGauss 5.0.0 build 9d042874 |     35     | Passed：35 Failed：0 |      4       |

数据说明

1. 4个issue为资料单
2. 缺陷密度为0(缺陷个数)/2.5k(代码行数)=0(个/kloc)

## 4.3   后续测试建议

无

# 5     附件

```yml
# 行、列级规则配置
rules:
  enable: false
  table:
    - name: white
      text: ^[a-zA-Z][a-zA-Z_]+$
    - name: black
      text: ^[a-zA-Z]+$a-zA-Z_]+$
  row:
    - name: ^[a-zA-Z][a-zA-Z_]+$
      text: 10,100
    - name: ^[a-zA-Z][a-zA-Z_]+$
      text: 100,100
  column:
    - name: t_test_1
      text: id,portal_id,func_id,name,width,last_upd_time
      attribute: include
    - name: t_test_2
      text: id,portal_id,func_id,name
      attribute: exclude

```