![avatar](../images/openGauss.png)

版权所有 © 2023  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期          | 修订   版本 | 修改描述                 | 作者 |
| ------------- | ----------- | ------------------------ | ---- |
| 2024年3月27日 | 1.0         | 创建测试报告             | 宋菲 |
| 2024年3月29日 | 2.0         | 添加性能对比测试结果     | 宋菲 |
| 2024年4月1日  | 3.0         | 添加版本升级影响测试结果 | 宋菲 |

关键词： 

​        无。

摘要：

​        特性“双引号中大小写不敏感”测试报告。

缩略语清单：

| 缩略语  | 英文全名      | 中文解释 |
| ------- | ------------- | -------- |
| dquotes | double quotes | 双引号   |

# 1     特性概述

​        添加会话级开关enable_ignore_case_in_dquotes，打开开关后支持标识符包含双引号的情况下也忽略大小写，包括表名，列名，序列名，视图名、物化视图名、函数名、存储过程名、类型名、用户名、角色名、数据库名等。

​        在使用某些驱动或者orm框架，会默认给所有标识符都加上双引号，导致如果与已有表名或列名大小写不一致时，会抛出错误，在这样的特殊情况下会需要加双引号时忽略大小写的功能。

# 2     特性测试信息

| 版本名称                           | 测试轮次 | 测试起始时间  | 测试结束时间  |
| ---------------------------------- | -------- | ------------- | ------------- |
| openGauss 6.0.0 build 5e29c538     | 第一轮   | 2024年2月19日 | 2024年3月26日 |
| openGauss 6.0.0-RC1 build 52f38ddd | 第二轮   | 2024年3月27日 | 2024年3月29日 |

功能测试的硬件环境信息：

| 环境信息 | 配置信息                        | 备注 |
| -------- | ------------------------------- | ---- |
| CPU      | 8核                             | 无   |
| 操作系统 | Kylin Linux Advanced Server V10 | 无   |
| 内存     | 16G                             | 无   |
| 磁盘     | 128G                            | 无   |

性能测试的硬件环境信息：

| 环境信息 | 配置信息                        | 备注 |
| -------- | ------------------------------- | ---- |
| CPU      | 128核                           | 无   |
| 操作系统 | Kylin Linux Advanced Server V10 | 无   |
| 内存     | 512GB                           | 无   |
| 磁盘     | 1T                              | 无   |

性能测试的软件环境信息：

| 环境信息 | 配置信息 | 备注 |
| -------- | -------- | ---- |
| bmsql    | 5.0      | 无   |



# 3     测试结论概述

## 3.1   测试整体结论

​        “双引号中大小写不敏感”特性，共执行118个用例，主要覆盖功能测试，发现3个主要缺陷，1个次要缺陷。发现问题已解决，回归通过，无遗留风险，整体质量良好。

​        该特性新增数据库参数enable_ignore_case_in_dquotes，已验证对性能几乎无影响。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 共执行118个用例，发现3个主要缺陷，1个次要缺陷。所有缺陷已验收通过，无遗留，整体质量良好 |
| 性能测试 | 新增参数enable_ignore_case_in_dquotes，对性能几乎无影响      |

## 3.2   约束说明

​        PL中对标识符的引用不受开关影响，包括游标名、变量名、数组名、类型名、集合名。

## 3.3   遗留问题分析

​        无遗留问题。

### 3.3.1 遗留问题影响以及规避措施

​        无。

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 0    | 3    | 1    | 0      |
| 百分比 |          | 0%   | 75%  | 25%  | 0%     |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | -------------------------------------------- | -------- |
| 1    | [I97JBG](【测试类型：功能测试】【测试版本：6.0.0】【标识符双引号内大小写不敏感】开启双引号大小写不敏感开关后，序列表现有问题<br/>https://e.gitee.com/opengaussorg/projects/605644/bugs/table?issue=I97JBG) | 主要     | 开启双引号大小写不敏感开关后，序列表现有问题 | 已验收   |
| 2    | [I960SW](【测试类型：功能测试】【测试版本：6.0.0】【标识符双引号内大小写不敏感】 不使用AS关键字指定的列别名大小写不敏感失效<br/>https://e.gitee.com/opengaussorg/projects/605644/bugs/table?issue=I960SW) | 主要     | 不使用AS关键字指定的列别名大小写不敏感失效   | 已验收   |
| 3    | [I99XXJ](【测试类型：功能测试】【测试版本：6.0.0】【标识符双引号内大小写不敏感】merge into 语句未支持该参数<br/>https://e.gitee.com/opengaussorg/dashboard?issue=I99XXJ) | 主要     | merge into 语句未支持该参数                  | 已验收   |
| 4    | [I98DIZ](【测试类型：功能测试】【测试版本：6.0.0】【标识符双引号内大小写不敏感】 建议set参数时，增加说明，PL中该功能不生效<br/>https://e.gitee.com/opengaussorg/projects/605644/bugs/table?issue=I98DIZ) | 次要     | 建议set参数时，增加说明，PL中该功能不生效    | 已验收   |

# 4     测试执行

## 4.1   测试内容

本特性影响并测试的标识符有：

​        表名、同义词名、列名、视图名、物化视图名、角色名、用户名、触发器名、模式名、数据库名、表空间名、索引名、模型名、序列名、规则名、保存点名（savepoint）、分区表名及分区名、外表名、服务器名、类型名、外部数据包装器名、存储过程名、函数名、事务中的表名、约束名。

### 4.1.1 开启参数，创建标识符

| 测试步骤                                                     | 测试结果                                              |
| ------------------------------------------------------------ | ----------------------------------------------------- |
| 创建全小写、全大写、大小写混合、包含特殊符号、包含单引号、包含双引号、包含单双引号、创建已存在标识符的异常情况的标识符 | 执行24个用例，未发现需求相关BUG，发现非需求相关BUG1个 |

### 4.1.2 开启参数，删除标识符

| 测试步骤                                                     | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 删除全小写、全大写、大小写混合、包含特殊符号、包含单引号、包含双引号、包含单双引号、删除不存在标识符的异常情况 | 执行24个用例，未发现BUG |

### 4.1.3 开启参数，更改标识符

| 测试步骤                                                     | 测试结果                |
| ------------------------------------------------------------ | ----------------------- |
| 更改全小写、全大写、大小写混合、包含特殊符号、包含单引号、包含双引号、包含单双引号、更改不存在标识符的异常情况 | 执行25个用例，未发现BUG |

### 4.1.4 开启参数，使用标识符

| 测试步骤                                                     | 测试结果                         |
| ------------------------------------------------------------ | -------------------------------- |
| 使用全小写、全大写、大小写混合、包含特殊符号、包含单引号、包含双引号、包含单双引号、使用不存在标识符的异常情况 | 执行29个用例，发现3个需求相关BUG |

### 4.1.5 参数隔离性

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| 1.conf文件中是否有参数可设置<br />2.参数是否符合SUSET方式的设置方式<br />3.有历史数据，使用参数<br />4.数据库中设置参数时，参数类型、提示描述是否正确<br />5.不同session之间设置参数是否互相影响 | 执行7个用例，发现1个需求相关BUG |

### 4.1.6 参数开关影响

| 测试步骤                                                     | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1.开启开关前有大小写敏感数据<br />2.开启开关前无大小写敏感数据<br />3.创建不敏感数据后关闭开关<br />4.开启参数，其他session创建数据 | 执行7个用例，未发现BUG |

### 4.1.7 参数兼容性

| 测试步骤                | 测试结果                                                     |
| ----------------------- | ------------------------------------------------------------ |
| A、B、C、PG库中验证功能 | A库中执行111个用例，BUG为已知问题，未发现新BUG<br />B库中执行118个用例，BUG为已知问题，未发现新BUG<br />C库中执行111个用例，BUG为已知问题，未发现新BUG<br />D库中执行111个用例，BUG为已知问题，未发现新BUG |

### 4.1.7 资料测试

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| 1.用户手册中，是否有参数的描述及使用方法<br />2.用户手册中的描述是否与需求一致 | 已验证，文档描述准确，未发现BUG |

### 4.1.9 性能影响

​        该参数对性能影响很小，可忽略。

| 测试步骤                                | 测试结果        |
| --------------------------------------- | --------------- |
| 关闭参数，1000warehouses-1000user-20min | tpmC:1243546.62 |
| 开启参数，1000warehouses-1000user-20min | tpmC:1225729.99 |

### 4.2.0 版本升级影响

| 测试步骤                                                     | 测试结果          |
| ------------------------------------------------------------ | ----------------- |
| 从openGauss 5.1.1版本升级到openGauss 6.0.0版本，新增本需求参数且功能表现正常 | 已验证，未发现BUG |
| 从openGauss 6.0.0版本回退到openGauss 5.1.1版本，无本需求参数 | 已验证，未发现BUG |



## 4.2   测试执行统计数据

本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。

| 版本名称                           | 测试用例数 | 用例执行结果                           | 发现问题单数 |
| ---------------------------------- | ---------- | -------------------------------------- | ------------ |
| openGauss 6.0.0 build 5e29c538     | 118        | 通过用例个数：113<br />失败用例个数：5 | 4            |
| openGauss 6.0.0-RC1 build 52f38ddd | 118        | 通过用例个数：118<br />失败用例个数：0 | 0            |

- 共118个测试用例，全部执行。

- 共发现4个缺陷，全部解决并验收通过。

- 缺陷密度：4/1=4 （个/Kloc）

*注：实际61行代码，不足千行，以千行计算*

## 4.2   后续测试建议

​        无。

# 5     附件

*此处可粘贴各类专项测试数据或报告*

 


