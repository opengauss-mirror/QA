![avatar](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAAAAACIM/FCAAACh0lEQVR4Ae3ch5W0OgyG4dt/mQJ2xgQPzJoM1m3AbALrxzrf28FzsoP0HykJEEAAAUQTBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAABBBBAAAEEkKK0789+GK/I2ezfQB522PnS1qc8pGgXvr4tE4aY0XOUWlGImThWgyCk6DleixzE7qwBkg/MGiDPlVVAyp1VQGrPKiACDhFI6VkF5LmzCki+sg7IwDoglnVAil0IMkeG9CyUiwsxLFUVFzJJOQaKCjFCDN9RXMjIX7W6ztZXZDKKCyn8sWJvH+nca7WHDN9lROlAliPH9iRKCPI4cswFJQWxB46toLQgQ9jhn5QYZA9DOkoMUoQde5YapAxDWkoNYsOQR3KQd9CxUnIQF4S49CB9ENKlBxmDEKsFUgMCCCCAAHIrSF61f6153Ajy8nyiPr8L5MXnmm4CyT2fzN4DUvHZ+ntA2tOQBRBAAAEEEEAAAQQQ7ZBaC6TwSiDUaYHQ2yuB0MN+ft+43whyrs4rgVCjBUKTFshLC6TUAjGA3AxSaYFYLZBOC2RUAsk8h5qTg9QcbEoOsoQhQ2qQhsO5xCD5dgB5JQaZ+KBKGtKecvR81Ic0ZDjByKdDx0rSEDZ/djQbH+bkIdvfJFm98BfV8hD2zprfVdlu9PxVeyYAkciREohRAplJCaRSAplJCcQogTjSAdlyHRBvSAekJR0QRzogA+mADJkOiCPSAPEtqYBshlRAXC43hxix2QiOuEZkVERykGyNo9idIZKE0HO7XrG6OiMShlDWjstVzdPgXtUH9v0CEidAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQP4HgjZxTpdEii0AAAAASUVORK5CYII=)

版权所有 © 2024  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期          | 修订版本 | 修改描述                                   | 作者   |
| ------------- | -------- | ------------------------------------------ | ------ |
| 2024年4月11日 | 1.0      | 创建文档                                   | 丁文轩 |
| 2024年7月15日 | 1.1      | 修正文档误删章节，没有涉及到的章节内容写无 | 宋菲   |
|               |          |                                            |        |

[TOC]

**Keywords 关键词**：

游标参数、默认值

**Abstract 摘要**：

对OpenGauss新增需求“支持游标参数默认值”进行测试

**缩略语清单： **

| 缩略语 | 英文全名                 | 中文解释       |
| ------ | ------------------------ | -------------- |
| SVT    | System Verification Test | 系统确认测试   |
| TSE    | Test System Engineer     | 测试系统工程师 |
| SE     | System Engineer          | 系统工程师     |



***

# 1 概述

​        openGauss 6.0.0 build 982a7bec（B017）版本后台启用支持游标参数默认值功能，包括默认值在声明时、DML操作时的正确性测试、参数默认值的验证、默认值的异常处理以及默认值的性能测试。

# 2 测试版本说明

## 2.1 测试版本信息

###   2.1.1 被测版本

| 版本名称                       | 软件包名称          | 测试起始时间  | 测试结束时间  | 测试人员     |
| ------------------------------ | ------------------- | ------------- | ------------- | ------------ |
| openGauss 6.0.0 build 982a7bec | openGauss6.0.0.B017 | 2024年5月30日 | 2024年6月11日 | 丁文轩       |
| openGauss 6.0.0 build ada68ffa | openGauss6.0.0.B021 | 2024年7月1日  | 2024年7月10日 | 宋菲、丁文轩 |

###  2.1.2 配套测试的版本

| 版本名称 | 配套版本 | 版本说明 |
| -------- | -------- | -------- |
| 无       | 无       | 无       |

## 2.2 测试环境描述

###  2.2.1 环境硬件信息

| 环境信息 | 硬件型号   | 硬件配置信息                                                 | 备注 |
| -------- | ---------- | ------------------------------------------------------------ | ---- |
| 测试环境 | Kunpeng920 | CPU：4核<br />内存：16G<br />硬盘：128G<br />OS：Kylin Linux Advanced Server V10<br />文件系统：EXT4<br />网卡：千兆 | 无   |

### 2.2.2 虚拟化平台

| 虚拟化平台 | 版本说明      |
| ---------- | ------------- |
| KVM        | version 4.1.0 |

# 3 版本概要测试结论、关键风险和规避措施

## 3.1 测试结论总结

​        本需求在测试阶段完成了功能测试、性能测试、可靠性、可测试性测试、可服务性测试。本需求100%实现，所有被测特性的测试用例的累计执行覆盖率达到100%，上述测试中未发现与本需求相关的问题，无遗留问题。

## 3.2 约束说明

​        需要按顺序先声明没有默认值的参数，再声明有默认值的参数。先于最后一个无默认值的参数声明的参数的默认值无效。例如在如下所示的例子中，游标c的参数arg1的默认值无效，只有arg3的默认值会生效。

| 示例：                                                       |
| ------------------------------------------------------------ |
| CURSOR c (arg1 int default 1, arg2 int ,  arg3 int default 3) FOR SELECT * FROM tb1; |

## 3.3 关键风险和规避措施

​        本需求在所有测试点都已经生成测试用例并执行的情况下，未发现缺陷。由于功能改动小、影响范围小，不再继续测试。若后续其他测试中发现本需求相关的缺陷，再提交并跟进修复。

| 风险类型 | 风险描述                 | 风险影响                       | 规避措施和计划         | 责任人 | 当前进展 |
| -------- | ------------------------ | ------------------------------ | ---------------------- | ------ | -------- |
| 功能风险 | 本次系统测试中未发现缺陷 | 使用到该功能时，可能会产生缺陷 | 提交缺陷并跟进修复缺陷 | 胡英豪 | 无       |

# 4 版本详细测试结论

## 4.1 特性测试结论

###   4.1.1 新需求质量评价

| 特性               | 特性价值评估                                                 | 应用说明及关键约束假设依赖 | 关键遗留事项如缺陷等 | 测试整体覆盖情况 | 特性质量评估               | 主要风险 |
| ------------------ | ------------------------------------------------------------ | -------------------------- | -------------------- | ---------------- | -------------------------- | -------- |
| 支持游标参数默认值 | 在此前版本openGauss已实现游标参数的基础上，支持为游标参数定义默认值。功能实现扩展和兼容，用户使用更方便。 | 无                         | 无                   | 良好             | <font color=green>▮</font> | 无       |

*特性质量评估说明*：

<font color=red><font color=red>●</font></font>： *表示特性不稳定，风险高*

<font color=yellow><font color=yellow>▲</font></font>： *表示特性基本可用，遗留少量问题*

<font color=green>▮</font>： *表示特性质量良好*

## 4.2 产品质量属性目标(DFX)测试结论

###  4.2.1 性能测试结论

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 在1000万条数据下，分别测试使用默认值和不使用默认值，查询的响应时间。 | 执行2条用例，未发现需求相关bug<br/>两者相差甚微，可忽略不计。 |

###  4.2.2 可靠性测试结论

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 使用游标参数默认值查询数据，100用户同时并发查询，执行7*24h。 | 执行过程中无异常、中止，执行结束后无宕机、僵死、数据丢失、内存溢出，数据库表现正常，整体质量良好。 |

###  4.2.3 安全&隐私保护测试结论

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| gsql执行用例，对于没有权限的表，定义带默认值游标并查询，报权限错误，符合预期 | 执行1条用例，未发现需求相关bug |

### 4.2.4 可测试性测试结论

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| cursor声明时全部设置、部分设置、全部不设置参数默认值，测试通过 | 执行9条用例，未发现需求相关bug  |
| 测试cursor在查询、插入、更新、删除操作时，传参使用与替代默认值，测试通过 | 执行8条用例，未发现需求相关BUG  |
| 测试多次调用带有参数默认值的cursor，测试通过                 | 执行1条用例，未发现需求相关BUG  |
| 测试参数默认值设置为NULL值，空串、特殊字符、变量、表达式、函数以及支持的最大最小整数值和最早最晚日期值，测试通过 | 执行15条用例，未发现需求相关BUG |
| 测试在函数、索引、存储过程、触发器、并发控制、水平分区表、视图、多表连接中使用游标参数默认值，测试通过 | 执行8条用例，未发现需求相关BUG  |
| 手动执行测试用例，测试在事务处理、临时表中使用游标参数默认值，测试通过 | 执行2条用例，未发现需求相关BUG  |
| 测试游标默认值数据类型设置为tinyint、smallint、int、bigint、<br>char、varchar、text、bit、varbit、<br>numeric、decimal、real、float8、float(53)、bytea、<br/>date、time、timetz、timetstamp、timetstamptz、<br/>interval year to month、interval day to second、<br/>bool、clob、json、array、blob、raw、<br/>time with time zone、timestamp with time zone、<br/>money、cidr、inet、macaddr、enum、lseg、<br/>box、path、circle、double precision，测试通过 | 执行40条用例，未发现需求相关BUG |
| 测试参数默认值声明时支持default和:=，测试通过                | 执行1条用例，未发现需求相关BUG  |
| 测试参数默认值向前抓取和向后抓取，支持的参数next、prior、backward、forward、absolute、relative、last，测试通过 | 执行1条用例，未发现需求相关BUG  |
| 测试默认值在for values子句中的使用，测试通过                 | 执行1条用例，未发现需求相关BUG  |
| 测试设置默认值为超出范围的值、非法值、以及数据类型异常、长度超过系统限制、重复设置相同游标参数默认值、默认值数据类型与游标参数类型不匹配，测试通过 | 执行6条用例，未发现需求相关BUG  |
| 手动执行测试用例，测试使用发布订阅功能使用游标，测试通过     | 执行1条用例，未发现需求相关BUG  |

### 4.2.5 可服务性测试结论

| 测试步骤                                               | 测试结果                 |
| ------------------------------------------------------ | ------------------------ |
| 验证异常情况时，报错或提示信息是否正确，语句清晰易懂。 | 测试通过，整体质量良好。 |

### 4.2.6 生命周期管理测试结论

​       本需求不涉及。

| 测试步骤 | 测试结果 |
| -------- | -------- |
| 无       | 无       |

### 4.2.7 韧性测试结论

​       本需求不涉及。

| 测试步骤 | 测试结果 |
| -------- | -------- |
| 无       | 无       |

###  4.2.8 兼容性测试结论

| 测试步骤                                       | 测试结果                                                     |
| ---------------------------------------------- | ------------------------------------------------------------ |
| 用例在兼容B库的模式下运行，验证功能是否正确。  | 兼容B库时，timestamp转换有问题待解决[IADQ33](兼容B库下，raise输出timestamp类型数据出错<br/>https://e.gitee.com/opengaussorg/dashboard?issue=IADQ33)，经开发人员分析与本需求无关。其他用例测试通过。 |
| 用例在兼容C库的模式下运行，验证功能是否正确。  | 测试通过。                                                   |
| 用例在兼容PG库的模式下运行，验证功能是否正确。 | 测试通过。                                                   |

###  4.2.9 升级测试结论

| 测试步骤                                                     | 升级路径                                               | 测试结果 |
| ------------------------------------------------------------ | ------------------------------------------------------ | -------- |
| 升级版本，新增本需功能，且测试用例执行通过                   | 从openGauss6.0.0.B016版本升级到openGauss6.0.0.B017版本 | 测试通过 |
| 回退版本，不支持本需求功能，即不支持游标参数设置默认值，报语法错误 | 从openGauss6.0.0.B017版本回退到openGauss6.0.0.B016版本 | 测试通过 |

## 4.3 资料测试结论

| 序号 | 测试章节                                                     | 测试结论               |
| ---- | ------------------------------------------------------------ | ---------------------- |
| 1    | [SQL参考>存储过程>游标>显式游标](https://docs-opengauss.osinfra.cn/zh/docs/latest/docs/SQLReference/%E6%98%BE%E5%BC%8F%E6%B8%B8%E6%A0%87.html) | 测试通过，整体质量良好 |

# 5 测试对象质量评估

##  5.1 覆盖率分析

​        本次覆盖的是游标参数默认值支持的不同数据类型以及在函数，存储过程，触发器，事务等不同场景下的覆盖等，主要通过边界值和异常值输入等对游标参数默认值进行测试，通过对功能和性能方面测试进行测试，测试功能使用正常，性能表现正常，默认值异常值可以正常抛出错误。

##  5.2 缺陷统计和分析

###   5.2.1 缺陷统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 0        | 0    | 0    | 0    | 0      |
| 百分比 | 0        | 0    | 0    | 0    | 0      |

###   5.2.2 缺陷列表

| 问题单号 | 问题描述 | 问题级别 | 当前状态 |
| -------- | -------- | -------- | -------- |
| 无       | 无       | 无       | 无       |

# 6 测试过程评估

##  6.1 测试策略回顾

| 编号 | 特性                                     | 验证策略                                                     | 是否按照测试策略<br/>执行 |
| ---- | ---------------------------------------- | ------------------------------------------------------------ | ------------------------- |
| 1    | 测试在声明时正确设置默认值               | 分别测试cursor声明时全部设置、部分设置、全部不设置参数默认值，测试通过。 | YES                       |
| 2    | 测试在DML操作下默认值的使用              | 分别测试cursor在查询、插入、更新、删除操作时，传参使用与替代默认值，测试通过。 | YES                       |
| 3    | 测试默认值的多次调用                     | 测试多次调用带有参数默认值的cursor，测试通过。               | YES                       |
| 4    | 参数默认值验证                           | 分别测试参数默认值设置为NULL值，空串、特殊字符、变量、表达式、函数以及支持的最大最小整数值和最早最晚日期值，测试通过。 | YES                       |
| 5    | 测试游标参数默认值功能在不同场景下的应用 | 分别测试在函数、索引、存储过程、触发器、事务处理、并发控制、水平分区表、视图、多表连接、临时表下使用游标参数默认值，测试通过。 | YES                       |
| 6    | 测试可支持设置为默认值的数据类型         | 分别测试游标默认值数据类型设置为tinyint、smallint、int、bigint、char、varchar、text、bit、varbit、numeric、decimal、real、float8、float(53)、bytea、date、time、timetz、timetstamp、timetstamptz、interval year to month、interval day to second、bool、clob、json、array、blob、raw、time with time zone、timestamp with time zone、money、cidr、inet、macaddr、enum、lseg、box、path、circle、double precision， 测试通过 | YES                       |
| 7    | 游标参数默认值声明时支持default和:=      | 分别测试参数默认值声明时支持default和:=，测试通过            | YES                       |
| 8    | 测试游标参数默认值向前抓取和向后抓取     | 分别测试支持的参数next、prior、backward、forward、absolute、relative、last，测试通过 | YES                       |
| 9    | 游标参数默认值在for values子句中的使用   | 测试默认值在for values子句中的使用，测试通过                 | YES                       |
| 10   | 测试默认值的异常处理                     | 分别测试设置默认值为超出范围的值、非法值、以及数据类型异常、长度超过系统限制、默认值数据类型与游标参数类型不匹配，正常报错，测试通过 | YES                       |
| 11   | 测试使用默认值性能                       | 分别测试使用默认值和不使用默认值在100万条数量环境下查询的响应时间。 | YES                       |
| 12   | 兼容性测试                               | 兼容A、B、C、PG库，功能可用                                  | YES                       |
| 13   | 可靠性测试                               | 使用游标参数默认值查询数据，100用户同时并发查询，执行7*24h。测试过程中保证无异常中止情况，测试结束保证数据库正常可用。 | YES                       |
| 14   | 资料测试                                 | 用户手册描述清晰、正确                                       | YES                       |

##  6.2 测试设计评估

| 编号 | 测试点修改说明                               | 修改原因         | 是否影响测试质量 |
| ---- | -------------------------------------------- | ---------------- | ---------------- |
| 1    | 增加default关键词可以用:=代替                | 神通内部评审建议 | 是               |
| 2    | 增加在没有权限的表上定义带默认值的游标并使用 | 神通内部评审建议 | 是               |
| 3    | 增加游标的向前抓取和向后抓取                 | 神通内部评审建议 | 是               |
| 4    | 增加测试发布订阅功能使用游标                 | 神通内部评审建议 | 是               |

##  6.3 测试执行评估

###  6.3.1 测试执行统计数据

| 版本名称                               | 工作量投入(人天) | 测试用例数 | 用例执行数 | 发现缺陷数 | 缺陷密度 |
| -------------------------------------- | ---------------- | ---------- | ---------- | ---------- | -------- |
| openGauss 6.0.0 build 982a7bec（B017） | 20               | 96         | 96         | 0          | 0        |
| openGauss 6.0.0 build ada68ffa（B021） | 1                | 96         | 96         | 0          | 0        |

*数据项说明：*

- *版本名称--每个转测版本名称，例如openGauss 6.0.0 B016*
- *工作量投入--与本活动相关的所有工作量投入，包括测试计划、方案、用例、脚本、执行等所有与本测试相关的活动所花的投入，单位“人天”；不包括以前已经统计的投入，不包括开局、用户支援等非测试相关投入；*
- *测试用例数--到本测试活动结束时，本测试活动中所有可用测试用例数；*
- *执行用例数--在本测试活动中执行测试用例数，含手工和自动化用例，多次重复执行同一用例计算为1个；*
- *发现缺陷数--本测试活动总共发现的缺陷数（不含无效问题单数）。*
- *缺陷密度--缺陷个数/代码行数*

###  6.3.2 测试用例执行结果统计数据

| 总测试用例数 | 实际测试的用例数 | Passed | Failed | Blocked | Unavailable | 执行率 | 执行通过率 |
| ------------ | ---------------- | ------ | ------ | ------- | ----------- | ------ | ---------- |
| 96           | 96               | 96     | 0      | 0       | 0           | 100%   | 100%       |

*其中：*

*Passed 用例执行成功*

*Failed 用例全部或部分执行结果未通过或者测试执行过程中遇到其他与本用例无关的失效事件*

*Blocked由于产品本身的问题导致用例不可执行*

*Unavailable由于软件本身以外，如环境、工具、物料、时间、人力资源等因素导致用例未执行*

# 7 附件

##  7.1 附件1：遗留问题列表

本需求无遗留缺陷。

| 序号 | 问题单号 | 问题描述 | 分类 | 问题级别 | 问题分析与影响 | 规避措施 |
| ---- | -------- | -------- | ---- | -------- | -------------- | -------- |
| 1    | 无       | 无       | 无   | 无       | 无             | 无       |

##  7.2 附件2：特性相关PR

https://e.gitee.com/opengaussorg/repos/opengauss/openGauss-server/pulls/4818

https://e.gitee.com/opengaussorg/repos/opengauss/docs/pulls/6222
