![avatar](../../../images/openGauss.png)

版权所有 © 2024  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述 | 作者     |
| ---------- | ----------- | -------- | -------- |
| 2024-04-18 | 1.0         | 初稿完成 | goupanlong |


关键词： datavec，向量数据库

 

摘要：本文档主要验证新增功能datavec，验证其在openGauss数据库的使用，并给出测试结论。

 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| NA     |          |          |

# 1     特性概述

本需求主要涉及openGauss数据库支持vector功能：

（1）主要涉及以下功能:

​	1）支持函数：vector_norm，l2_distance，inner_product，cosine_distance；

​	2）最大支持16000维向量，允许最多在2000维的对象上建立索引，且仅支持ivfflat索引；

​	3）向量运算：+，—，*，avg，sum；

​	4）类型转换;

​	5）属性：探针及列表。

# 2     特性测试信息

| 版本名称                           | 测试起始时间 | 测试结束时间 |
| ---------------------------------- | ------------ | ------------ |
| openGauss 6.0.0-RC1 build 93cd11e9 | 2024-03-29   | 2024-04-25   |
|                                    |              |              |


| 环境信息 | 配置信息                                                     | 备注     |
| -------- | ------------------------------------------------------------ | -------- |
| 虚拟机   | CPU：Intel(R) Xeon(R) CPU E5-2640 v2 @ 2.00GHz<br />内存：7GB<br />硬盘：300GB<br />OS：CentOS Linux 7 (Core) | 单机部署 |

# 3     测试结论概述

## 3.1   测试整体结论

共计执行38个用例，主要覆盖了功能测试、性能测试、安全测试、资料测试，发现issue0个，整体质量良好；

| 测试活动   | 活动评价                                                     |
| ---------- | ------------------------------------------------------------ |
| 功能测试   |<br />(1)验证函数功能正常;<br />(2)验证操作符功能正常；<br />(3)验证类型转换功能正常；<br />(4)验证向量运算符功能准确；<br />(5)验证ivfflat索引使用场景正确；<br />(6)验证异常值，错误入参等异常场，报错正常<br />执行用例38个；发现0个issue。<br />测试结论：通过 |
| 安全测试 | <br />(1)验证日志信息，资源统计是否正确<br /> |
| 稳定性测试 | 持续24h在虚拟机上进行并发增删改查操作，数据库无异常。 |
| 性能测试   | (1)验证多个维度的数据插入与查询性能；<br />测试结论：对向量数据进行了基准测试，具体测试数据见4.1数据项说明；测试过程中数据库性能无明显下降，向量数据正常。 |
| 资料测试   | 验证datavec资料描述正确。 |

## 3.2   约束说明

（1）暂时仅支持Create extension命令方式加载插件。
（2）暂时仅支持ivfflat索引。
（3）只支持行存表。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 0       | 0    | 0   | 0    | 0      |
| 百分比 | 0%    | 0%   | 0%  | 0%  | 0%    |

### 问题单汇总


# 4     测试执行

## 4.1   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 6.0.0 build 45f6613a | 38        | Passed：38  Failed：0 | 0                    |

*数据项说明：*

- 累计发现缺陷单0个。

- 缺陷密度：0(缺陷个数)/2.5kloc(代码行数)=0(个/kloc)

  

  性能测试数据：

| 特性名称       |       |          | 插入        | 插入       | 插入       | 插入         | 读取      | 读取      | 读取      | 读取         |
| -------------- | ----- | -------- | ----------- | ---------- | ---------- | ------------ | --------- | --------- | --------- | ------------ |
| 支持向量数据库 | 维度  | 行       | 执行1(ms)   | 执行2(ms)  | 执行3(ms)  | 平均执行(ms) | 执行1(ms) | 执行2(ms) | 执行3(ms) | 平均执行(ms) |
|                | 1000  | 1        | 7.697       | 6.397      | 8.677      | 7.590333333  | 1.785     | 2.744     | 1.957     | 2.162        |
|                | 1000  | 1000     | 208.629     | 417.35     | 333.470    | 319.8163333  | 2.905     | 3.482     | 1.662     | 2.683        |
|                | 1000  | 100000   | 23896.395   | 21995.769  | 21994.780  | 22628.98133  | 61.161    | 101.159   | 150.949   | 104.423      |
|                | 1000  | 1000000  | 262943.605  | 264963.219 | 246520.41  | 258142.4113  | 1452.013  | 1566.157  | 4382.16   | 2466.776667  |
|                | 1000  | 10000000 | 2760187.160 |            |            |              | 35832.162 | 34297.525 | 37851.645 | 36074.585    |
|                | 2000  | 1        | 8.688       | 9.757      | 9.312      | 9.252333333  | 1.827     | 2.092     | 2.171     | 2.03         |
|                | 2000  | 1000     | 375.419     | 300.195    | 238.519    | 304.711      | 2.796     | 3.027     | 1.807     | 2.543333333  |
|                | 2000  | 100000   | 31668.372   | 32617.68   | 35396.431  | 33227.49433  | 142.943   | 226.35    | 183.159   | 184.1506667  |
|                | 2000  | 1000000  | 334343.165  | 328576.325 | 320147.084 | 327688.858   | 1109.206  | 759.013   | 896.324   | 921.5143333  |
|                | 16000 | 1        | 29.147      | 44.593     | 45.113     | 39.61766667  | 2.811     | 2.925     | 2.008     | 2.581333333  |
|                |       | 1000     | 2831.379    | 2258.624   | 1535.875   | 2208.626     | 3.196     | 2.534     | 3.966     | 3.232        |
|                | 16000 | 100000   | 189785.146  | 173020.425 | 179602.721 | 180802.764   | 176.162   | 201.316   | 235.735   | 204.4043333  |
|                | 16000 | 1000000  | 2015507.288 |            |            |              | 1444.346  | 1356.258  | 1416.33   | 1405.644667  |

## 4.2   后续测试建议

无

# 5     附件



源代码及文档PR
- 打包和drop extension支持DataVec插件
  https://gitee.com/opengauss/openGauss-server/pulls/5031

- 支持向量插件DataVec
  https://gitee.com/opengauss/Plugin/pulls/1468

- 添加插件DataVec文档
  https://gitee.com/opengauss/docs/pulls/6298

- 调整DataVec文档描述
  https://gitee.com/opengauss/docs/pulls/6301



  



 

 
