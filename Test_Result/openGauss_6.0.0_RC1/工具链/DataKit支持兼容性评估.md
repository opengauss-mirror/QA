![avatar](../../../images/openGauss.png)

版权所有 © 2023  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订   版本 | 修改描述 | 作者        |
| --------- | ----------- | -------- | ----------- |
| 2024.03.6 | V1.0        | 初稿     | houshaolong |

 关键词： 

DataKit、兼容性评估

 摘要：

本文档内容为兼容性评估工具适配到Datakit

缩略语清单：

| 缩略语 | 英文全名                 | 中文解释   |
| ------ | ------------------------ | ---------- |
| N/A    | compatibility-assessment | 兼容性评估 |

# 1     特性概述

DataKit兼容性评估工具，支持从多种场景下获取SQL语句进行兼容性评估，并输出评估报告

# 2     特性测试信息

被测对象的版本信息：

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | :----------- | ------------ |
| openGauss 6.0.0 build 26aeb83b | 2024-1-25    | 2023-3-6     |
| openGauss 5.1.1 build 582426cb | 2024-3-21    | 2024-3-22    |
| MySQL 5.7.27                   | 2024-1-25    | 2023-3-22    |

硬件环境信息：

| 硬件型号   | 硬件配置信息                                                 | 备注 |
| ---------- | ------------------------------------------------------------ | ---- |
| x86+centOS | Intel(R) Xeon(R) Gold 6278C CPU @ 2.60GHz 8核<br/>内存：31GB<br/>硬盘：724G<br/>OS：CentOS Linux release 7.6.1908 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论 

DataKit支持兼容性评估，共执行用例18个，主要覆盖了功能测试和资料测试，功能测试覆盖插件的安装，卸载，不同场景下获取SQL语句进行评估，评估报告的格式以及结果准确性进行测试，资料测试覆盖校验资料的描述是否完整。累计发现缺陷单4个，4个缺陷均已解决且回归通过，整体质量良好。

## 3.2   约束说明

1、MySQL 5.7.27版本，数据库除初始用户外的数据库用户均有复制权；配置文件添加以下参数：

MySQL参数设置： general_log = 1，slow_query_log = on

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 4        | 0    | 0    | 3    | 1      |
| 百分比 | 100%     | 0%   | 0%   | 75%  | 25%    |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别   | 问题简述                                                     | 状态   |
| ---- | ------------------------------------------------------------ | ------ | ------------------------------------------------------------ | ------ |
| 1    | [I902G4](https://e.gitee.com/opengaussorg/issues/list?issue=I902G4) | 次要   | 【DataKit】兼容性评估工具，选择sql输入类型为file时，上传zip格式文件失败 | 已验收 |
| 2    | [8Z895](https://e.gitee.com/opengaussorg/issues/list?issue=I8Z895) | 次要   | 【DataKit】兼容性评估工具，新增采集任务时，已选时间段时间选择逻辑难理解，评估结果无法删除 | 已验收 |
| 3    | [I8Z7IH](https://e.gitee.com/opengaussorg/issues/list?issue=I8Z7IH) | 次要   | 【DataKit】兼容性评估工具，采集任务管理页面没有刷新按钮，无法实时查看采集任务进度，而且开始功能没有对应的文字说明 | 已验收 |
| 4    | [I8Z712](https://e.gitee.com/opengaussorg/issues/list?issue=I8Z712) | 不重要 | 【DataKit】兼容性评估工具，采集任务管理页面，没有对时间进行校验 | 已验收 |

# 4.1     测试执行

### 4.1.1   功能测试实现步骤

1.安装compatibility-assessment插件

2.测试插件功能

## 4.1.2 功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 通过DataKit安装、卸载插件<br />2. 通过上传ZIP包的方式进行兼容性评估<br />3. 评估类型选择sql，sql类型分别选择slow和general，使用DataKit进行兼容性评估<br />4. 评估类型选择all，sql类型选择slow和general，使用DataKit进行兼容性评估<br />5. 通过附加应用程序，使用DataKit进行兼容性评估 | 执行15条用例，执行结果符合预期，测试通过，发现3个bug，已解决并回归通过 |

## 4.1.3 兼容性测试

| 测试步骤                                                     | 测试结果                                            |
| ------------------------------------------------------------ | --------------------------------------------------- |
| 1. 安装6.0.0的openGauss数据库进行兼容性评估<br />2. 安装5.1.0的openGauss数据库进行兼容性评估 | 执行2条用例，执行结果符合预期，测试通过，未发现问题 |

## 4.1.3 UI测试

| 测试步骤                                      | 测试结果                     |
| --------------------------------------------- | ---------------------------- |
| 1. 测试UI布局使得否合理，操作流程是否符合逻辑 | 发现1个bug，已解决并回归通过 |

## 4.1.4 资料测试

| 测试步骤                     | 测试结果                               |
| ---------------------------- | -------------------------------------- |
| 1. 文档描述 <br/>2. 文档示例 | 文档描述准确，示例正确无误，未发现问题 |

## 4.2   测试数据统计

根据用例进行测试验证，结果如下：

| 版本名称                           | 测试用例数 | 用例执行结果        | 发现问题单数 |
| ---------------------------------- | ---------- | ------------------- | ------------ |
| compatibility-assessment.jar 6.0.0 | 16         | Passed:12 Failed:4  | 4            |
| compatibility-assessment.jar 6.0.0 | 18         | Passed:18 Failed: 0 | 0            |

*数据项说明：*

* 累计发现缺陷单4个，4个缺陷均已解决且回归通过
* 失败用例已在后续问题修复后，回归issue执行通过
* 缺陷密度：4(缺陷个数)/20.635kloc(代码行数)=0.194(个/kloc)



## 4.3   后续测试建议

覆盖sql语句类型，关注用户体验和易用性

# 5     附件

需求pr <br/>
https://gitee.com/opengauss/openGauss-workbench/pulls/501 <br/>
资料pr <br/>
https://gitee.com/opengauss/openGauss-workbench/blob/master/plugins/compatibility-assessment/README.md
