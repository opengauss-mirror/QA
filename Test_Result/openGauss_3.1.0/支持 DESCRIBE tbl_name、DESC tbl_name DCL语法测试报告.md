​                                                ![avatar](../../images/openGauss.png) 

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述                   | 作者        |
| ---------- | ----------- | -------------------------- | ----------- |
| 2022-06-28 | 1.0         | 特性测试报告初稿完成       | chengjiaqi1 |
| 2022-08-08 | 2.0         | 根据评审意见，修改报告     | chengjiaqi1 |
| 2022-08-09 | 3.0         | 根据二轮评审意见，修改报告 | chengjiaqi1 |

 关键词： 

dolphin插件，desc/describe语法，兼容B库，MySQL

摘要：

本文档主要介绍openGauss在兼容B库情形下安装dolphin插件，实现兼容MySQL中desc/describe语法查询表结构的特性测试报告。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现对MySQL中desc/describe命令的兼容，查询表所有字段以及字段对应数据类型，字段键值约束，字段默认值以及字段的额外约束值。其功能及执行结果同MySQL侧基本一致。由于Mysql和openGauss中数据类型以及系统表的不同，部分内容存在差异。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| MySQL 5.7                      | 2022-06-24   | 2022-06-30   |
| openGauss 3.0.0 build c611b010 | 2022-06-24   | 2022-06-27   |
| openGauss 3.0.0 build cd61c5a8 | 2022-06-27   | 2022-06-30   |
| Dolphin 1.0                    | 2022-06-24   | 2022-06-30   |

描述特性测试的硬件环境信息

| 硬件型号      | 硬件配置信息                                                 | 备注 |
| ------------- | ------------------------------------------------------------ | ---- |
| x86+OpenEuler | CPU：Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz<br />内存：16GB<br />硬盘：320G<br />OS：openEuler release 20.03 (LTS-SP1) |      |

软件信息

| 软件名称  | 软件版本        |
| --------- | --------------- |
| openGauss | openGauss 3.0.0 |



# 3     测试结论概述

## 3.1   测试整体结论

​	openGauss兼容MySQL desc/describe语法共计执行用例45条，主要覆盖功能测试，资料测试。功能测试覆盖不同的数据表类型、表字段不同数据类型、表字段不同键约束类型、desc/describe指定schema时的正反向语法、建表时指定字段的不同默认值，建表时字段的额外约束值以及不支持语法explain和非兼容B库的验证来进行分析不同表结构并校验输出结果，与MySQL执行结果进行比对。发现问题均已提单，回归验收已通过。

| 测试活动 | 活动评价                                              |
| -------- | ----------------------------------------------------- |
| 功能测试 | 编译库、编译插件，执行结果符合预期，通过              |
| 功能测试 | om安装库、安装插件，执行结果符合预期，通过            |
| 功能测试 | 针对不同数据表类型进行输出结果测试，通过              |
| 功能测试 | 针对表字段不同数据类型进行输出结果测试，通过          |
| 功能测试 | 针对表字段的不同类型键值约束进行输出结果测试，通过    |
| 功能测试 | desc/describe指定schema时的语法进行输出结果测试，通过 |
| 功能测试 | 针对建表时指定字段的不同默认值进行输出结果测试，通过  |
| 功能测试 | 针对建表时字段的额外约束值进行输出结果测试，通过      |
| 功能测试 | 不支持语法explain和非兼容B库的验证，通过              |
| 资料测试 | 资料叙述准确无误，示例正确，通过                      |

## 3.2   约束说明

1. openGauss需使用兼容B库
2. 安装插件dolphin
3. Mysql版本使用5.7
4. desc/describe语法不支持查询表同义词
5. mysql与openGauss的兼容性语法说明详见[openGauss-tools-sql-translator](https://gitee.com/opengauss/openGauss-tools-sql-translator)

## 3.3   遗留问题分析

### 3.3.1  遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2  问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 3        | 0    | 1    | 0    | 2      |
| 百分比 | 100%     | 0    | 50%  | 0    | 50%    |

### 3.3.3  问题单汇总

| 序号 | issue号                                                    | 问题级别 | 问题简述                                | 问题状态 |
| ---- | ---------------------------------------------------------- | -------- | --------------------------------------- | -------- |
| 1    | [I5ECBL](https://gitee.com/opengauss/Plugin/issues/I5ECBL) | 主要     | 表字段有多个键约束时,desc分析表结构报错 | 已验收   |
| 2    | [I5EB0S](https://gitee.com/opengauss/Plugin/issues/I5EB0S) | 不重要   | desc查询表同义词返回表结构为空          | 已取消   |
| 3    | [I5E10O]()                                                 | 不重要   | 编译数据库中desc查询临时表结构报错      | 已取消   |



# 4     测试执行

## 4.1   功能测试

### 4.1.1 编译库及插件执行测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 编译库及插件成功，共执行45条用例，<br />共发现3个bug，2条非问题已取消，1条回归验收已通过。缺陷密度为1（缺陷个数）/0.894k（代码行数）=1.2（个/kloc） |

#### 4.1.1.1 不同数据表类型输出结果测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对不同类型数据表,执行desc/describe 表名 命令查询表结构 | 执行22条用例，发现2个bug，非问题已取消 |

#### 4.1.1.2 表字段不同数据类型输出结果测试

| 测试步骤：                                                   | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对表字段不同数据类型,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.1.3 表字段的不同类型键值约束输出结果测试

| 测试步骤                                                     | 测试结果                                           |
| ------------------------------------------------------------ | -------------------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对表字段不同类型键值约束,执行desc/describe 表名 命令查询表结构 | 执行10条用例，发现1个bug，已提单，回归验收已通过。 |

#### 4.1.1.4 desc/describe指定schema的正反语法输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 分别执行 desc/describe schema.表名 命令与 desc/describe schema 表名    命令查询表结构 | 执行4条用例，执行结果符合预期 |

#### 4.1.1.5 建表时指定字段的不同默认值输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对建表时指定字段不同默认值,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.1.6 建表时字段的额外约束值输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对建表时指定字段额外约束值,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.1.7 不支持语法explain和非兼容B库的验证

| 测试步骤：                                                   | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 反向验证,explain命令查询表结构以及非兼容B库中执行desc/describe命令查询表结构 | 执行3条用例，执行结果符合预期 |

### 4.1.2 om安装库及插件执行测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. om安装openGauss数据库<br />2. 拷贝dolphin插件文件到对应目录下<br />3. 创建兼容B库 <br />4. 执行用例 | 安装库及插件成功，共执行45条用例，<br />执行结果同编译安装库及编译插件环境下执行结果相同 |

#### 4.1.2.1 不同数据表类型输出结果测试

| 测试步骤                                                     | 测试结果                               |
| ------------------------------------------------------------ | -------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对不同类型数据表,执行desc/describe 表名 命令查询表结构 | 执行22条用例，发现2个bug，非问题已取消 |

#### 4.1.2.2 表字段不同数据类型输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对表字段不同数据类型,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.2.3 表字段的不同类型键值约束输出结果测试

| 测试步骤                                                     | 测试结果                                           |
| ------------------------------------------------------------ | -------------------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对表字段不同类型键值约束,执行desc/describe 表名 命令查询表结构 | 执行10条用例，发现1个bug，已提单，回归验收已通过。 |

#### 4.1.2.4 desc/describe指定schema的正反语法输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 分别执行 desc/describe schema.表名 命令与 desc/describe schema 表名    命令查询表结构 | 执行4条用例，执行结果符合预期 |

#### 4.1.2.5 建表时指定字段的不同默认值输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对建表时指定字段不同默认值,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.2.6 建表时字段的额外约束值输出结果测试

| 测试步骤                                                     | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 针对建表时指定字段额外约束值,执行desc/describe 表名 命令查询表结构 | 执行2条用例，执行结果符合预期 |

#### 4.1.2.7 不支持语法explain和非兼容B库的验证

| 测试步骤                                                     | 测试结果 |
| ------------------------------------------------------------ | -------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 反向验证,explain命令查询表结构以及非兼容B库中执行desc/describe命令查询表结构 |          |

### 4.1.3 资料测试

| 测试步骤                   | 测试结果 |
| -------------------------- | -------- |
| 资料叙述准确无误，示例正确 | 通过     |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果              | 发现问题单数 |
| ------------------------------ | ---------- | ------------------------- | ------------ |
| openGauss 3.0.0 build c611b010 | 45         | Passed：39<br />Failed：6 | 3            |
| openGauss 3.0.0 build cd61c5a8 | 45         | Passed：45<br />Failed：0 | 0            |

数据说明

1.  openGauss 3.0.0 build c611b010版本测试过程中共发现3个bug，其中1个主要，2个不重要已取消，在openGauss 3.0.0 build cd61c5a8版本回归通过。缺陷密度为1（缺陷个数）/0.894k（代码行数）=1.2（个/kloc）

## 4.3   后续测试建议

1. 1条用例中涉及OpenGauss中对表同义词的适配，经过与开发沟通，认为可作为后续优化项，不作为bug，后续测试时可考虑此项。
2. 后续测试在测试设计评审时应仔细与开发确认具体的约束，执行测试用例执行时严格注意相关版本以及操作步骤，尽量避免出现非问题的bug。

# 5     附件

无
