![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

|   日期    | 修订版本 |               修改描述               |      作者       |
| :-------: | :------: | :----------------------------------: | :-------------: |
| 2022-8-5  |   1.0    |           特性测试报告初稿           | zou_jialiang050 |
| 2022-8-8  |   1.1    |     增加缩略语及完善操作系统信息     | zou_jialiang050 |
| 2022-8-15 |   1.2    | bug回归修改bug状态并增加测试执行步骤 | zou_jialiang050 |

 关键词： 插件、字符型数据类型、对比忽略尾部空格、条件筛选、

摘要：

本文对VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB字符型数据类型对比时忽略尾部空格特性测试，并给出最终测试结论。

缩略语清单：

| 缩略语 |                       英文全名                        | 中文解释                                             |
| :----: | :---------------------------------------------------: | ---------------------------------------------------- |
|  UTF8  | Universal Character Set/Unicode Transformation Format | 针对Unicode的一种可变长度字符编码                    |
| ASCII  |  American Standard Code for Information Interchange   | 美国信息交换标准代码是基于拉丁字母的一套电脑编码系统 |

# 1     特性概述

VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB字符型数据类型对比时忽略尾部空格特性。

# 2     特性测试信息

|           版本名称            | 测试起始时间 | 测试结束时间 |
| :---------------------------: | :----------: | :----------: |
| openGauss3.0.0 build 111ff9ef |   2022-8-1   |   2022-8-9   |

|  硬件型号  |                         硬件配置信息                         | 备注 |
| :--------: | :----------------------------------------------------------: | ---- |
| x86+CentOS | CPU：Inter Xeon Gold 6287C 8核<br />内存：1*32GB<br />硬盘：100G<br />OS：CentOS Linux 7 (Core) |      |

# 3     测试结论概述

经测试，字符型数据类型对比忽略尾部空格特性测试通过，共执行测试用例57条，发现2个bug，现已修复且已验收通过。



## 3.1   测试整体结论

字符型数据类型对比忽略尾部空格特性，共计执行用例57个，主要VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符型数据类型，发现2条问题已解决，回归通过，无遗留风险，整体质量良好。

|               测试活动               | 活动评价 |
| :----------------------------------: | :------: |
| VARCHAR(n)<br />CHARACTER VARYING(n) |   通过   |
|             VARCHAR2(n)              |   通过   |
|             NVARCHAR(n)              |   通过   |
|                 TEXT                 |   通过   |
|                 CLOB                 |   通过   |

## 3.2   约束说明

- 本报告中，使用的依赖为系统及插件包兼容依赖，对于依赖包错误有可能导致插件或数据库编译失败或报错。
- 本次测试是在固定的系统配置及软件版本等配套的前提下进行的，如果实际环境与本次测试存在不同，请自行评估差异。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| :------: | :------: | :------: | :----------------: | :------: |
|    NA    |          |          |                    |          |

### 3.3.2 问题统计

|             | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| :---------: | :------: | :--: | :--: | :--: | :----: |
|  数目 (个)  |    2     |  1   |  0   |  1   |   0    |
| 百分比  (%) |   100    |  50  |  0   |  50  |   0    |

### 3.3.3 问题详情

| 序号 |                           issue号                            | 问题级别 |                           问题简述                           | 问题状态 |
| :--: | :----------------------------------------------------------: | :------: | :----------------------------------------------------------: | :------: |
|  1   |  [I5QKZ6](https://gitee.com/opengauss/Plugin/issues/I5KQZ6)  |   次要   | 字符串忽略尾部空格进行group by having时需要设置string_hash_compatible=on或enable_hashagg=off文档中未说明 |  已验收  |
|  2   | [I5JXBG](https://gitee.com/opengauss/openGauss-server/issues/I5JXBG?from=project-issue) |   严重   |            创建兼容b库连接后数据库挂掉并产生core             |  已验收  |

# 执行

## 4.1   测试执行统计数据

### 4.1.1   字符型数据类型尾部忽略空格结合where =，！=，>=,<=,>,<验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建包含插件数据库；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.查询数据并结合where =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件兼容b库成功，上述各种字符串数据类型尾部包含单个及多个空格进行筛选时忽略尾部空格，共执行测试用例7条，发现1条bug，现已验收并回归通过。 |

###  4.1.2   字符型数据类型尾部忽略空格结合group by having =，！=，>=,<=,>,<验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建包含插件数据库并执行set enable_hashagg to off关闭enable_hashagg；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.查询数据并结合group by having  =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件兼容b库成功并成功设置参数，上述各种字符串数据类型尾部包含单个及多个空格进行筛选时忽略尾部空格，共执行测试用例8条，发现1条bug，现已验收并回归通过。 |

###  4.1.3   列存表、行存转向量化表中字符型数据类型尾部忽略空格结合where =，！=，>=,<=,>,<条件验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建包含插件数据库并执行set try_vector_engine_strategy to force创建创建行存转向量化表，建表并执行参数with (crientation = column)创建列存表；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.查询数据并结合where  =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件兼容b库成功，创建行存转向量化表、列存表成功，上述各种字符串数据类型尾部包含单个及多个空格进行筛选时忽略尾部空格，共执行测试用例12条，未发现bug。 |

###  4.1.4   字符型数据类型尾部忽略空格结合三种不同join方式mergejoin、nestloop、hashjoin并结合where =，！=，>=,<=,>,<条件验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建兼容b库并通过enable_hashjoin、enable_mergejoin、enable_nestloop参数控制链接查询方式，使用hashjoin时需使用guc 设置string_hash_compatible参数为on并重启数据库；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.分别在三种不同连接查询模式下查询数据并结合where  =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件兼容b库成功，上述各种字符串数据类型尾部包含单个及多个空格在结合三种join方式进行连接查询筛选时忽略尾部空格，共执行测试用例19条，未发现bug。 |

###  4.1.5   字符型数据类型尾部忽略空格结合字符串常用函数并结合where =，！=，>=,<=,>,<条件验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建兼容b库；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.查询数据并结合count(),length(),reverse(),concat(),lower(),upper(),trim(),lpad(),rpad()及where  =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件兼容b库成功，上述各种字符串数据类型尾部包含单个及多个空格在结合上述函数进行条件查询时忽略尾部空格，共执行测试用例9条，未发现bug。 |

###  4.1.6   字符型数据类型尾部忽略空格在UTF8及SQL_ASCII编码数据库下条件查询验证

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.分别创建UTF8与ASCII编码格式兼容b库；<br />3.分别创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.分别在两种不同编码格式数据库下进行查询数据并结合where  =，！=，>=,<=,>,<条件进行筛选； | 创建包含插件UTF8与ASCII编码格式兼容b库成功，上述各种字符串数据类型尾部包含单个及多个空格在两种不同编码格式数据库下进行条件查询时忽略尾部空格，共执行测试用例1条，未发现bug。 |

###  4.1.7   字符型数据类型尾部存在空格在启用插件及去除插件情况下查询性能对比

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.安装数据库及dolphin插件；<br />2.创建包含VARCHAR(n)，CHARACTER VARYING(n)，VARCHAR2(n)，NVARCHAR(n)，TEXT，CLOB几种字符串字段的表并插入尾部不含空格及单个空格、多个空格数据；<br />4.查询数据并记录查询时间；<br />5.去除插件后再次执行查询语句并记录查询时间并与有插件查询时间进行对比; | 创建包含插件兼容b库成功,在有插件及无插件数据库中执行查消耗时间无明显增加或减少，共执行测试用例1条，未发现bug。 |

## 4.2   后续测试建议

无

# 5     附件

无