

![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述                 | 作者     |
| ---------- | ----------- | ------------------------ | -------- |
| 2022-08-05 | 1.0         | 特性测试报告初稿完成     | wangke18 |
| 2022-08-08 | 1.1         | 根据评审意见修改测试报告 | wangke18 |
| 2022-08-08 | 1.2         | 根据评审意见修改测试报告 | wangke18 |

关键词： enum，枚举，dolphin，插件，兼容B库

摘要：基于openGauss开源项目，完成enum类型的支持，支持在列创建时指定该类型，同时在enum中可以指定字符串列表，列的值只能从这些字符串中选择。该测试主要基于dolphin插件进行测试，针对枚举类型中的使用场景，覆盖用户该功能的主要测试场景。

缩略语清单：

| 缩略语 | 英文全名    | 中文解释   |
| ------ | ----------- | ---------- |
| enum   | enumeration | 列举，枚举 |

# 1     特性概述

enum是一个字符串对象，其值是在创建表时在列定义中显示枚举的允许值列表中选择的。该特性支持enum类型，能够在建表时指定列为该类型，支持列的值只能从此字符串列表中选择，支持使用字符串索引来表示字符串值，支持对此枚举值的写入和查询。

# 2     特性测试信息

本节描述被测对象的版本信息，测试的时间，依赖的硬件

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.0.0 build 5f1620f6 | 2022-06-27   | 2022-07-01   |
| openGauss 3.0.0 build b08bcca7 | 2022-07-28   | 2022-07-28   |
| Dolphin 1.0                    | 2022-06-27   | 2022-07-01   |
| Mysql 5.7                      | 2022-06-27   | 2022-07-01   |

描述特性测试的硬件环境信息

| 硬件型号       | 硬件配置信息                                                 | 备注 |
| -------------- | ------------------------------------------------------------ | ---- |
| OpenStack Nova | CPU:  Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz<br>内存：16GB<br>硬盘：ssd<br>OS：Centos Linux 7<br>文件系统：ext3 |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss支持enum数据类型共计执行71条用例，主要覆盖了功能测试，资料测试。功能测试覆盖枚举值的数据类型和长度测试，使用索引号插入枚举值以及枚举值索引号的定义测试，修改enum列的字段类型测试，对enum类型列的字段类型修改测试，自定义的enum类型的删除测试，enum类型的支持对象测试等。资料测试覆盖校验资料的描述及示例的执行结果。共计发现2条问题，其中2条问题已解决。问题均回归通过，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                             |
| -------- | ---------------------------------------------------- |
| 功能测试 | 枚举值的数据类型和长度测试，通过                     |
| 功能测试 | 使用索引号插入枚举值以及枚举值索引号的定义测试，通过 |
| 功能测试 | enum类型的支持对象测试，通过                         |
| 功能测试 | 修改enum列的字段类型测试，通过                       |
| 功能测试 | 自定义的enum类型的删除测试，通过                     |
| 功能测试 | enum类型结合聚合函数使用测试，通过                   |
| 功能测试 | enum类型添加列约束，通过                             |
| 资料测试 | 资料描述准确，示例的执行结果正确，整体质量良好       |
## 3.2   约束说明

1. 可以使用纯数字作为枚举值，如果使用纯数字作为枚举值，要始终使用引号定义；
2. enum中的重复枚举值会导致报错；
3. enum支持的最大字符串长度为63；
4. 枚举值的下标索引号从1开始；
5. 不支持enum列作为分区表的分区键；
6. 兼容B库，不考虑其他库的兼容性；
7. mysql使用5.7版本。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 | 备注 |
| ------ | -------- | ---- | ---- | ---- | ------ | ---- |
| 数目   | 2        | 1    | 1    | 0    | 0      |      |
| 百分比 | 100%     | 50%  | 50%  | 0%   | 0%     |      |

### 3.3.3 问题单汇总

| 序号 | issue号    | 级别 | 问题简述                                                     | 状态   |
| ---- | ---------- | ---- | ------------------------------------------------------------ | ------ |
| 1    | [I5EHES]() | 严重 | 表中字段使用enum类型，调用存储过程插入数据，数据库断开连接，产生core文件 | 已验收 |
| 2    | [I5E7A0]() | 主要 | 不支持在定义中对enum类型施加外键约束                         | 已验收 |

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.编译安装opengauss数据库 <br />2.编译dolphin插件<br />3.创建兼容B库并安装dolphin插件<br />4.执行用例 | 共执行71条用例，<br />共发现2个bug，2条现已修复且验收通过<br />缺陷密度为 2(缺陷个数)/0.684k(代码行数)=2.9(个/kloc) |

#### 4.1.1.1 枚举值的数据类型和长度测试

| 测试步骤                      | 测试结果                         |
| ----------------------------- | -------------------------------- |
| 1. 枚举值的数据类型和长度测试 | 共执行15条用例，测试结果符合预期 |

#### 4.1.1.2 使用索引号插入枚举值以及枚举值索引号的定义测试

| 测试步骤                                          | 测试结果                         |
| ------------------------------------------------- | -------------------------------- |
| 1. 使用索引号插入枚举值以及枚举值索引号的定义测试 | 共执行10条用例，测试结果符合预期 |

#### 4.1.1.3 enum类型的支持对象测试

| 测试步骤                  | 测试结果                                                |
| ------------------------- | ------------------------------------------------------- |
| 1. enum类型的支持对象测试 | 共执行18条用例<br />共发现1个bug，1条现已修复且验收通过 |

#### 4.1.1.4 修改enum列的字段类型测试

| 测试步骤                    | 测试结果                         |
| --------------------------- | -------------------------------- |
| 1. 修改enum列的字段类型测试 | 共执行11条用例，测试结果符合预期 |

#### 4.1.1.5 自定义的enum类型的删除测试

| 测试步骤                      | 测试结果                        |
| ----------------------------- | ------------------------------- |
| 1. 自定义的enum类型的删除测试 | 共执行5条用例，测试结果符合预期 |

#### 4.1.1.6 enum类型结合聚合函数使用测试

| 测试步骤                       | 测试结果                        |
| ------------------------------ | ------------------------------- |
| 1.enum类型结合聚合函数使用测试 | 共执行1条用例，测试结果符合预期 |

#### 4.1.1.7 enum类型添加列约束

| 测试步骤              | 测试结果                                                |
| --------------------- | ------------------------------------------------------- |
| 1. enum类型添加列约束 | 共执行11条用例<br />共发现1个bug，1条现已修复且验收通过 |

#### 4.1.1.8 资料测试

| 测试步骤                       | 测试结果                       |
| ------------------------------ | ------------------------------ |
| 1. 使用方法描述<br>2. 示例测试 | 使用方法描述准确，示例正确无误 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 3.0.0 build 5f1620f6 | 71         | Passed：69  Failed：2 | 2            |
| openGauss 3.0.0 build b08bcca7 | 71         | Passed：71  Failed：0 |              |

说明：

1.openGauss 3.0.0 build 5f1620f6版本测试时发现2个问题。

2.openGauss 3.0.0 build b08bcca7版本回归2个问题单，验收通过。

3.缺陷密度为 2(缺陷个数)/0.684k(代码行数)=2.9(个/kloc)。

## 4.3   后续测试建议

enum类型支持纯数字的插入，但是数字要添加引号约束，插入的数字不支持sum函数和avg函数的使用，需评估后期是否支持该功能。

# 5     附件

 无