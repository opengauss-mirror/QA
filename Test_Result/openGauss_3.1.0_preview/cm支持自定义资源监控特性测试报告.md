![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订   版本 | 修改描述             | 作者    |
| :-------- | ----------- | -------------------- | ------- |
| 2022-9-22 | 1.0         | 特性测试报告初稿完成 | qiuying |
|           |             |                      |         |

 关键词： 

CM、自定义资源、Sharding

摘要：

本文档主要介绍实现CM的自定义资源管理，并以此实现对ShardingSphere Proxy和注册中心等的自动管理，并给出最终测试结论。 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

利用CM实现自定义资源管理，对ShardingSphere Proxy和注册中心等的自动管理，即CM具有监控除CM现有的监控内容外的能力，如用户指定的进程、服务等，实现对进程的守护、资源的故障处理等。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.0.0 build b2c6e04e | 2022-5-24    | 2022-6-10    |

| 硬件型号      | 硬件配置信息                                                 | 备注 |
| ------------- | ------------------------------------------------------------ | ---- |
| x86+openEuler | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300G<br/>OS：openEuler release 20.03 (LTS-SP1) |      |

# 3     测试结论概述

## 3.1   测试整体结论

CM实现自定义资源管理，共计执行77条用例，主要覆盖了功能测试、可靠性和资料测试。功能测试覆盖对自定义资源sharding/zookeeper/openlookeng的状态进行监控和异常启停，json文件的配置，使用json文件对所需监控资源进行配置，实现CM对自定义资源的管理。可靠性测试覆盖在CPU、磁盘、网络异常时，CM是否可以正常管理资源。资料测试覆盖校验资料的描述及示例的执行结果是否成功。累计发现缺陷单6个，全部问题已解决且回归通过，整体质量良好。

| 测试活动   | 活动评价                                                     |
| ---------- | :----------------------------------------------------------- |
| 功能测试   | 对于json文件中配置错误或合理的参数，重启集群，会打印合理且明确的日志信息 |
| 功能测试   | 配置资源sharding、zookeeper、openlookeng，CM可实现查询，启停资源，异常处理，整体质量良好 |
| 功能测试   | 扩容和升级场景下，对自定义资源的管理正常                     |
| 可靠性测试 | CPU、网络，磁盘等故障场景下CM管理资源正常                  |
| 资料测试   | 资料对于新增加的功能描述准确，示例的执行结果正确，整体质量良好 |

## 3.2   约束说明

- 数据库可适配安装CM

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 6        | 0    | 0    | 6    | 0      |
| 百分比 | 100%         | 0%   | 0%   | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I5E6M8](https://gitee.com/opengauss/CM/issues/I5E6M8?from=project-issue) | 次要     | 自定义资源监控的json配置文件中,脚本名称设置为null/1，执行cm_ctl stop命令报错产生core文件 | 已验收   |
| 2    | [I5EGGT](https://gitee.com/opengauss/CM/issues/I5EGGT?from=project-issue) | 次要     | CM查询自定义资源的状态，带参数i的时候，Title栏有node_ip，实际查询未显示ip | 已验收   |
| 3    | [I5FE4G](https://gitee.com/opengauss/CM/issues/I5FE4G?from=project-issue) | 次要     | CM执行cm_ctl stop -n NODEID停止cms备节点实例和资源后，query查询显示资源状态为online | 已验收   |
| 4    | [I5FG8U](https://gitee.com/opengauss/CM/issues/I5FG8U?from=project-issue) | 次要     | CM执行cm_ctl stop -n NODEID停止某节点后，-I 单独启动资源，提示启动资源成功，实际query查询显示资状态Unknown | 已验收   |
| 5    | [I5H53F](https://gitee.com/opengauss/CM/issues/I5H53F?from=project-issue) | 次要     | interval设置超过2时cm_ctl 查询资源状态显示unknown            | 已验收   |
| 6    | [I5H5FF](https://gitee.com/opengauss/CM/issues/I5H5FF?from=project-issue) | 次要     | CM1主2备扩容为1主3备,扩容失败                                | 已验收   |

# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 json文件配置测试

| 测试步骤：                                            | 测试结果                                     |
| ----------------------------------------------------- | -------------------------------------------- |
| 1. 配置json文件中各项参数<br/>2. 重启集群查看资源状态 | 执行17条用例，发现2个bug，现已修复且验收通过 |

### 4.1.2 资源管理测试

| 测试步骤：                    | 测试结果                                     |
| ----------------------------- | -------------------------------------------- |
| 1. 查看、启动、停止资源和集群 | 执行30条用例，发现3个bug，现已修复且验收通过 |

### 4.1.3 扩容和升级测试

| 测试步骤：                                          | 测试结果                                     |
| --------------------------------------------------- | -------------------------------------------- |
| 1. 集群进行升级、扩缩容操作<br/>2. 查看资源状态正常 | 执行10条用例，发现1个bug，现已修复且验收通过 |

### 4.1.4 故障场景测试

| 测试步骤：                                            | 测试结果                           |
| ----------------------------------------------------- | ---------------------------------- |
| 1. 资源启停的同时注入故障测试<br/>2. 查看资源状态正常 | 执行20条用例，未发现问题，验收通过 |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果            | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------- | ------------ |
| openGauss 3.0.0 build b2c6e04e | 73         | Passed：73<br>Failed：0 | 6            |

*数据项说明：*

* 累计发现缺陷单6个，缺陷均已解决且回归通过
* 失败用例已在后续问题修复后，回归issue执行通过

## 4.3   后续测试建议

无

# 5     附件

无
