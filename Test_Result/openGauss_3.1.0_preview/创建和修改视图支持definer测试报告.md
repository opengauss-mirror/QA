

![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述             | 作者         |
| ---------- | ----------- | -------------------- | ------------ |
| 2022-09-17 | 1.0         | 特性测试报告初稿完成 | shuai_lei666 |
|            |             |                      |              |

关键词： 兼容B库，dolphin插件，definer

摘要：本文档介绍openGauss在兼容B库中，且dolphin插件生效的情况下，支持create view和alter view通过definer指定属主，这两种语法的测试报告。

# 1     特性概述

openGauss在兼容B库中，且dolphin插件生效的情况下，支持create view和alter view通过definer=用户名的方法，指定视图的属主。

# 2     特性测试信息

本节描述被测对象的版本信息，测试的时间，依赖的环境

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.0.0 build 7bc2e7b3 | 2022-08-08   | 2022-08-16   |
| dolphin 1.0                    | 2022-08-08   | 2022-08-16   |

描述特性测试的环境信息

| 环境信息       | 配置信息                                                 | 备注 |
| -------------- | ------------------------------------------------------------ | ---- |
| 虚拟机 | CPU：Intel(R) Xeon(R) CPU E5-2680 v3 @ 2.50GHz 8核<br />内存：32GB<br />硬盘：100G<br />OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss在创建和修改试图支持definer语法，主要覆盖了功能测试，资料测试，升级测试。功能测试主要覆盖语法中使用的不同的参数以及参数的有效和无效取值，不同用户执行该语法的返回结果，导出导入试图后，查看视图权限是否变化；资料测试主要确保描述合理，约束点覆盖全面以及示例正确；升级测试主要查看功能升级后是否正常使用。发现问题3个，2个和开发确认非问题取消，1个已解决并测试通过。无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 针对语法的不同的参数以及参数的有效和无效的取值进行验证，通过 |
| 功能测试 | 针对不同用户执行该语法的返回结果，通过                       |
| 功能测试 | 针对导出导入试图后，查看视图权限是否变化，通过               |
| 升级测试 | 使用不同的升级路径，查看语法是否正常使用，通过               |
| 资料测试 | 资料叙述准确无误，示例正确，通过                             |
## 3.2   约束说明

1.mysql使用版本5.7

2.需要在兼容B库中执行

3.需要有dolphin插件

4.不能将不存在的用户指定为属主，mysql无此限制

5.openGauss暂不支持变更试图的列，alter view as selectstmt语句中，selectstmt语句筛选出来的列，其列名、列类型、精度（typmod值）和原试图中保持一致，但是可以使用selectstmt增加列

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| N/A      |          |          |                    |          |

### 3.3.2 问题统计

openGauss支持create view和alter view通过definer指定属主：

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 | 备注 |
| ------ | -------- | ---- | ---- | ---- | ------ | ---- |
| 数目   | 3        | 0    | 0    | 3    | 0      |      |
| 百分比 | 100%     | 0%   | 0%   | 100% | 0%     |      |

### 3.3.3 问题单汇总

| 序号 | issue号                                                      | 级别 | 问题简述                                                | 状态   |
| ---- | ------------------------------------------------------------ | ---- | ------------------------------------------------------- | ------ |
| 1    | [I5ME7M](https://gitee.com/opengauss/Plugin/issues/I5ME7M?from=project-issue) | 次要 | 创建视图时，使用definer指定用户，结果错误               | 已取消 |
| 2    | [I5MIVQ](https://gitee.com/opengauss/Plugin/issues/I5MIVQ?from=project-issue) | 次要 | 创建和修改视图时，使用defienr指定同一个用户，结果不同   | 已取消 |
| 3    | [I5NQ4I](https://gitee.com/opengauss/Plugin/issues/I5NQ4I?from=project-issue) | 次要 | 创建和修改视图通过definer指定属主功能，有插件时无法使用 | 已验收 |

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 功能测试

| 测试步骤                      | 测试结果                                                     |
| ----------------------------- | ------------------------------------------------------------ |
| 1.创建兼容B库<br />2.执行用例 | 共执行41条用例，<br />共发现3个bug，1条现已修复且验收通过，2条和开发确认为非问题 |

#### 4.1.1.1 语法的不同的参数以及参数的有效和无效的取值的测试

| 测试步骤                                      | 测试结果                                                     |
| --------------------------------------------- | ------------------------------------------------------------ |
| 1. 语法的不同的参数以及参数的有效和无效的取值 | 共执行26条用例，发现2个bug，1个回归验收已通过，1个非问题取消。 |

#### 4.1.1.2 针对不同用户执行该语法的返回结果的测试

| 测试步骤                          | 测试结果                                  |
| --------------------------------- | ----------------------------------------- |
| 1. 针对语法创建的对象是否可以删除 | 共执行4条用例，发现1个bug，回归验收已通过 |

#### 4.1.1.3 将视图导出后导入数据库中权限是都发生变化的测试

| 测试步骤                                    | 测试结果                        |
| ------------------------------------------- | ------------------------------- |
| 1. 将视图导出后导入数据库中权限是都发生变化 | 共执行2条用例，测试结果符合预期 |

#### 4.1.1.4 升级测试

| 测试步骤                                    | 测试结果                        |
| ------------------------------------------- | ------------------------------- |
| 1. 使用不同的升级路径，查看语法是否正常使用 | 共执行9条用例，测试结果符合预期 |

#### 4.1.1.5 资料测试

| 测试步骤                       | 测试结果                       |
| ------------------------------ | ------------------------------ |
| 1. 使用方法描述<br>2. 示例测试 | 使用方法描述准确，示例正确无误 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 3.0.0 build 7bc2e7b3 | 41         | Passed： 41 Failed：3 | 3            |
| openGauss 3.0.0 build 33e19d9e | 41         | Passed：41  Failed：0 | 0            |

说明：

1.openGauss 3.0.0 build 7bc2e7b3版本测试时发现3个问题，2个和开发确认作为非问题取消

2.openGauss 3.0.0 build 版本回归1个问题单，验收通过

3.缺陷密度：1(缺陷个数)/0.459k(代码行数)=2.1(个/kloc)

## 4.3   后续测试建议

1.create view通过definer无法将普通用户指定为属主，alter view可以将普通用户指定为属主，建议对此处进行测试，是否影响视图的权限

# 5     附件

## 5.1 修改视图时使用definer指定属主执行结果

```
test=# create user test password 'test@1234';
CREATE ROLE
test=# create view test_view as select 1;
CREATE VIEW
test=# alter definer=test_user view test_view as select 1;
test=# drop view test_view;
DROP VIEW
test=# drop user test_user;
DROP ROLE
```

