

![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述             | 作者     |
| ---------- | ----------- | -------------------- | -------- |
| 2022-12-23 | 1.0         | 特性测试报告初稿完成 | wangke18 |

关键词:视图进行插入、删除和更新，IUD，instead规则

摘要：本节主要介绍openGauss支持视图进行iud操作的测试活动。分别介绍功能测试，升级测试，安全测试以及性能测试的用例执行情况。

缩略语清单：

| 缩略语 | 英文全名             | 中文解释         |
| ------ | -------------------- | ---------------- |
| IUD    | insert,update,delete | 插入，更新，删除 |



# 1     特性概述



当前视图仅支持查询，如果要对视图直接做插入删除和更新的操作，当前提供了使用规则和触发器的方式，通过在视图上创建包含instead事件的规则和触发器，对视图的操作转换为对基表的操作。本特性支持在没有规则和触发器的情况下能够对可自动更新的视图直接进行数据修改，这种方式相比于前者使用更加方便，且性能更好。

# 2     特性测试信息

本节描述被测对象的版本信息，测试的时间

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.1.0 build 41c3b9d7 | 2022-12-11   | 2022-12-14   |
| postgresql-13.0                | 2022-12-11   | 2022-12-14   |

描述特性测试的环境信息

| 环境信息       | 配置信息                                                     | 备注 |
| -------------- | ------------------------------------------------------------ | ---- |
| OpenStack Nova | CPU:  Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz<br>内存：16GB<br>硬盘：ssd<br>OS：Centos Linux 7<br>文件系统：ext3 |      |



# 3     测试结论概述

## 3.1   测试整体结论

openGauss支持视图进行IUD操作共计执行41条用例，主要覆盖了功能测试，性能测试，升级测试，安全测试以及资料测试。功能测试覆盖支持以及不支持iud操作的视图场景。同时对在视图上插入数据的三种方式进行性能对比。升级测试覆盖升级前后对该性能的支持。另外通过修改执行用户对基表和视图的相应权限来进行安全测试。资料测试覆盖校验资料的描述及示例的执行结果。无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 对于可自动更新的视图进行iud操作测试，通过                    |
| 功能测试 | 对于不可自动更新的视图进行iud操作测试，通过                  |
| 功能测试 | 对支持定义with check option选项的场景进行测试，通过          |
| 功能测试 | 对不支持定义with check option选项的场景进行测试，通过        |
| 功能测试 | 对iud操作是否满足视图和基表的约束进行测试，通过              |
| 升级测试 | 对升级前后该特性的支持测试，通过                             |
| 性能测试 | instead规则/触发器/视图上插入数据三种方式在基表上插入1000000条数据进行性能对比，通过 |
| 安全测试 | 设置执行用户对视图和基表的权限测试，通过                     |
| 资料测试 | 资料描述准确，示例的执行结果正确，整体质量良好               |
## 3.2   约束说明

1. 只有直接引用基表用户列的列可自动更新

2. 对于插入和更新操作，视图必须至少包含一个可自动更新列；对于删除操作，可以没有

3. 不支持包含with，distinct,group by ,having,limit,offset子句的视图进行iud操作

4. 不支持包含集合运算的视图进行iud操作

5. 不支持包含聚集函数，窗口函数，返回集合函数的视图进行iud操作

6. check option选项只能定义在可自动更新的视图上

7. 如果一个可自动更新的视图拥有instead触发器和规则，则使用check option不会检查该视图上的条件

8. 如果一个可自动更新的视图是定义在另一个拥有instead触发器的视图上，那么使用check option会检查该自动更新视图上的条件，但不会检查带有触发器的底层视图上的条件

   ## 3.3 遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 | 备注 |
| ------ | -------- | ---- | ---- | ---- | ------ | ---- |
| 数目   | 0        | 0    | 0    | 0    | 0      |      |
| 百分比 | 0%       | 0%   | 0%   | 0%   | 0%     |      |

### 3.3.3 问题单汇总

| 序号 | issue号 | 级别 | 问题简述 | 状态 |
| ---- | ------- | ---- | -------- | ---- |
| 无   |         |      |          |      |

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 功能测试

| 测试步骤                            | 测试结果                                     |
| ----------------------------------- | -------------------------------------------- |
| 1.om方式安装数据库 <br />2.执行用例 | 共执行31条用例<br />执行结果均符合预期<br /> |

#### 4.1.1.1 对于可自动更新的视图进行iud操作测试

| 测试步骤                             | 测试结果                               |
| ------------------------------------ | -------------------------------------- |
| 1. om方式安装数据库<br />2. 执行用例 | 共执行11条用例<br />执行结果均符合预期 |

#### 4.1.1.2 对于不可自动更新的视图进行iud操作测试

| 测试步骤                             | 测试结果                          |
| ------------------------------------ | --------------------------------- |
| 1. om方式安装数据库<br />2. 执行用例 | 共执行7条用例，执行结果均符合预期 |

#### 4.1.1.3 对支持定义with check option选项的场景进行测试

| 测试步骤                             | 测试结果                              |
| ------------------------------------ | ------------------------------------- |
| 1. om方式安装数据库<br />2. 执行用例 | 共执行条6用例<br />执行结果均符合预期 |

#### 4.1.1.4 对不支持定义with check option选项的场景进行测试

| 测试步骤                             | 测试结果                              |
| ------------------------------------ | ------------------------------------- |
| 1. om方式安装数据库<br />2. 执行用例 | 共执行1条用例<br />执行结果均符合预期 |

#### 4.1.1.5 对iud操作是否满足视图和基表的约束进行测试

| 测试步骤                             | 测试结果                          |
| ------------------------------------ | --------------------------------- |
| 1. om方式安装数据库<br />2. 执行用例 | 共执行6条用例，执行结果均符合预期 |

### 4.1.2 升级测试

| 测试步骤                                                     | 测试结果                                                   |
| ------------------------------------------------------------ | ---------------------------------------------------------- |
| 1.安装3.0.0版本（未包含该特性）的数据库<br />2.创建视图进行iud操作<br />3.将数据库版本刷新到包含该特性的数据库版本，进行升级提交<br />4.创建视图进行iud操作 | 共执行1条用例，升级后支持视图进行iud操作，执行结果符合预期 |

### 4.1.3 性能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.om方式安装数据库<br />2.\timing on打开sql语句执行时间记录<br />3.instead规则/触发器/视图上插入数据三种方式在基表上插入1000000条数据进行性能对比<br />4.\timing off关闭sql语句执行时间记录 | 共执行1条用例，视图上插入数据与instead规则插入数据性能持平，两种方式性能均比触发器性能高，执行结果符合预期 |

### 4.1.4 安全测试

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| 1.om方式安装数据库<br />2.设置执行用户对视图和基表的权限，执行用例 | 共执行8条用例，执行结果符合预期 |

### 4.1.5 资料测试

| 测试步骤                        | 测试结果                       |
| ------------------------------- | ------------------------------ |
| 1. 使用方法描述<br/>2. 示例测试 | 使用方法描述准确，示例正确无误 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果          | 发现问题单数 |
| ------------------------------ | ---------- | --------------------- | ------------ |
| openGauss 3.1.0 build 41c3b9d7 | 41         | Passed：41  Failed：0 | 0            |

说明：

1.openGauss 3.1.0 build 41c3b9d7版本测试时用例均执行通过。

2.缺陷密度为 0(缺陷个数)/2k(代码行数)=0(个/kloc)。

## 4.3   后续测试建议

对于with check option选项是否能成功检查基表或者视图上的约束条件应给予明确的instead规则描述。

# 5     附件

 无