![avatar](D:\360安全浏览器下载\QA-master\images\openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期      | 修订   版本 | 修改描述             | 作者        |
| :-------- | ----------- | -------------------- | ----------- |
| 2022-8-18 | 1.0         | 特性测试报告初稿完成 | zhanghuan96 |

 关键词： 

M*、dolphin插件、网络函数、use db语法

摘要：

本文档主要基于插件dolphin兼容M*数据库4个网络函数及use db语法的特性测试，包括网络函数inet_aton(text)、inet_ntoa(int)、inet6_aton(text)、inet6_ntoa(bytea)，use db语法在openGauss侧指的是 use schema，并给出最终测试结论。 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

基于插件dolphin，实现openGauss对M*网络函数及use db语法兼容，包括这些函数的参数个数、参数取值、对无效值的处理方式、返回值类型和显示方式以及use db语法是否能正常切换到指定schema进行测试。其中inet_aton(text)指的是将IPv4地址的点分十进制表示的字符串转为整数；inet_ntoa(int)指的是将以整数表示的网络地址转为十进制的字符串；inet6_aton(text)指的是将IPv4或IPv6网络地址的字符串转为二进制字符串；inet6_ntoa(bytea)指的是将以数字形式表示的二进制字符串IPv4或IPv6网络地址转为以分隔符分隔的字符串。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.0.0 build e6142bdb | 2022-8-8     | 2022-8-12    |
| dolphin 1.0                    | 2022-8-8     | 2022-8-12    |
| openGauss 3.0.0 build 3d018a7e | 2022-8-13    | 2022-8-13    |

| 环境信息 | 硬件配置信息                                                 | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz 4核<br/>内存：32GB<br/>硬盘：300GB<br/>OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

基于插件dolphin兼容M*数据库4个网络函数及use db语法的特性测试，共计执行47条用例，主要覆盖了功能测试和资料测试。功能测试覆盖参数个数、参数类型、参数取值、无效取值处理方式等。资料测试覆盖校验资料的描述及示例的执行结果是否成功。累计发现缺陷单2个，其中1个缺陷待解决，1个已解决，回归通过，整体质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | :----------------------------------------------------------- |
| 功能测试 | 编译数据库，编译dolphin插件，执行结果符合预期，通过          |
| 功能测试 | om方式安装数据库，拷贝插件依赖文件，测试兼容函数和语法，执行结果符合预期，通过 |
| 功能测试 | 入参个数测试，通过                                           |
| 功能测试 | 入参取值测试，通过                                           |
| 功能测试 | 入参为其他数据类型测试，通过                                 |
| 功能测试 | 参数无效取值处理，通过                                       |
| 功能测试 | 网络函数结合表达式测试，通过                                 |
| 功能测试 | use db语法测试，通过                                         |
| 资料测试 | 资料描述完整准确，示例执行结果正确，整体质量良好             |

## 3.2   约束说明

- 兼容M*5.7版本
- openGauss需使用兼容B库且含dolphin插件
- 函数inet6_aton(text)，为了防止结果产生乱码，建议使用hex函数转为十六进制
- use db语法在openGaussd侧指的是use schema

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 |
| -------- | -------- |
| NA       |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 2        | 0    | 0    | 2    | 0      |
| 百分比 |          | 0%   | 0%   | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                             | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------ | -------- |
| 1    | [I5LTWK](https://gitee.com/opengauss/Plugin/issues/I5LTWK?from=project-issue) | 次要     | 网络函数返回结果有误                 | 待办的   |
| 2    | [I5LGWO](https://gitee.com/opengauss/Plugin/issues/I5LGWO?from=project-issue) | 次要     | inet_ntoa(int)函数入参未超范围，报错 | 已验收   |

# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 inet_aton(text)函数参数及返回值测试

| 测试步骤                                                     | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1.入参指定合法的IPv4类型<br>2.最大参数取值测试<br>3.查询返回值是否为int<br>4.入参不是合法的IPv4类型 | 执行11条用例，发现1个bug，现已修复且验收通过 |

### 4.1.2 inet_ntoa(int)函数参数及返回值测试

| 测试步骤                                                     | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1.入参指定合法的int型<br/>2.最大参数取值测试<br>3.查询返回值是否为text<br>4.无效入参 | 执行11条用例，发现1个bug，现已修复且验收通过 |

### 4.1.3 inet6_aton(text)

| 测试步骤                                                     | 测试结果               |
| ------------------------------------------------------------ | ---------------------- |
| 1.入参指定合法的IPv4或IPv6类型<br/>2.使用hex转换<br>3.查询返回值类型<br>4.不同网络函数结合使用 | 执行12条用例，执行通过 |

### 4.1.4 inet6_ntoa(bytea)

| 测试步骤                                                     | 测试结果              |
| ------------------------------------------------------------ | --------------------- |
| 1.入参指定合法的IPv4或IPv6类型<br>2.查询返回值类型<br>3.inet6_ntoa函数和inet6_aton函数结合使用 | 执行9条用例，执行通过 |

### 4.1.5 use db语法测试

| 测试步骤                                                     | 测试结果              |
| ------------------------------------------------------------ | --------------------- |
| 1.切换为自定义的schema并在该schema下创建对象<br/>2.切换为不存在的schema并在该schema下创建对象<br/>3.多个schema之间来回切换 | 执行4条用例，执行通过 |

## 4.2  测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果             | 发现问题单数 |
| ------------------------------ | ---------- | ------------------------ | ------------ |
| openGauss 3.0.0 build e6142bdb | 47         | Passed：47<br>Failed：2  | 2            |
| openGauss 3.0.0 build 3d018a7e | 47         | Passed：47<br/>Failed：0 | 0            |

*数据项说明：*

* 累计发现缺陷单2个，其中2个缺陷均已解决且回归通过
* 失败用例已在后续问题修复后，回归issue执行通过
* 缺陷密度：1(缺陷个数)/1.583kloc(代码行数)=0.63(个/kloc)

## 4.3   后续测试建议

-  use db语法在openGauss侧的实现是切换schema，切换成功回需在该schema下创建对象并验证schema是否正确
-  inet6_aton(text)函数测试时使用hex转换防止结果产生乱码

# 5     附件

##  5.1 inet_aton(text)函数使用示例

```sql
zh_db=# SELECT INET_ATON('10.0.5.9');
 inet_aton
-----------
 167773449
(1 row)
```

## 5.2 use db语法使用示例 

```sql
--创建schema
zh_db=# create schema schema_test0001;
CREATE SCHEMA
--use语句切换至自定义的schema
zh_db=# use schema_test0001;
SET
--查询当前schema
zh_db=# select current_schema;
 current_schema
-----------------
 schema_test0001
(1 row)
--切换至public下
zh_db=# use public;
SET
--查询
zh_db=# select current_schema;
 current_schema
----------------
 public
(1 row)
```



 

 