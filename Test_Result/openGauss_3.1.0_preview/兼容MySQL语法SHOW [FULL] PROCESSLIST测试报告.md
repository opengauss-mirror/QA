 ![avatar](../../images/openGauss.png) 

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订版本 | 修改描述             | 作者         |
| ---------- | -------- | -------------------- | ------------ |
| 2022-08-12 | 1.0      | 特性测试报告初稿完成 | lujianpei001 |
| 2022-08-16 | 1.1      | 根据评审意见修改     | lujianpei001 |
| 2022-08-30 | 1.2      | 再次根据评审意见修改 | lujianpei001 |
| 2022-09-07 | 1.3      | 修改缺陷密度单位与测试结论 | lihongji |
 关键词： 

dolphin插件，SHOW [FULL] PROCESSLIST，兼容B库，MySQL

摘要：

本文档主要介绍openGauss在兼容B库情形下安装dolphin插件，支持MySQL语法SHOW  [FULL]  PROCESSLIST， 查看当前外部连接（或内部线程）相关信息。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| N/A    |          |          |

# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现opengauss兼容MySQL语法SHOW  [FULL]  PROCESSLIST, 查看当前外部连接（或内部线程）相关信息。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| mysql 5.7.36                   | 2022-06-24   | 2022-06-28   |
| openGauss 3.0.0 build 2250adfd | 2022-06-24   | 2022-06-28   |
| dolphin 1.0                    | 2022-06-24   | 2022-06-28   |

描述特性测试的环境信息

| 环境信息 | 硬件配置信息                                                 | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | CPU：Intel(R) Xeon(R) CPU E5-2680 v3 @ 2.50GHz 8核<br />内存：32GB<br />硬盘：100G<br />OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss兼容MySQL语法SHOW  [FULL]  PROCESSLIST共计执行用例14条，主要覆盖了功能测试，安全测试及资料测试。功能测试验证了各字段显示信息是否与Mysql结果一致；安全测试验证了在不同用户权限下查看内部进程显示；资料测试验证了资料的描述及示例的执行结果。未发现问题，整体质量良好。

| 测试活动 | 活动评价                                       |
| -------- | ---------------------------------------------- |
| 功能测试 | 编译库、编译插件，执行结果符合预期，通过       |
| 功能测试 | om安装库、安装插件，执行结果符合预期，通过     |
| 功能测试 | 各字段显示信息测试，执行结果符合预期，通过     |
| 安全测试 | 不同用户查看内部线程，执行结果符合预期，通过   |
| 资料测试 | 资料描述准确，示例的执行结果正确，整体质量良好 |

## 3.2   约束说明

1. 需在兼容B库条件下
2. 安装插件dolphin
3. 不使用FULL选项，info字段只展示sql长度不超过100的部分
4. 使用FULL选项，info字段可展示完全超过1024的sql语句，如果长度超1024，会截断1024长度之外的部分

# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 编译库及插件成功，共执行11条用例，<br />全部执行通过，共发现0个bug |

#### 4.1.2 安全测试

| 测试步骤                                                     | 测试结果                                |
| ------------------------------------------------------------ | --------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.在不同用户权限下查看内部进程显示 | 执行3条用例，全部执行通过，共发现0个bug |

#### 4.1.3 资料测试

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. SHOW  [FULL]  PROCESSLIST使用方法描述 <br />2.示例描述正确无误 | 使用方法描述准确，示例正确无误 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果                | 发现问题单数 |
| ------------------------------ | ---------- | --------------------------- | ------------ |
| openGauss 3.0.0 build 2250adfd | 14         | Passed：14  <br />Failed：0 | 0            |

数据说明

1. openGauss兼容Mysql语法SHOW  [FULL]  PROCESSLIST测试共计14条用例，执行通过14条，共计发现0个bug
2.  缺陷密度为0(缺陷个数)/0.894k(代码行数)=0(个/kloc) 

# 5     附件

#### 5.1  SHOW   PROCESSLIST的示例

```
openGauss=# show processlist;
       Id        |       Pid       |      QueryId      | UniqueSqlId |   User    | Host |    db    |        Command         |
      BackendStart          |           XactStart           |  Time  | State  |                  Info
-----------------+-----------------+-------------------+-------------+-----------+------+----------+------------------------+---
----------------------------+-------------------------------+--------+--------+----------------------------------------
 139653370304256 | 139653370304256 |                 0 |           0 | opengauss |      | postgres | ApplyLauncher          | 20
22-06-21 16:46:19.656076+08 |                               |        |        |
 139653319255808 | 139653319255808 |                 0 |           0 | opengauss |      | postgres | Asp                    | 20
22-06-21 16:46:19.728521+08 |                               |      1 | active |
 139653336483584 | 139653336483584 |                 0 |           0 | opengauss |      | postgres | PercentileJob          | 20
22-06-21 16:46:19.728527+08 |                               |      8 | active |
 139653302175488 | 139653302175488 |                 0 |           0 | opengauss |      | postgres | statement flush thread | 20
22-06-21 16:46:19.728558+08 |                               | 508507 | idle   |
 139653198239488 | 139653198239488 |                 0 |           0 | opengauss |      | postgres | WorkloadMonitor        | 20
22-06-21 16:46:19.750133+08 |                               |        |        |
 139653181298432 | 139653181298432 |                 0 |           0 | opengauss |      | postgres | WLMArbiter             | 20
22-06-21 16:46:19.750976+08 |                               |        |        |
 139653215110912 | 139653215110912 |                 0 |           0 | opengauss |      | postgres | workload               | 20
22-06-21 16:46:19.754504+08 | 2022-06-21 16:46:19.769585+08 | 508507 | active | WLM fetch collect info from data nodes
 139653421840128 | 139653421840128 |                 0 |           0 | opengauss |      | postgres | JobScheduler           | 20
22-06-27 10:00:54.754007+08 |                               |      0 | active |
 139653044328192 | 139653044328192 | 48976645947655327 |  1772643515 | opengauss | -1   | dolphin  | gsql                   | 20
22-06-27 14:00:53.163338+08 | 2022-06-27 14:01:26.794658+08 |      0 | active | show processlist;
 139653027546880 | 139653027546880 | 48976645947655326 |  1775585557 | opengauss | -1   | postgres | gsql                   | 20
22-06-27 14:01:03.969962+08 | 2022-06-27 14:01:19.967521+08 |      7 | active | select pg_sleep(100);
(10 rows)
```