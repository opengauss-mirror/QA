![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述                 | 作者         |
| ---------- | ----------- | ------------------------ | ------------ |
| 2022-10-17 | 1.0         | 测试报告初稿完成         | wllove |


 关键词： 

PLSQL，alter，dolphin插件，兼容B库，mysql，无参列表   

摘要：

本文档主要介绍openGauss在兼容B库且有dolphin插件的情形下，实现兼容mysql通过alter修改存储过程和函数不用带参数列表的功能,使不带参数修改存储过程和函数的实现效果和带参数修改存储过程和函数效果相同,因为openGauss库不支持函数重载,因此不带参数修改函数和存储过程都只有唯一对应的存储过程或者函数,使得其效果和带参数修改效果保持一致.

# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现对mysql使用alter语句不带参数修改存储过程和函数

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| mysql 5.7                      | 2022-09-15   | 2022-09-23   |
| openGauss 3.1.0 build a31f86e5 | 2022-09-15   | 2022-09-23   |
| dolphin 1.0                    | 2022-09.15   | 2022-09-23   |

描述特性测试的环境信息

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 物理机   | CPU：Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz<br />OS：CentOS Linux release 7.6.1810 (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论

openGauss兼容mysql条件类型函数共计执行用例23条，主要覆盖了功能测试及资料测试。功能测试覆盖存储过程、函数不带参数列表的修改，包括存储过程、函数中调用alter修改存储过程或函数,以及不带参数修改存储过程、函数各类属性,并与mysql执行结果进行比对。资料测试覆盖校验资料的描述及示例的执行结果。目前未问题单，特性的质量良好。

| 测试活动 | 活动评价                                                     |
| -------- | ------------------------------------------------------------ |
| 功能测试 | 不带参数修改自定义存储过程各类属性,测试通过                     |
| 功能测试 | 不带参数修改自定义函数各类属性,测试通过                         |
| 功能测试 | 自定义函数中调用alter不带参数修改函数属性,测试通过              |
| 功能测试 | 自定义存储过程中调用alter不带参数修改存储过程属性,测试通过       |
| 功能测试 | 各类异常场景中调用alter不带参数修改存储过程或函数,测试通过       |
| 资料测试 | 资料描述准确，示例的执行结果正确，通过                          |

## 3.2   约束说明

1. mysql使用5.7版本
2. openGauss需使用兼容B库
3. 修改的属性只是characteristic部分,其中部分属性支持重复修改,以最后的赋值为准,部分属性不支持重复修改
4. alter语句语法正确,不带参数修改存储过程或函数和带参数修改表现保持一致
5.需要插件dolphin

## 3.3   遗留问题分析

### 3.3.1  遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |


### 3.3.2  问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------|
| 数目   | 0        | 0    | 0    | 0   | 0      |
| 百分比 | 100%     | 0%   | 0%   | 0%  | 0%     |

### 3.3.3  问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                             | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ---------------------------------------------------- | -------- |



# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 编译库及插件执行测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行23条用例 | 编译库及插件成功，执行用例成功<br />

#### 4.1.1.1 不带参数修改存储过程各类属性

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
|1. 在兼容B库并安装dolphin插件的环境 <br />2.结合alter语句不带参数修改存储过程各类属性| 执行7条用例，结果符合预期<br /> |

#### 4.1.1.2 不带参数修改自定义函数各类属性

| 测试步骤                                                     | 测试结果                        |
| ------------------------------------------------------------ | ------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.结合alter语句不带参数修改自定义函数各类属性| 执行7条用例，执行结果符合预期 |

#### 4.1.1.3 在存储过程或函数中调用alter语句不带参修改存储过程或函数属性

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.结合alter语句不带参数在函数和存储过程中修改各类属性 | 执行2条用例，执行结果符合预期 |

#### 4.1.1.4 结合各类异常场景不带参修改存储过程或函数属性

| 测试步骤                                                     | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2.结合兼容性测试和各类异常场景不带参数在函数和存储过程中修改各类属性 | 执行6条用例，执行结果符合预期 |

#### 4.1.1.5 该功能在文档中的说明是否准确，示例的执行结果正确

| 测试步骤                                                  | 测试结果                       |
| --------------------------------------------------------- | ------------------------------ |
| 1. 测试该功能在文档中的说明是否准确，示例的执行结果是否正确 | 测试通过|

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果                  | 发现问题单数 |
| ------------------------------ | ---------- | ----------------------------- | ------------ |
| openGauss 3.1.0 build a31f86e5 |  23        | Passed：23  <br />Failed：0  | 0            |




## 4.3   后续测试建议

1. 本次测试主要对不带参修改存储过程和函数部分属性进行测试,实现效果保持和带参修改一致,后续可以对带参和不带参整体一起进行测试.

# 5     附件

## 5.1  不带参修改存储过程和函数属性执行结果示例

```sql
--1.创建存储过程
CREATE OR REPLACE PROCEDURE prc_1094123(n in int,a out int) as
i int:=0;
BEGIN
label: loop
n=n-1;
i=i+1;
raise info '循环进行 %次. ', i;
IF n<3 then
leave label;
END IF;
END LOOP;
a=n;
END;
/

--2.修改
ALTER PROCEDURE prc_1094123(int) READS SQL DATA
LANGUAGE SQL
SQL SECURITY INVOKER;




```
