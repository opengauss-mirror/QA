 ![avatar](../../images/openGauss.png) 

版权所有 © 2022  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述             | 作者       |
| ---------- | ----------- | -------------------- | ---------- |
| 2022-06-06 | 1.0         | 特性测试报告初稿完成 | lizhuo9527 |
| 2022-06-07 | 1.1         | 修改报告描述         | lizhuo9527 |
| 2022-06-09 | 1.2         | 增加测试细节描述     | lizhuo9527 |

 关键词： 

dolphin插件，数学函数，兼容B库，MySQL

摘要：

本文档主要介绍openGauss在兼容B库情形下安装dolphin插件，实现兼容MySQL三个数学函数pi()、conv()、crc32()的特性测试报告。其中，pi()函数输出圆周率π的值；conv()函数实现对数值N进行36以内进制的任意进制转换；crc32()函数输出32位循环冗余校验码。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

openGauss在兼容B库情形下，安装dolphin插件，可以实现对MySQL的pi()、conv()、crc32()三个数学函数的兼容，其函数功能及执行结果同MySQL侧一致。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| MySQL 5.7                      | 2022-04-18   | 2022-06-06   |
| openGauss 3.1.0 build 2250adfd | 2022-04-18   | 2022-06-06   |
| dolphin 1.0                    | 2022-04-18   | 2022-06-06   |

描述特性测试的硬件环境信息

| 硬件型号   | 硬件配置信息                                                 | 备注 |
| ---------- | ------------------------------------------------------------ | ---- |
| x86+CentOS | CPU：Intel(R) Xeon(R) CPU E5-2680 v3 @ 2.50GHz 8核<br />内存：32GB<br />硬盘：100G<br />OS：CentOS Linux release 7.6.1810 (Core) |      |



# 3     测试结论概述

## 3.1   测试整体结论

​	openGauss兼容MySQL数学函数共计执行用例49条，主要覆盖了功能测试及资料测试。功能测试覆盖有效及无效的入参情形、结合其他函数及运算符（包括本次兼容的数学函数）、SQL语句、各种类型的表及自定义函数、存储过程等进行运算并校验输出结果，与MySQL执行结果进行比对。资料测试覆盖校验资料的描述及示例的执行结果。发现问题均已解决，回归通过，无遗留风险，整体质量良好。

| 测试活动 | 活动评价                                           |
| -------- | -------------------------------------------------- |
| 功能测试 | 编译库、编译插件，执行结果符合预期，通过           |
| 功能测试 | om安装库、安装插件，执行结果符合预期，通过         |
| 功能测试 | 有效及无效入参测试，通过                           |
| 功能测试 | 在常用SQL语句、常用类型表中的输出结果测试，通过    |
| 功能测试 | 结合常用数学函数及运算符进行运算测试，通过         |
| 功能测试 | 在自定义存储过程、自定义函数中的输出结果测试，通过 |
| 功能测试 | 函数名作为关键字、对象名使用测试，通过             |
| 资料测试 | 资料描述准确，示例的执行结果正确，整体质量良好     |

## 3.2   约束说明

1. 需在兼容B库条件下
2. 安装插件dolphin
3. 更改openGauss参数behavior_compat_options的值为'display_leading_zero'

## 3.3   遗留问题分析

### 3.3.1  遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
| NA       |          |          |                    |          |

### 3.3.2  问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 5        | 0    | 0    | 4    | 1      |
| 百分比 | 100%     | 0    | 0    | 80%  | 20%    |

### 3.3.3  问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                           | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | -------------------------------------------------- | -------- |
| 1    | [I556NW](https://gitee.com/opengauss/Plugin/issues/I556NW?from=project-issue) | 次要     | crc32()函数部分运算结果与期望不符                  | 已验收   |
| 2    | [I556HS](https://gitee.com/opengauss/Plugin/issues/I556HS?from=project-issue) | 次要     | conv()函数部分运算结果与期望不符                   | 已验收   |
| 3    | [I555YL](https://gitee.com/opengauss/Plugin/issues/I555YL?from=project-issue) | 次要     | pi()函数结合数学函数cot()与sin()运算结果与期望不符 | 已验收   |
| 4    | [I53WTW](https://gitee.com/opengauss/Plugin/issues/I53WTW?from=project-issue) | 次要     | pi()函数保留有效位数与预期不符                     | 已取消   |
| 5    | [I555QK](https://gitee.com/opengauss/Plugin/issues/I555QK?from=project-issue) | 不重要   | pi()函数部分运算结果与预期不符                     | 已取消   |



# 4     测试执行

## 4.1   测试执行步骤

### 4.1.1 编译库及插件执行测试

| 测试步骤：                                                   | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 编译安装openGauss数据库<br />2. 编译dolphin插件<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 编译库及插件成功，共执行49条用例，<br />共发现5个bug，3条现已修复且验收通过，2条非问题已取消 |

#### 4.1.1.1 函数有效及无效入参测试

| 测试步骤：                                                   | 测试结果                                    |
| ------------------------------------------------------------ | ------------------------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 以有效及无效参数作为输入测试函数执行结果 | 执行6条用例，发现2个bug，现已修复且验收通过 |

#### 4.1.1.2 函数在常用SQL语句及表类型中的输出结果测试

| 测试步骤：                                                   | 测试结果                       |
| ------------------------------------------------------------ | ------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 列举常用SQL语句及常见表类型测试函数输出结果 | 执行29条用例，执行结果符合预期 |

#### 4.1.1.3 结合其他常用函数测试及运算符输出结果

| 测试步骤：                                                   | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 结合其他常用函数及运算符测试输出结果 | 执行8条用例，发现3个bug，<br />1条现已修复且验收通过，2条非问题已取消 |

#### 4.1.1.4 函数在自定义函数及存储过程中的输出结果测试

| 测试步骤：                                                   | 测试结果                      |
| ------------------------------------------------------------ | ----------------------------- |
| 1. 在兼容B库并安装dolphin插件的环境 <br />2. 测试函数在自定义函数及存储过程中的输出结果 | 执行6条用例，执行结果符合预期 |

### 4.1.2 om安装库及插件执行测试

| 测试步骤：                                                   | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. om安装openGauss数据库<br />2. 拷贝dolphin插件文件到对应目录下<br />3. 创建兼容B库并安装dolphin插件 <br />4. 执行用例 | 安装库及插件成功，共执行49条用例，<br />执行结果同编译安装库及编译插件环境下执行结果相同 |

## 4.2   测试执行统计数据

| 版本名称                       | 测试用例数 | 用例执行结果                | 发现问题单数 |
| ------------------------------ | ---------- | --------------------------- | ------------ |
| openGauss 3.1.0 build 2250adfd | 49         | Passed：45  <br />Failed：4 | 5            |

数据说明

1. 3条用例中涉及科学计数法作为入参的情形与MySQL执行结果不一致（经评审不予修改）
2. 1条用例中pi()函数执行结果保留位数较MySQL精度高（经评审不予修改），其余均测试通过

## 4.3   后续测试建议

1. pi()函数计算结果的保留精度是否影响其他运算的结果

# 5     附件

## 5.1  conv()函数执行结果示例

```sql
db_lizhuo_b=# select * from pg_extension where extname = 'dolphin';
 extname | extowner | extnamespace | extrelocatable | extversion | extconfig | extcondition
---------+----------+--------------+----------------+------------+-----------+--------------
 dolphin |       10 |         2200 | f              | 1.0        |           |
(1 row)

db_lizhuo_b=# select conv(8,10,2);
 conv
------
 1000
(1 row)
```

 



 

 
