![avatar](../../images/openGauss.png)

版权所有 © 2022  openGauss社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述             | 作者        |
| :--------- | ----------- | -------------------- | ----------- |
| 2022-09-21 | 1.0         | 特性测试报告初稿完成 | jianghongbo4 |
| 2022-09-28 | 1.1 | 完成回归测试，修改特性测试报告 | jianghongbo4 |

 关键词：

MYSQL、dolphin插件、兼容B库、IS_IPV4_COMPAT()/IS_IPV4_MAPPED()

摘要：
基于openGauss开源项目，完成对IS_IPV4_COMPAT()/IS_IPV4_MAPPED()函数的支持。该测试主要基于dolphin插件进行测试，针对函数功能，覆盖主要测试场景。


缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| 无     |          |          |

# 1     特性概述

基于插件dolphin，实现openGauss对MYSQL IS_IPV4_COMPAT()/IS_IPV4_MAPPED()函数的兼容，包括函数的功能、参数类型、参数个数、返回值、函数名称大小写等。由于是在openGauss中支持IS_IPV4_COMPAT()/IS_IPV4_MAPPED()函数，且openGauss与MYSQL数据类型存在差异，因此函数入参部分类型的输入格式等和MYSQL侧不完全一致。

# 2     特性测试信息

| 版本名称                       | 测试起始时间 | 测试结束时间 |
| ------------------------------ | ------------ | ------------ |
| openGauss 3.1.0 build 0b50eccc | 2022-9-10    | 2022-9-22 |
| openGauss 3.1.0 build 73e83d99 | 2022-9-27    | 2022-9-28    |
| dolphin 1.0                    | 2022-9-10    | 2022-9-28    |
| mysql5.7 | 2022-9-10 | 2022-9-28 |

| 环境信息 | 配置信息                                                     | 备注 |
| -------- | ------------------------------------------------------------ | ---- |
| 虚拟机   | Intel(R) Xeon(R) Gold 6266C CPU @ 3.00GHz<br/>内存：30GB<br/>硬盘：40G<br/>OS：openEuler release 20.03 (LTS) (Core) |      |

# 3     测试结论概述

## 3.1   测试整体结论
基于插件dolphin兼容MYSQL IS_IPV4_COMPAT()/IS_IPV4_MAPPED()函数, 共计执行38条用例，主要覆盖了功能测试和资料测试。功能测试覆盖函数名称的大小写、函数参数的个数、函数参数的类型、函数对应的返回值等。资料测试覆盖校验资料的描述是否正确，示例的执行结果是否成功。共计发现问题4条，累计发现缺陷单一个，回归通过，整体质量良好。


| 测试活动 | 活动评价                                            |
| -------- | :-------------------------------------------------- |
| 功能测试 | 编译数据库，编译dolphin插件，执行结果符合预期，通过 |
| 功能测试 | 函数名称大小写测试，通过                            |
| 功能测试 | 函数返回值测试，通过                                |
| 功能测试 | 函数参数个数测试，通过                              |
| 功能测试 | 参数为嵌套子查询测试，通过                          |
| 功能测试 | 参数类型测试，通过                                  |
| 资料测试 | 资料描述完整准确，示例执行结果正确，整体质量良好    |

## 3.2   约束说明

- 兼容MYSQL5.7版本
- openGauss需使用兼容B库且含dolphin插件
- openGauss中二进制和十六进制不支持0x表示方式，但bytea类型支持\x表示。与mysql不完全一致
- mysql支持函数参数类型为数字、布尔、日期，且函数返回0，openGauss不支持这些类型，报error
- 当参数为嵌套子查询，且子查询返回值为数字、布尔、日期类型时，mysql返回0，opengauss不支持此类子查询，报error

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 |
| -------- | -------- |
| #I5RYHT       |    openGauss中二进制/十六进制不支持0x      |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要  | 不重要 |
| ------ | -------- | ---- | ---- | ----- | ------ |
| 数目   | 1       | 0    |   0  | 1    |   0    |
| 百分比 | 100%     | 0%   | 0% | 100% | 0%     |

###  3.3.3 问题单汇总

| 序号 | issue号                                                      | 问题级别 | 问题简述                                                     | 问题状态 |
| ---- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1    | [I5RZCQ](https://e.gitee.com/opengaussorg/dashboard?issue=I5RZCQ) | 次要     | IS_IPV4_COMPAT()/IS_IPV4_MAPPED()函数参数为null时，函数返回值为空 | 已验收   |


# 4     测试执行

## 4.1 测试执行步骤

###  4.1.1 功能测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.编译安装opengauss数据库<br>2.编译dolphin插件<br>3.创建兼容B库并安装dolphin插件<br>4.执行用例 | 共执行38条测试用例，共发现4条bug，2条bug已修复且验收通过，2条评审不予兼容，已取消 |

### 4.1.2 函数名称大小写测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.函数名称全部大写测试<br/>2.函数名称全部小写测试<br>3.函数名称部分大写部分小写测试| 共执行6条测试用例，测试结果符合预期 |

### 4.1.3 函数返回值测试

| 测试步骤                                      | 测试结果                                         |
| --------------------------------------------- | ------------------------------------------------ |
| 1.执行测试用例，测试函数返回值是否为0或1<br/> | 执行38条测试用例，发现2条bug，现已修复且验收通过 |

### 4.1.4 函数参数类型测试

| 测试步骤                                                     | 测试结果                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.参数为ipv6网络地址测试<br/>2.参数为ipv4地址测试<br/>3.参数为字符、数字、布尔、日期等类型测试<br>4.参数为NULL测试 | 执行28条测试用例，发现4条bug，2条bug已修复且验收通过，2条评审不予兼容，已取消 |

### 4.1.5 函数参数个数测试

| 测试步骤                                                     | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1.传入函数参数个数不等于1测试 | 执行2条测试用例，测试结果符合预期 |

### 4.1.6 函数参数为嵌套子查询测试

| 测试步骤                                                     | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1.设置参数为INET6_ATON()，hex()等查询 | 执行4条测试用例，测试结果符合预期 |

### 4.1.7 资料测试

| 测试步骤                                                     | 测试结果                                     |
| ------------------------------------------------------------ | -------------------------------------------- |
| 1.使用方法描述示例测试 | 使用方法描述准确，示例正确无误 

## 4.2  数据

| 版本名称                                                     | 测试用例数 | 用例执行结果             | 发现问题单数 |
| ------------------------------------------------------------ | ---------- | ------------------------ | ------------ |
| openGauss 3.1.0 build 0b50eccc | 38        | Passed：36<br>Failed：2 |         1          |
| openGauss 3.1.0 build 73e83d99 | 38 | Passed：38<br/>Failed：0 | 0 |

*数据项说明：*

* 累计发现缺陷单1个
* 缺陷密度：1(缺陷个数)/0.035kloc(代码行数)=28.57(个/kloc)

## 4.3  后续测试建议

-  支持十六进制的0x表示

# 5     附件

无
